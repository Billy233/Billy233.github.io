<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>OpenCV ç®—æ³•ç¬”è®°</title>
    <link href="/2024/06/18/cv/"/>
    <url>/2024/06/18/cv/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€.å›¾åƒçŸ©é˜µåŸºæœ¬æ“ä½œ">ä¸€.å›¾åƒçŸ©é˜µåŸºæœ¬æ“ä½œ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å®šä¹‰</span><br>Z = np.zeros((<span class="hljs-number">2</span>,<span class="hljs-number">4</span>), np.uint8)<br><span class="hljs-comment"># å…¨æ˜¯1 z = np.ones((2,4), np.int32)</span><br><br><span class="hljs-built_in">print</span>(z.shape)<br><span class="hljs-built_in">print</span>(z.dtype)<br><br>m=np.array([[<span class="hljs-number">14</span>, <span class="hljs-number">12</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">10</span>, <span class="hljs-number">12</span>, <span class="hljs-number">114</span>, <span class="hljs-number">29</span>], [<span class="hljs-number">67</span>, <span class="hljs-number">23</span>, <span class="hljs-number">52</span>, <span class="hljs-number">2</span>]], np.float32)<br><br>m[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>] <span class="hljs-comment">#ç¬¬ä¸€è¡Œç¬¬ä¸‰åˆ— 29</span><br>m[<span class="hljs-number">2</span>,:] <span class="hljs-comment">#ç¬¬äºŒè¡Œæ‰€æœ‰å…ƒç´ </span><br>m[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>, <span class="hljs-number">1</span>:<span class="hljs-number">3</span>]<br><span class="hljs-comment">#  12 3</span><br><span class="hljs-comment"># 12 114</span><br></code></pre></td></tr></table></figure><p>ndarrayçš„åŠ å‡æ³•ï¼š <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">mat1+mat2<br></code></pre></td></tr></table></figure>æ³¨æ„å¯¹ucharç±»å‹çš„å€¼è¶…è¿‡255çš„æ•°å¯¹255å–æ¨¡-1</p><p>ç‚¹ä¹˜ï¼š mat1*mat2 æˆ– np.multiply(m1, m2)</p><p>çŸ©é˜µä¹˜æ³•ï¼š np.dot(m1, m2)</p><p>å¹‚è¿ç®—ï¼šnp.power(m1, 2)</p><h2 id="äºŒ.ä»¿å°„å˜æ¢">äºŒ.ä»¿å°„å˜æ¢</h2><h3 id="ç©ºé—´åæ ‡å˜æ¢">2.1 ç©ºé—´åæ ‡å˜æ¢</h3><p>å¹³ç§»ï¼Œæ”¾ç¼©å’Œæ—‹è½¬</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">src</span> = np.array([<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],[<span class="hljs-number">200</span>,<span class="hljs-number">0</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">200</span>], np.float32)<br><span class="hljs-attribute">dst</span> = np.array([<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],[<span class="hljs-number">200</span>,<span class="hljs-number">0</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">200</span>], np.float32)<br><br><span class="hljs-attribute">T</span> = cv.getAffineTransform(src, dst)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <span class="math inline">\(dst = T\cdot src\)</span></p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">cv</span>.getRotationMatrix2D(<span class="hljs-built_in">center</span>, angle, <span class="hljs-built_in">scale</span>)<br></code></pre></td></tr></table></figure><p>center å˜æ¢ä¸­å¿ƒåæ ‡ï¼Œangleè§’åº¦å€¼é€†æ—¶é’ˆï¼Œscaleæ”¾ç¼©ç³»æ•°ã€‚</p><h3 id="æ’å€¼ç®—æ³•">2.2 æ’å€¼ç®—æ³•</h3><p>å®šä¹‰å‡½æ•°ï¼š<span class="math inline">\(I(y,x)\)</span> æ˜¯å›¾åƒçŸ©é˜µ<span class="math inline">\(y\)</span> è¡Œ <spanclass="math inline">\(x\)</span>åˆ—çš„å€¼ï¼Œå®šä¹‰äºŒç»´å‡½æ•°ï¼š</p><p><span class="math display">\[z=f_I(x,y)=I(x,y)\]</span></p><p><span class="math display">\[ \begin{bmatrix} \hat{x}\\\hat{y}\\1\end{bmatrix} = A\begin{bmatrix} x\\y\\1 \end{bmatrix} \]</span></p><p>è¦è®¡ç®— <span class="math inline">\(f_Oåœ¨(\tilde{x},\tilde{y})å¤„çš„å€¼ï¼Œ0\leqslant \tilde{x}\leqslant \tilde{W} - 1,0\leqslant y \leqslant \tilde{H} - 1\)</span>ï¼Œå…¶ä¸­<spanclass="math inline">\(\tilde{W}\)</span>å’Œ<spanclass="math inline">\(\tilde{H}\)</span>æ˜¯æ‰‹åŠ¨è®¾å®šçš„å€¼ã€‚</p><p><span class="math display">\[ \begin{bmatrix} x\\y\\1 \end{bmatrix}=  A^{-1}\begin{bmatrix} \hat{x}\\\hat{y}\\1 \end{bmatrix} \]</span></p><p>ä»¥æ”¾å¤§ä¸¤å€ä¸ºä¾‹ï¼š<spanclass="math inline">\(f_O(3,3)=f_I(1.5,1.5)\)</span>ï¼Œä½†æ— å®šä¹‰æ­¤æ—¶éœ€è¦æ’å€¼ä¼°ç®—<spanclass="math inline">\(f_O(3,3)\)</span>å¤„çš„å€¼äº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ <span class="math inline">\((\tilde{x},\tilde{y})\)</span>é€†ä»¿å°„å˜æ¢åçš„åæ ‡ (ğ‘¥, ğ‘¦)ï¼Œå¦‚æœ (ğ‘¥, ğ‘¦) è½åœ¨ ğ‘“ğ¼çš„å®šä¹‰åŸŸæ‰€åœ¨çš„çŸ©å½¢åŒºåŸŸ$[0, ğ‘Š âˆ’ 1] Ã— [0, ğ» âˆ’ 1]$å†…ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ’å€¼ç®—æ³•è®¡ç®—éæ•´æ•°å æ ‡å¤„çš„å‡½æ•°å€¼ï¼›å¦‚æœ(ğ‘¥, ğ‘¦)è½åœ¨ç¬¬ä¸€è±¡é™çš„å…¶ä»–åŒºåŸŸï¼Œç”šè‡³å…¶ä»–ä¸‰ä¸ªè±¡é™å†…ï¼Œå¦‚å›¾3-5ä¸­çš„ç¬¬äºŒç§æƒ…å†µæ‰€ç¤ºï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ç”¨æ’å€¼ç®—æ³•äº†ï¼Œæœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯ç›´æ¥ä»¤ <spanclass="math inline">\(ğ‘“_O(\tilde{x}, \tilde{y})\)</span>ç­‰äºæŸä¸€ä¸ªé¢„å…ˆè®¾å®šå¥½çš„å¸¸æ•°å³å¯ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/cv0.png" /></p><h4 id="æœ€è¿‘é‚»æ’å€¼">2.2.1 æœ€è¿‘é‚»æ’å€¼</h4><p>æœ€è¿‘é‚»æ’å€¼å°±æ˜¯ä»(ğ‘¥,ğ‘¦)çš„å››ä¸ªç›¸é‚»æ•´æ•°åæ ‡ä¸­æ‰¾åˆ°ç¦»å®ƒæœ€è¿‘çš„ä¸€ä¸ªï¼Œå‡è®¾ä¸º(ğ‘¥Ì‚, ğ‘¦ )Ì‚ï¼Œç„¶ åä»¤ ğ‘“ğ¼ (ğ‘¥,ğ‘¦) = ğ‘“ğ¼ (ğ‘¥Ì‚, ğ‘¦)Ì‚ ã€‚</p><p>ä¸¾ä¾‹ï¼š(2.3, 4.7) çš„å››ä¸ªç›¸é‚»æ•´æ•°åæ ‡åˆ†åˆ«ä¸º(2, 4)ã€(3, 4)ã€(2, 5)ã€(3,5)ï¼Œç¦»å®ƒæœ€è¿‘çš„æ˜¯ (2, 5)ï¼Œåˆ™å‡½æ•°ğ‘“ğ¼ åœ¨(2.3, 4.7) å¤„çš„å‡½æ•°å€¼ç­‰äº<spanclass="math inline">\(f_I\)</span> åœ¨(2, 5) å¤„çš„å€¼ï¼Œå³<spanclass="math inline">\(f_I(2.3, 4.7) = f_I(2, 5)\)</span>ã€‚</p><p>ä½¿ç”¨æœ€è¿‘é‚»æ’å€¼æ–¹æ³•å®Œæˆå›¾åƒå‡ ä½•å˜æ¢ï¼Œè¾“å‡ºå›¾åƒä¼šå‡ºç°é”¯é½¿çŠ¶å¤–è§‚ï¼Œå¯¹å›¾åƒæ”¾å¤§å¤„ç†çš„æ•ˆæœä¼šæ›´æ˜æ˜¾ã€‚ä¸ºäº†å¾—åˆ°æ›´å¥½çš„æ•ˆæœï¼Œåº”ä½¿ç”¨æ›´å¤šçš„ä¿¡æ¯ï¼Œè€Œä¸ä»…ä»…ä½¿ç”¨æœ€è¿‘åƒç´ çš„ç°åº¦å€¼ï¼Œå¸¸ç”¨çš„æ–¹æ³•æ˜¯åŒçº¿æ€§æ’å€¼å’Œä¸‰æ¬¡æ ·æ¡æ’å€¼ã€‚</p><h4 id="åŒçº¿æ€§æ’å€¼">2.2.2åŒçº¿æ€§æ’å€¼</h4><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/cv1.png" /></p><p>è®° <span class="math inline">\(a = |x-|x||\)</span>ï¼Œ <spanclass="math display">\[f_I(x,[y])=af_I([x] +1,[y])+(1-a)f_I([x],[y])\]</span> <span class="math display">\[f_I(x,[y]+ 1)=af_I([x] + 1,[y] + 1)+(1-a)f_I([x],[y] + 1)\]</span></p><p>å¾—ï¼š <span class="math display">\[f_I(x,y)=bf_I(x,[y] +1)+(1-b)f_I(x,[y])\]</span></p><p>è¿™æ ·å¯¹äºéæ•´æ•°åæ ‡å¤„çš„å‡½æ•°å€¼ï¼Œå°±å¯ä»¥åˆ©ç”¨å®ƒçš„é‚»åŸŸçš„å››ä¸ªæ•´æ•°åæ ‡å¤„çš„å‡½æ•°å€¼è¿›è¡Œæ’å€¼è®¡ç®—è€Œå¾—åˆ°ã€‚å½“ç„¶ï¼Œå¦‚æœå…ˆè¿›è¡Œä¸¤æ¬¡å‚ç›´æ–¹å‘ä¸Šçš„æ’å€¼ï¼Œç„¶åå†è¿›è¡Œæ°´å¹³æ–¹å‘ä¸Šçš„æ’å€¼ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p><h3 id="ä»¿å°„python-api">2.3 ä»¿å°„python-API</h3><p>OpenCV æä¾›äº†å‡½æ•°ï¼š <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON">cv2.warpAffine(src, M, dsize[, dst[, flags[, borderMode[, borderValue ]]]])<br></code></pre></td></tr></table></figure> æ¥å®ç°å›¾åƒçš„ä»¿å°„å˜æ¢ã€‚ srcè¾“å…¥å›¾åƒçŸ©é˜µ</p><p>M 2 è¡Œ3 åˆ—çš„ä»¿å°„å˜æ¢çŸ©é˜µ</p><p>dsize äºŒå…ƒå…ƒç»„(å®½, é«˜)ï¼Œè¾“å‡ºå›¾åƒçš„å¤§å°</p><p>flags æ’å€¼æ³•ï¼šINTE_NEARESTã€INTE_LINEARï¼ˆé»˜è®¤ï¼‰ç­‰</p><p>borderMode å¡«å……æ¨¡å¼ï¼šBORDER_CONSTANT ç­‰</p><p>borderValue å½“borderMode=BORDER_CONSTANT æ—¶çš„å¡«å……å€¼</p><p>ç¤ºä¾‹demo:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> math<br><span class="hljs-comment">#ä¸»å‡½æ•°</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv)&gt;<span class="hljs-number">1</span>:<br>        image = cv2.imread(sys.argv[<span class="hljs-number">1</span>],cv2.CV_LOAD_IMAGE_GRAYSCALE)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Usage: python warpAffine.py image&quot;</span><br>        cv2.imwrite(<span class="hljs-string">&quot;img.jpg&quot;</span>,image)<br>        <span class="hljs-comment">#åŸå›¾çš„é«˜ã€å®½</span><br>        h,w=image.shape[:<span class="hljs-number">2</span>]<br>        <span class="hljs-comment">#ä»¿å°„å˜æ¢çŸ©é˜µï¼Œç¼©å°2å€</span><br>        A1 = np.array([[<span class="hljs-number">0.5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>,<span class="hljs-number">0</span>]],np.float32)<br>        d1 = cv2.warpAffine(image,A1,(w,h),borderValue=<span class="hljs-number">125</span>)<br>        <span class="hljs-comment">#å…ˆç¼©å°2å€ï¼Œå†å¹³ç§»</span><br>        A2 = np.array([[<span class="hljs-number">0.5</span>,<span class="hljs-number">0</span>,w/<span class="hljs-number">4</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>,h/<span class="hljs-number">4</span>]],np.float32)<br>        d2 = cv2.warpAffine(image,A2,(w,h),borderValue=<span class="hljs-number">125</span>)<br>        <span class="hljs-comment">#åœ¨d2 çš„åŸºç¡€ä¸Šï¼Œç»•å›¾åƒçš„ä¸­å¿ƒç‚¹æ—‹è½¬</span><br>        A3 = cv2.getRotationMatrix2D((w/<span class="hljs-number">2.0</span>,h/<span class="hljs-number">2.0</span>),<span class="hljs-number">30</span>,<span class="hljs-number">1</span>)<br>        d3 = cv2.warpAffine(d2,A3,(w,h),borderValue=<span class="hljs-number">125</span>)<br>    cv2.imshow(<span class="hljs-string">&quot;image&quot;</span>,image)<br>        cv2.imshow(<span class="hljs-string">&quot;d1&quot;</span>,d1)<br>        cv2.imshow(<span class="hljs-string">&quot;d2&quot;</span>,d2)<br>        cv2.imshow(<span class="hljs-string">&quot;d3&quot;</span>,d3)<br>        cv2.waitKey(<span class="hljs-number">0</span>)<br>        cv2.destroyAllWindows()<br></code></pre></td></tr></table></figure><p>åœ¨OpenCV 3.X ä¸­é€šè¿‡å®šä¹‰å‡½æ•°ï¼š <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">rotate</span><span class="hljs-params">(InputArray src, OutputArray dst, <span class="hljs-type">int</span> rotateCode)</span><br></code></pre></td></tr></table></figure>æ¥å®Œæˆå›¾åƒçŸ©é˜µé¡ºæ—¶é’ˆæ—‹è½¬90âˆ˜ã€180âˆ˜ã€270âˆ˜</p><p>src è¾“å…¥çŸ©é˜µï¼ˆå•ã€å¤šé€šé“çŸ©é˜µéƒ½å¯ä»¥ï¼‰</p><p>dst è¾“å…¥çŸ©é˜µ</p><p>rotateCode:</p><p>ROTATE_90_CLOCKWISEï¼šé¡ºæ—¶é’ˆæ—‹è½¬90âˆ˜</p><p>ROTATE_180ï¼šé¡ºæ—¶é’ˆæ—‹è½¬180âˆ˜</p><p>ROTATE_90_COUNTERCLOCKWISEï¼šé¡ºæ—¶é’ˆæ—‹è½¬270âˆ˜</p><h2 id="ä¸‰.-æŠ•å½±å˜æ¢">ä¸‰. æŠ•å½±å˜æ¢</h2><p>ç±»ä¼¼äºä»¿å°„å˜æ¢ï¼ŒOpenCV æä¾›äº†å‡½æ•°ï¼š <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON">cv2.warpPerspective(src,M,dsize[,dst[,flags[,borderMode[,borderValue]]]])<br></code></pre></td></tr></table></figure> åŒç†<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON"><span class="hljs-comment">#è®¡ç®—æŠ•å½±å˜æ¢çŸ©é˜µ</span><br>p=cv2.getPerspectiveTransform(src,dst)<br><span class="hljs-comment">#åˆ©ç”¨è®¡ç®—å‡ºçš„æŠ•å½±å˜æ¢çŸ©é˜µè¿›è¡Œå¤´åƒçš„æŠ•å½±å˜æ¢</span><br>r = cv2.warpPerspective(image,p,(w,h),borderValue=<span class="hljs-number">125</span>)<br></code></pre></td></tr></table></figure></p><h2 id="å››.-æåæ ‡å˜æ¢">å››. æåæ ‡å˜æ¢</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs PYTHON">x=np.array([[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>]],np.float64)-<span class="hljs-number">1</span><br>y=np.array([[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>]],np.float64)-<span class="hljs-number">1</span><br>r,theta = cv2.cartToPolar(x,y,angleInDegrees=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>x array æ•°ç»„ä¸”æ•°æ®ç±»å‹ä¸ºæµ®ç‚¹å‹ã€float32 æˆ–è€…float64</p><p>y å’Œx å…·æœ‰ç›¸åŒå°ºå¯¸å’Œæ•°æ®ç±»å‹çš„array æ•°ç»„</p><p>angleInDegrees å½“å€¼ä¸ºTrue æ—¶ï¼Œè¿”å›å€¼angle æ˜¯è§’åº¦ï¼›åä¹‹ï¼Œä¸ºå¼§åº¦</p><p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œå°†9 ä¸ªç‚¹çš„æ¨ªåæ ‡å’Œçºµåæ ‡åˆ†åˆ«å¯¹åº”åœ°æ”¾åˆ°3 Ã— 3 çš„ndarrayä¸­ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥éƒ½æ”¾åˆ°9 Ã— 1 çš„ndarray ä¸­ï¼Œåªè¦x å’Œy å¯¹åº”å°±å¯ä»¥ã€‚</p><p>åŒç†</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">x,y=cv2.polarToCart(r,<span class="hljs-built_in">angle</span>,angleInDegrees=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>çº¿æ€§æåæ ‡å‡½æ•° <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">dst</span> = cv2.linearPolar(src,center=(<span class="hljs-number">508</span>,<span class="hljs-number">503</span>),maxRadius=<span class="hljs-number">550</span>,cv2.INTER_LINEAR)<br></code></pre></td></tr></table></figure></p><p>src è¾“å…¥å›¾åƒçŸ©é˜µï¼ˆå•ã€å¤šé€šé“çŸ©é˜µéƒ½å¯ä»¥ï¼‰</p><p>dst è¾“å‡ºå›¾åƒçŸ©é˜µï¼Œå…¶å°ºå¯¸å’Œsrc æ˜¯ç›¸åŒçš„</p><p>center æåæ ‡å˜æ¢ä¸­å¿ƒ</p><p>maxRadius æåæ ‡å˜æ¢çš„æœ€å¤§è·ç¦»</p><p>flags æ’å€¼ç®—æ³•ï¼ŒåŒå‡½æ•°resizeã€warpAffine çš„æ’å€¼ç®—æ³•</p>]]></content>
    
    
    
    <tags>
      
      <tag>Algorithm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å›¾è®ºæœ€çŸ­è·¯å¾„ç®—æ³•</title>
    <link href="/2024/03/10/dijkstra/"/>
    <url>/2024/03/10/dijkstra/</url>
    
    <content type="html"><![CDATA[<p>å›¾æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œæœ‰å‘å›¾å’Œæ— å‘å›¾é€šå¸¸éƒ½ç”±è¾¹ä¸èŠ‚ç‚¹æ„æˆã€‚å¾ˆå¤šå®é™…é—®é¢˜éƒ½å¯ä»¥æŠ½è±¡æˆå›¾æ¥è§£å†³ï¼Œå¦‚æœåœ¨ä¸€ä¸ªæœ‰è¾¹æƒçš„å›¾ä¸­ç»™å®šä¸¤ä¸ªç‚¹<span class="math inline">\(start\)</span> å’Œ <spanclass="math inline">\(end\)</span>ï¼Œåœ¨æ‰€æœ‰ <spanclass="math inline">\(start\)</span> è¿æ¥ <spanclass="math inline">\(end\)</span>çš„è·¯å¾„ä¸­å¯»æ‰¾è¾¹æƒå€¼å’Œæœ€å°çš„å°±æ˜¯æœ€çŸ­è·¯å¾„é—®é¢˜ã€‚</p><h2 id="floyd-warshall-ç®—æ³•">Floyd-Warshall ç®—æ³•</h2><p>Floyd é’ˆå¯¹çš„æ˜¯å¤šæºæœ€çŸ­è·¯å¾„ï¼ˆä¸€æ¬¡æ€§æ±‚æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼‰åŸºäº dpçš„æ€æƒ³ï¼šæ±‚ä¸¤ç‚¹ <span class="math inline">\(i\)</span>ï¼Œ <spanclass="math inline">\(j\)</span>ä¹‹é—´çš„æœ€çŸ­è·ç¦»ï¼Œåˆ†ä¸ºä¸¤ç§æƒ…å†µè€ƒè™‘ï¼Œå³ç»è¿‡é€”ä¸­æŸä¸ªç‚¹ <spanclass="math inline">\(k\)</span> çš„è·¯å¾„å’Œä¸ç»è¿‡ <spanclass="math inline">\(k\)</span> çš„è·¯å¾„ï¼Œå†å–äºŒè€…ä¸­çš„æ›´çŸ­è·¯å¾„ã€‚<spanclass="math inline">\(graph[i][j]\)</span> è¡¨ç¤ºäº† <spanclass="math inline">\(i\)</span> åˆ° <spanclass="math inline">\(j\)</span>ç›®å‰å·²çŸ¥æœ€çŸ­è·ç¦»ï¼Œå¦‚æœè¦æ›´æ–°ï¼Œåˆ™å¿…å®šç»è¿‡ç¬¬ä¸‰ä¸ªç‚¹ <spanclass="math inline">\(k\)</span> ä¸­è½¬ <span class="math inline">\(i-&gt; k -&gt; j\)</span>æ‰æœ‰å¯èƒ½ä½¿è·¯å¾„æ›´çŸ­ï¼Œæœ€å¤–å±‚å¾ªç¯éå†æ¯ä¸€ä¸ªä¸­è½¬èŠ‚ç‚¹ã€‚</p><p>ä»£ç å®ç°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> NUM = <span class="hljs-number">5</span>;<br>vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; <span class="hljs-built_in">graph</span>(NUM, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;(NUM, INT_MAX)); <span class="hljs-comment">// é‚»æ¥çŸ©é˜µå­˜å›¾ NUM * NUM</span><br><span class="hljs-type">int</span> n, m;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">floyd</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k = <span class="hljs-number">1</span>; k &lt;= n; k++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++) &#123;<br>                graph[i][j] = <span class="hljs-built_in">min</span>(graph[i][j], graph[i][k] + graph[k][j]);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>), cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>), cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    cin &gt;&gt; n &gt;&gt; m;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i++) &#123;<br>        <span class="hljs-type">int</span> u, v, w;<br>        cin &gt;&gt; u &gt;&gt; v &gt;&gt; w;<br>        graph[u][v] = w;<br>    &#125;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123;<br>        graph[i][i] = <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-built_in">floyd</span>();<br>    cout &lt;&lt; graph[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>] &lt;&lt; endl;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>äºŒç»´ <span class="math inline">\(vector\)</span>ç”¨æ¥å­˜å‚¨é‚»æ¥çŸ©é˜µï¼Œå¹¶å°† <span class="math inline">\(u\)</span> åˆ° <spanclass="math inline">\(v\)</span>çš„è·ç¦»è®¾ç½®ä¸ºæ— ç©·å¤§ï¼ŒèŠ‚ç‚¹åˆ°è‡ªèº«è·ç¦»ä¸º0ï¼Œæœ€åè¾“å‡º 1 åˆ° 3 çš„æœ€çŸ­è·¯å¾„ã€‚</p><p>Floydç®—æ³•å±€é™æ€§ï¼šå¯ä»¥å¤„ç†å¸¦æœ‰è´Ÿè¾¹æƒçš„å›¾ï¼Œä½†ä¸èƒ½å«æœ‰è´Ÿç¯ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è¾“å…¥ä»¥ä¸‹çš„æœ‰å‘å›¾ï¼š</p><p><a href=""></a></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs TEXT">4 8 <br>1 2 2<br>2 3 3<br>1 3 6<br>3 1 7<br>4 3 12<br>1 4 4<br>3 4 1<br>1 4 4<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š5</p><p>æ—¶é—´å¤æ‚åº¦ï¼š$ O(n^3) $</p><p>ç©ºé—´å¤æ‚åº¦ï¼š$ O(n^2) $ ï¼Œ <span class="math inline">\(n\)</span>ä¸ºé—®é¢˜è§„æ¨¡å³èŠ‚ç‚¹ä¸ªæ•°ã€‚</p><h2 id="dijkstra-ç®—æ³•">Dijkstra ç®—æ³•</h2><p>è¿™æ˜¯ä¸€ä¸ªå•æºæœ€çŸ­è·¯å¾„ç®—æ³•ï¼Œéœ€è¦ç”¨æˆ·ç»™å®šèµ·å§‹ç‚¹ <spanclass="math inline">\(st\)</span>ï¼Œç”¨ <spanclass="math inline">\(dis[i]\)</span> æ•°ç»„è®°å½• <spanclass="math inline">\(st\)</span> åˆ° <spanclass="math inline">\(i\)</span> çš„æœ€çŸ­è·¯å¾„ã€‚</p><p>Dijkstra æ€æƒ³æ˜¯ç»´æŠ¤ä¸¤ä¸ªç‚¹çš„é›†åˆ <spanclass="math inline">\(A\)</span>ï¼ˆç§°ä¸ºç™½ç‚¹ï¼Œå·²ç¡®å®šæœ€çŸ­è·¯å¾„ï¼‰ä¸ <spanclass="math inline">\(B\)</span>ï¼ˆç§°ä¸ºè“ç‚¹ï¼Œæœªç¡®å®šæœ€çŸ­è·¯å¾„ï¼‰ï¼Œé›†åˆ <spanclass="math inline">\(A\)</span> å‘å¤–æ‰©æ•£è‡³é‚»å±…èŠ‚ç‚¹ <spanclass="math inline">\(B\)</span>ï¼Œä»è€Œå®Œæˆæœ€çŸ­è·¯è®¡ç®—ã€‚ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stata">create the <span class="hljs-keyword">graph</span>;<br>vectorA push_back start;<br>vectorB push_back allNeighbors of A;<br><span class="hljs-keyword">u</span> = minOfDistanceFromStart;<br>vectorA push_back <span class="hljs-keyword">u</span>;<br><br>v = oneOfuNeighbors;<br><span class="hljs-keyword">dis</span>[s,v] = <span class="hljs-keyword">dis</span>[s,<span class="hljs-keyword">u</span>] + <span class="hljs-keyword">dis</span>[<span class="hljs-keyword">u</span>,v];<br><br>redo<br></code></pre></td></tr></table></figure><p>æœ´ç´ ç®—æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> NUM = <span class="hljs-number">5</span>;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">node</span> &#123;<br>    <span class="hljs-type">int</span> next, w8;<br>    <span class="hljs-built_in">node</span>(<span class="hljs-type">int</span> n, <span class="hljs-type">int</span> w): <span class="hljs-built_in">next</span>(n), <span class="hljs-built_in">w8</span>(w) &#123;&#125;<br>&#125;;<br><br><span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">dis</span><span class="hljs-params">(NUM, INT_MAX)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dijkstra</span><span class="hljs-params">(<span class="hljs-type">int</span> start, vector&lt;vector&lt;node&gt;&gt; &amp;g, <span class="hljs-type">int</span> n)</span> </span>&#123;<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">bool</span>&gt; <span class="hljs-title">vis</span><span class="hljs-params">(n + <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>)</span></span>;<br>    <br>    dis[start] = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) &#123; <span class="hljs-comment">// æ¯æ¬¡å¤§å¾ªç¯è‡³å°‘ä¼šæ›´æ–°ä¸€ä¸ªç‚¹åˆ° vis æ•°ç»„ä¸­ï¼Œæœ€åæƒ…å†µä¼šæ‰§è¡Œ n æ¬¡ç¡®å®šæ‰€æœ‰ç‚¹çš„æœ€çŸ­è·¯å¾„ï¼ˆä¹Ÿå¯èƒ½ä¼šæå‰ç»“æŸï¼‰</span><br>        <span class="hljs-type">int</span> min_pos = <span class="hljs-number">0</span>, min_cur = INT_MAX;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= n; j++) &#123;<br>            <span class="hljs-keyword">if</span> (!vis[j] &amp;&amp; dis[j] &lt; min_cur) &#123;<br>                min_pos = j;<br>                min_cur = dis[j];<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!min_pos) <span class="hljs-keyword">break</span>; <span class="hljs-comment">// ä¸€è½®æœªæ ‡è®°ï¼Œç»“æŸå¾ªç¯</span><br>        vis[min_pos] = <span class="hljs-number">1</span>;<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> &amp;neighbor : g[min_pos]) &#123; <span class="hljs-comment">// æ›´æ–° min_pos çš„é‚»å±…èŠ‚ç‚¹</span><br>            <span class="hljs-type">int</span> v = neighbor.next, w = neighbor.w8;<br>            dis[v] = <span class="hljs-built_in">min</span>(dis[v], dis[min_pos] + w);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>), cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>), cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-type">int</span> n, m;<br>    cin &gt;&gt; n &gt;&gt; m;<br>    vector&lt;vector&lt;node&gt;&gt; <span class="hljs-built_in">graph</span>(n + <span class="hljs-number">1</span>, <span class="hljs-built_in">vector</span>&lt;node&gt;()); <span class="hljs-comment">// é‚»æ¥è¡¨å­˜å›¾</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i++) &#123;<br>        <span class="hljs-type">int</span> u, v, w;<br>        cin &gt;&gt; u &gt;&gt; v &gt;&gt; w;<br>        graph[u].<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">node</span>(v, w));<br>    &#125;<br>    <span class="hljs-built_in">dijkstra</span>(<span class="hljs-number">1</span>, graph, n);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> &amp;x : dis) &#123;<br>        cout &lt;&lt; x &lt;&lt; endl; <span class="hljs-comment">// æ‰“å° 1 åˆ°å…¶ä»–æ¯ä¸ªèŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ï¼š $ O(n^2) $</p><p>ç©ºé—´å¤æ‚åº¦ï¼š $ O(m + n) $</p><p>åŸºäºå †çš„ä¼˜åŒ–ç‰ˆæœ¬ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> NUM = <span class="hljs-number">5</span>;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">node</span> &#123;<br>    <span class="hljs-type">int</span> next, w8;<br>    <span class="hljs-built_in">node</span>(<span class="hljs-type">int</span> n, <span class="hljs-type">int</span> w): <span class="hljs-built_in">next</span>(n), <span class="hljs-built_in">w8</span>(w) &#123;&#125;<br>    <span class="hljs-type">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-type">const</span> node &amp;other) <span class="hljs-type">const</span> &#123; <span class="hljs-comment">// æ“ä½œç¬¦é‡è½½ ç”¨äºå †æ’åˆ—</span><br>        <span class="hljs-keyword">return</span> w8&gt; other.w8;<br>    &#125;<br>&#125;;<br><br><span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">dis</span><span class="hljs-params">(NUM, INT_MAX)</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">dijkstra</span><span class="hljs-params">(<span class="hljs-type">int</span> start, vector&lt;vector&lt;node&gt;&gt; &amp;g, <span class="hljs-type">int</span> n)</span> </span>&#123;<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">bool</span>&gt; <span class="hljs-title">vis</span><span class="hljs-params">(n + <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>)</span></span>;<br>    dis[start] = <span class="hljs-number">0</span>;<br>    <br>    priority_queue&lt;node&gt; q;<br>    q.<span class="hljs-built_in">push</span>(<span class="hljs-built_in">node</span>(start, <span class="hljs-number">0</span>));<br>    <br>    <span class="hljs-keyword">while</span>(!q.<span class="hljs-built_in">empty</span>()) &#123;<br>        <span class="hljs-keyword">auto</span> cur = q.<span class="hljs-built_in">top</span>(); <span class="hljs-comment">// æ¯æ¬¡ä¼šå–å‡ºé‚»å±…èŠ‚ç‚¹ä¸­æœ€å¤§çš„</span><br>        q.<span class="hljs-built_in">pop</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> &amp;neighbor : g[cur.next]) &#123;<br>            <span class="hljs-keyword">if</span> (dis[cur.next] + neighbor.w8 &lt; dis[neighbor.next]) &#123;<br>                dis[neighbor.next] = dis[cur.next] + neighbor.w8;<br>                q.<span class="hljs-built_in">push</span>(<span class="hljs-built_in">node</span>(neighbor.next, neighbor.w8));<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>), cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>), cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-type">int</span> n, m;<br>    cin &gt;&gt; n &gt;&gt; m; <span class="hljs-comment">// ç‚¹ n è¾¹ m</span><br>    vector&lt;vector&lt;node&gt;&gt; <span class="hljs-built_in">graph</span>(n + <span class="hljs-number">1</span>, <span class="hljs-built_in">vector</span>&lt;node&gt;()); <span class="hljs-comment">// é‚»æ¥è¡¨å­˜å›¾</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i++) &#123;<br>        <span class="hljs-type">int</span> u, v, w;<br>        cin &gt;&gt; u &gt;&gt; v &gt;&gt; w;<br>        graph[u].<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">node</span>(v, w));<br>    &#125;<br>    <span class="hljs-built_in">dijkstra</span>(<span class="hljs-number">1</span>, graph, n);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> &amp;x : dis) &#123;<br>        cout &lt;&lt; x &lt;&lt; endl; <span class="hljs-comment">// æ‰“å° 1 åˆ°å…¶ä»–æ¯ä¸ªèŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„</span><br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ï¼š $ O((m + n)log n) $</p><p>$ nlogn $æ¥è‡ªäºæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯èƒ½å…¥é˜Ÿåˆ—ï¼ˆä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼Œæ¯æ¬¡æ’å…¥çš„å¤æ‚åº¦ä¸º $ logn$ï¼‰ã€‚</p><p>$ mlogn $ æ¥è‡ªäºæ¯æ¡è¾¹éƒ½å¯èƒ½å¯¼è‡´ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹å…¥é˜Ÿåˆ—ã€‚</p><p>å› æ­¤ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦ä¸º $ O((m+n)logn) $ã€‚</p><p>ç©ºé—´å¤æ‚åº¦ï¼š $ O(m + n) $</p><h2 id="bellman-ford-ç®—æ³•-è§£å†³è´Ÿè¾¹æƒ">Bellman-Ford ç®—æ³• â€”â€”â€”â€”è§£å†³è´Ÿè¾¹æƒ</h2><p>ä¸ Floyd ç®—æ³•æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼ŒFloydéå†äº†æ‰€æœ‰çš„èŠ‚ç‚¹ <spanclass="math inline">\(k\)</span>ï¼Œ<span class="math inline">\(k\)</span>ä½œä¸ºä¸­è½¬åˆ¤æ–­æ˜¯å¦ä½¿ <span class="math inline">\(i\)</span> åˆ° <spanclass="math inline">\(j\)</span> çš„è·¯å¾„æ›´çŸ­ã€‚</p><p>Bellman ç®—æ³•æ ¸å¿ƒæ˜¯éå†æ‰€æœ‰çš„è¾¹ <spanclass="math inline">\(j\)</span>ï¼Œæ ¹æ® <span class="math inline">\(u-&gt; j -&gt; v\)</span> æ›´æ–° <span class="math inline">\(v\)</span>çš„æœ€çŸ­è·¯å¾„ã€‚</p><p>æ¯æ¬¡å¾ªç¯ä¸­ï¼Œéå†æ‰€æœ‰çš„è¾¹ int j = 1; j &lt;= mï¼Œå¦‚æœ dis[u] + j.w8&lt; dis[v]ï¼Œæ›´æ–° dis[v] = dis[u] +j.w8ï¼Œè¿™ä¸€æ¬¡å¾ªç¯è¢«ç§°ä¸ºä¸€æ¬¡æ¾å¼›ï¼ˆrelaxï¼‰ã€‚</p><p>é‚£ä¹ˆéœ€è¦å¤šå°‘æ¬¡å¾ªç¯å‘¢ï¼Ÿ</p><p>æœ€å¤š <span class="math inline">\(n - 1\)</span>æ¬¡ï¼Œå› ä¸ºä¸€æ¡æœ€çŸ­è·¯å¾„çš„é•¿åº¦æœ€å¤šä¸º $ n - 1 $ æ¡è¾¹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> NUM = <span class="hljs-number">5</span>;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">edge</span>&#123;<br>    <span class="hljs-type">int</span> from, to, w8;<br>    <span class="hljs-built_in">edge</span>(<span class="hljs-type">int</span> from, <span class="hljs-type">int</span> to, <span class="hljs-type">int</span> w):<span class="hljs-built_in">from</span>(from), <span class="hljs-built_in">to</span>(to), <span class="hljs-built_in">w8</span>(w) &#123;&#125;<br>&#125;;<br><br>vector&lt;edge&gt; e; <span class="hljs-comment">// ç”¨æ‰€æœ‰è¾¹æ¥å­˜å›¾</span><br><span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">dis</span><span class="hljs-params">(NUM, INT_MAX / <span class="hljs-number">2</span>)</span></span>;<br><span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">pre</span><span class="hljs-params">(NUM)</span></span>; <span class="hljs-comment">// å‰é©±:pre[x] = yï¼Œè¡¨ç¤º x çš„å‰ä¸€ä¸ªç‚¹æ˜¯ y</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">bellman</span><span class="hljs-params">(<span class="hljs-type">int</span> start, <span class="hljs-type">int</span> n, <span class="hljs-type">int</span> m)</span> </span>&#123;<br>    dis[start] = <span class="hljs-number">0</span>; <span class="hljs-comment">// èµ·ç‚¹è·ç¦»ä¸º 0</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; n; i++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; m; j++) &#123; <span class="hljs-comment">// éå†è¾¹</span><br>            <span class="hljs-type">int</span> x = e[j].from, y = e[j].to;<br>            <span class="hljs-keyword">if</span> (dis[y] &gt; dis[x] + e[j].w8) &#123;<br>                dis[y] = dis[x] + e[j].w8;<br>                pre[y] = x;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>), cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>), cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-type">int</span> n, m;<br>    cin &gt;&gt; n &gt;&gt; m; <span class="hljs-comment">// ç‚¹ n è¾¹ m</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++) &#123;<br>        <span class="hljs-type">int</span> x, y, weight;<br>        cin &gt;&gt; x &gt;&gt; y &gt;&gt; weight;<br>        e.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">edge</span>(x, y, weight));<br>    &#125;<br>    <span class="hljs-built_in">bellman</span>(<span class="hljs-number">1</span>, n, m);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n ;i++) &#123;<br>        cout &lt;&lt; dis[i] &lt;&lt; endl;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ï¼š $ O(mn) $</p><p>ç©ºé—´å¤æ‚åº¦ï¼š $ O(m + n) $</p><h2 id="spfa-é˜Ÿåˆ—ä¼˜åŒ–çš„-bellman">SPFA* â€”â€”â€”â€” é˜Ÿåˆ—ä¼˜åŒ–çš„ Bellman</h2><p>SPFAï¼ˆShortest Path FasterAlgorithmï¼‰ç®—æ³•æ˜¯ä¸€ç§ç”¨äºæ±‚è§£å›¾ä¸­æœ€çŸ­è·¯å¾„é—®é¢˜çš„ç®—æ³•ï¼Œå®ƒæ˜¯ Bellman-Fordç®—æ³•çš„é˜Ÿåˆ—å®ç°ï¼ˆä¸æ˜¯ä¼˜å…ˆé˜Ÿåˆ—ï¼‰ã€‚SPFAç®—æ³•ä½¿ç”¨äº†ç±»ä¼¼å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBFSï¼‰çš„ç­–ç•¥ï¼Œä½†å®ƒå¹¶ä¸æ˜¯çº¯ç²¹çš„å¹¿åº¦ä¼˜å…ˆæœç´¢ã€‚</p><p>åœ¨ SPFAç®—æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—æ¥ä¿å­˜æ‰€æœ‰å¾…å¤„ç†çš„èŠ‚ç‚¹ã€‚åˆå§‹æ—¶ï¼Œæˆ‘ä»¬å°†èµ·ç‚¹åŠ å…¥é˜Ÿåˆ—ã€‚ç„¶åï¼Œæˆ‘ä»¬ä¸æ–­ä»é˜Ÿåˆ—ä¸­å–å‡ºèŠ‚ç‚¹ï¼Œå¯¹å…¶è¿›è¡Œæ¾å¼›æ“ä½œï¼Œå¹¶å°†æ‰€æœ‰ä»è¿™ä¸ªèŠ‚ç‚¹å‡ºå‘å¯ä»¥åˆ°è¾¾çš„ã€å¹¶ä¸”å¯ä»¥é€šè¿‡æ¾å¼›æ“ä½œæ›´æ–°è·ç¦»çš„èŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸€ç›´æŒç»­åˆ°é˜Ÿåˆ—ä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰èŠ‚ç‚¹éœ€è¦å¤„ç†ä¸ºæ­¢ã€‚</p><p>å› æ­¤ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼ŒSPFAç®—æ³•ä¸­çš„è¿™ä¸ªè¿‡ç¨‹å’Œå¹¿åº¦ä¼˜å…ˆæœç´¢æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†å®ƒä»¬å¹¶ä¸å®Œå…¨ç›¸åŒã€‚åœ¨å¹¿åº¦ä¼˜å…ˆæœç´¢ä¸­ï¼Œæˆ‘ä»¬åªä¼šè®¿é—®æ¯ä¸ªèŠ‚ç‚¹ä¸€æ¬¡ï¼Œè€Œåœ¨SPFAç®—æ³•ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½ä¼šè¢«åŠ å…¥é˜Ÿåˆ—å¤šæ¬¡ï¼Œæ¯æ¬¡å½“æˆ‘ä»¬é€šè¿‡æ¾å¼›æ“ä½œæ›´æ–°äº†è¿™ä¸ªèŠ‚ç‚¹çš„è·ç¦»æ—¶ï¼Œå°±ä¼šå°†è¿™ä¸ªèŠ‚ç‚¹å†æ¬¡åŠ å…¥é˜Ÿåˆ—ã€‚</p><p>ï¼ˆ1ï¼‰èµ·ç‚¹så…¥é˜Ÿï¼Œè®¡ç®—å®ƒæ‰€æœ‰é‚»å±…åˆ°sçš„æœ€çŸ­è·ç¦»(å½“å‰æœ€çŸ­è·ç¦»ï¼Œå¯èƒ½ä¸æ˜¯å…¨å±€æœ€çŸ­ï¼ŒæŠŠè®¡ç®—ä¸€ä¸ªç»“ç‚¹åˆ°èµ·ç‚¹sçš„æœ€çŸ­è·¯å¾„ç®€ç§°ä¸ºæ›´æ–°çŠ¶æ€ï¼Œæœ€åçš„â€œçŠ¶æ€â€å°±æ˜¯SPFAçš„è®¡ç®—ç»“æœ)ã€‚æŠŠså‡ºé˜Ÿï¼ŒçŠ¶æ€æœ‰æ›´æ–°çš„é‚»å±…å…¥é˜Ÿï¼Œæ²¡æ›´æ–°çš„ä¸å…¥é˜Ÿã€‚å³ï¼Œé˜Ÿåˆ—ä¸­éƒ½æ˜¯çŠ¶æ€æœ‰å˜åŒ–çš„ç»“ç‚¹ï¼Œåªæœ‰è¿™äº›ç»“ç‚¹æ‰ä¼šå½±å“æœ€çŸ­è·¯å¾„çš„è®¡ç®—ã€‚</p><p>ï¼ˆ2ï¼‰ç°åœ¨é˜Ÿåˆ—çš„å¤´éƒ¨æ˜¯sçš„ä¸€ä¸ªé‚»å±…uã€‚å¼¹å‡ºuï¼Œæ›´æ–°å…¶æ‰€æœ‰é‚»å±…çš„çŠ¶æ€ï¼ŒæŠŠå…¶ä¸­æœ‰çŠ¶æ€å˜åŒ–çš„é‚»å±…å…¥é˜Ÿã€‚</p><p>ï¼ˆ3ï¼‰è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¼¹å‡ºuä¹‹åï¼Œåœ¨åé¢çš„è®¡ç®—ä¸­uå¯èƒ½ä¼šå†æ¬¡æ›´æ–°çŠ¶æ€(uå€Ÿé“å…¶ä»–ç»“ç‚¹å»sçš„è·¯å¾„æ›´çŸ­)ã€‚æ‰€ä»¥ï¼Œuå¯èƒ½éœ€è¦é‡æ–°å…¥é˜Ÿã€‚</p><p>ï¼ˆ4ï¼‰ç»§ç»­ä»¥ä¸Šè¿‡ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºã€‚è¿™ä¹Ÿæ„å‘³ç€æ‰€æœ‰ç»“ç‚¹çš„çŠ¶æ€ä¸å†æ›´æ–°ï¼Œæœ€åçš„çŠ¶æ€å°±æ˜¯åˆ°èµ·ç‚¹sçš„æœ€çŸ­è·¯å¾„ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">edge</span>&#123;<br>    <span class="hljs-type">int</span> from, to, w8;<br>    <span class="hljs-built_in">edge</span>(<span class="hljs-type">int</span> from, <span class="hljs-type">int</span> to, <span class="hljs-type">int</span> w):<span class="hljs-built_in">from</span>(from), <span class="hljs-built_in">to</span>(to), <span class="hljs-built_in">w8</span>(w) &#123;&#125;<br>&#125;;<br><br>vector&lt;vector&lt;edge&gt;&gt; e; <span class="hljs-comment">// é‚»æ¥è¡¨</span><br>vector&lt;<span class="hljs-type">int</span>&gt; dis;<br>vector&lt;<span class="hljs-type">int</span>&gt; pre; <span class="hljs-comment">// å‰é©±:pre[x] = yï¼Œè¡¨ç¤º x çš„å‰ä¸€ä¸ªç‚¹æ˜¯ y</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">SPFA</span><span class="hljs-params">(<span class="hljs-type">int</span> start)</span> </span>&#123;<br>    queue&lt;<span class="hljs-type">int</span>&gt; q;<br>    <span class="hljs-function">vector&lt;<span class="hljs-type">bool</span>&gt; <span class="hljs-title">vis</span><span class="hljs-params">(e.size(), <span class="hljs-number">0</span>)</span></span>;<br><br>    dis[start] = <span class="hljs-number">0</span>;<br>    q.<span class="hljs-built_in">push</span>(start);<br>    vis[start] = <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">while</span>(!q.<span class="hljs-built_in">empty</span>()) &#123;<br>        <span class="hljs-keyword">auto</span> cur = q.<span class="hljs-built_in">front</span>();<br>        q.<span class="hljs-built_in">pop</span>();<br>        vis[cur] = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; e[cur].<span class="hljs-built_in">size</span>(); i++) &#123;<br>            <span class="hljs-type">int</span> u = e[cur][i].to, w8 = e[cur][i].w8;<br>            <span class="hljs-keyword">if</span> (dis[cur] + w8 &lt; dis[u]) &#123;<br>                dis[u] = dis[cur] + w8;<br>                pre[u] = cur;<br>                <span class="hljs-keyword">if</span> (!vis[u]) &#123;<br>                    vis[u] = <span class="hljs-literal">true</span>;<br>                    q.<span class="hljs-built_in">push</span>(u);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">freopen</span>(<span class="hljs-string">&quot;spfa.in&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, stdin);<br>    ios::<span class="hljs-built_in">sync_with_stdio</span>(<span class="hljs-number">0</span>), cin.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>), cout.<span class="hljs-built_in">tie</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-type">int</span> n, m;<br>    cin &gt;&gt; n &gt;&gt; m; <span class="hljs-comment">// ç‚¹ n è¾¹ m</span><br>    e.<span class="hljs-built_in">resize</span>(n + <span class="hljs-number">1</span>);<br>    dis.<span class="hljs-built_in">resize</span>(n + <span class="hljs-number">1</span>, INT_MAX / <span class="hljs-number">2</span>);<br>    pre.<span class="hljs-built_in">resize</span>(n + <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++) &#123;<br>        <span class="hljs-type">int</span> x, y, weight;<br>        cin &gt;&gt; x &gt;&gt; y &gt;&gt; weight;<br>        e[x].<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">edge</span>(x, y, weight));<br>    &#125;<br>    <span class="hljs-built_in">SPFA</span>(<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= n ;i++) &#123;<br>        cout &lt;&lt; dis[i] &lt;&lt; endl;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ï¼š $ O(mn) $</p><p>ç©ºé—´å¤æ‚åº¦ï¼š $ O(n + m) $</p>]]></content>
    
    
    
    <tags>
      
      <tag>Algorithm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AVLå¹³è¡¡äºŒå‰æ ‘</title>
    <link href="/2024/01/13/AVLTree/"/>
    <url>/2024/01/13/AVLTree/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€.çŸ¥è¯†åŸºç¡€">ä¸€.çŸ¥è¯†åŸºç¡€</h2><p>1.äºŒå‰æ ‘çš„å»ºç«‹ï¼Œéå†</p><p>2.äºŒå‰æœç´¢æ ‘çš„æ„å»ºï¼Œéå†ï¼ŒæŸ¥æ‰¾å’Œåˆ é™¤èŠ‚ç‚¹ã€‚</p><h2 id="äºŒ.avlå¹³è¡¡æ ‘">äºŒ.AVLå¹³è¡¡æ ‘</h2><p>BST: 10 -&gt; 20 -&gt; 30 -&gt; 40 -&gt; 50</p><p>AVL: <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">   <span class="hljs-number">20</span><br> /    \<br><span class="hljs-number">10</span>    <span class="hljs-number">40</span><br>     /  \ <br>   <span class="hljs-number">30</span>    <span class="hljs-number">50</span><br></code></pre></td></tr></table></figure></p><p>å½“ç”ŸæˆäºŒå‰æ ‘æ—¶ï¼Œå¦‚æœæ˜¯æœ‰åºåºåˆ—ï¼ˆé€’å¢æˆ–é€’å‡ï¼‰å®é™…ä¸Šæ˜¯ä¸€åªé“¾è¡¨ï¼ŒAVLå¹³è¡¡äºŒå‰æ ‘ç”¨äºæé«˜äºŒå‰æ ‘çš„æŸ¥æ‰¾æ•ˆç‡ã€‚</p><p>10å·¦å­æ ‘æ ‘é«˜ï¼š0</p><p>å³å­æ ‘æ ‘é«˜ï¼š4</p><p>å¦‚å›¾ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œç›¸åŒçš„æ“ä½œ:</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/AVL%E6%88%AA%E5%B1%8F2024-01-13%2021.23.55.png" /></p><p>ç›®æ ‡ï¼šä½¿æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³æ ‘é«˜ç»å¯¹å·®å€¼å°½å¯èƒ½å°ï¼Œæˆ‘ä»¬å¯å¼•å‡ºæ¦‚å¿µï¼š</p><p>å¹³è¡¡å› å­ï¼šå·¦å­æ ‘-å³å­æ ‘é«˜åº¦ï¼ˆå¹³è¡¡å› å­ç»å¯¹å€¼&lt;=1ï¼‰</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/AVL%E6%88%AA%E5%B1%8F2024-01-13%2021.25.08.png" /></p><p>å¦‚æœå¹³è¡¡å› å­ç»å¯¹å€¼ &gt; 1ï¼Œæ€ä¹ˆåŠå‘¢ï¼š</p><p>a.å·¦æ—‹</p><p>step1.å½“å‰èŠ‚ç‚¹çš„å³å­æ ‘ä½œä¸ºæ–°æ ‘çš„æ ¹èŠ‚ç‚¹</p><p>step2.å½“å‰èŠ‚ç‚¹ä½œä¸ºæ ¹èŠ‚ç‚¹å·¦èŠ‚ç‚¹</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/AVL%E6%88%AA%E5%B1%8F2024-01-13%2021.29.25.png" /></p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/AVL%E6%88%AA%E5%B1%8F2024-01-13%2021.31.11.png" /></p><p>æ»¡è¶³æ—‹è½¬åæ»¡è¶³ï¼š1.æ˜¯BST 2.æ¯ä¸ªå¹³è¡¡å› å­&lt;=1</p><p>b.å³æ—‹</p><p>c.äºŒå‰æ ‘çš„å¤±è¡¡</p><p>ä»€ä¹ˆæ—¶å€™ä¼šé‡åˆ°å¤±è¡¡ï¼Ÿ</p><p>1.æ’å…¥èŠ‚ç‚¹æ—¶</p><p>(1)root leftæ’å…¥å·¦å­æ ‘left(LLå¤±è¡¡)</p><p>åº”ç”¨ä¸€æ¬¡å³æ—‹</p><p>(2)LRå¤±è¡¡</p><p>root left å·¦æ—‹ï¼Œè½¬åŒ–ä¸ºé€’å‡æœç´¢æ ‘ï¼Œå†å°† root å³æ—‹å³å¯ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/AVL%E6%88%AA%E5%B1%8F2024-01-13%2021.46.09.png" /></p><p>(3)RRå¤±è¡¡:rootå·¦æ—‹</p><p>(4)RLå¤±è¡¡ï¼š</p><p>root right å³æ—‹ ï¼Œè½¬åŒ–ä¸ºé€’å¢æœç´¢æ ‘ï¼Œå†å°† root å·¦æ—‹å³å¯ã€‚</p><p>ä»¥ä¸‹æ˜¯å®Œæ•´ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">//å®šä¹‰æ—‹è½¬æ“ä½œ</span><br><span class="hljs-function">TreeNode* <span class="hljs-title">leftRotate</span><span class="hljs-params">(TreeNode* &amp;root)</span> </span>&#123;<br>  TreeNode* newRoot = root-&gt;right;<br>  TreeNode* buff = newRoot-&gt;left;<br>  newRoot-&gt;left = root;<br>  root-&gt;right = buff;<br><br>  root-&gt;height = <span class="hljs-built_in">getHeight</span>(root);<br>  newRoot-&gt;height = <span class="hljs-built_in">getHeight</span>(newRoot);<br><br>  <span class="hljs-keyword">return</span> newRoot;<br>&#125;<br><span class="hljs-function">TreeNode* <span class="hljs-title">rightRotate</span><span class="hljs-params">(TreeNode* &amp;root)</span> </span>&#123;<br>  TreeNode* newRoot = root-&gt;left;<br>  TreeNode* buff = newRoot-&gt;right;<br>  newRoot-&gt;right = root;<br>  root-&gt;left = buff;<br><br>  root-&gt;height = <span class="hljs-built_in">getHeight</span>(root);<br>  newRoot-&gt;height = <span class="hljs-built_in">getHeight</span>(newRoot);<br><br>  <span class="hljs-keyword">return</span> newRoot;<br>&#125;<br><br><span class="hljs-comment">// äºŒå‰æœç´¢æ ‘æ’å…¥</span><br><span class="hljs-comment">/* void BSTInsert(TreeNode* &amp;T, int data) &#123; */</span><br><span class="hljs-comment">/*   if (T == nullptr) &#123; */</span><br><span class="hljs-comment">/*     T = new TreeNode(data); */</span><br><span class="hljs-comment">/*   &#125; else &#123; */</span><br><span class="hljs-comment">/*     if (data &gt; T-&gt;value) &#123; */</span><br><span class="hljs-comment">/*       BSTInsert(T-&gt;right, data); */</span><br><span class="hljs-comment">/*     &#125; else &#123; */</span><br><span class="hljs-comment">/*       BSTInsert(T-&gt;left, data); */</span><br><span class="hljs-comment">/*     &#125; */</span><br><span class="hljs-comment">/*   &#125; */</span><br><span class="hljs-comment">/*   T-&gt;height = getHeight(T); */</span><br><span class="hljs-comment">/*   // AVLå¹³è¡¡äºŒå‰æ ‘æ—‹è½¬ */</span><br><span class="hljs-comment">/**/</span><br><span class="hljs-comment">/*   if (getBalance(T) &gt; 1 &amp;&amp; getBalance(T-&gt;left) &gt; 0) &#123; */</span><br><span class="hljs-comment">/**/</span><br><span class="hljs-comment">/*   &#125; */</span><br><span class="hljs-comment">/* &#125; */</span><br><br><span class="hljs-function">TreeNode* <span class="hljs-title">BSTInsert</span><span class="hljs-params">(TreeNode* node, <span class="hljs-type">int</span> value)</span> </span>&#123;<br>  <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">nullptr</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TreeNode</span>(value);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (value &gt; node-&gt;value) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">BSTInsert</span>(node-&gt;right, value);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value &lt; node-&gt;value) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">BSTInsert</span>(node-&gt;left,value);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">//value == node-&gt;value</span><br>    cout &lt;&lt; <span class="hljs-string">&quot;invalid&quot;</span> &lt;&lt; endl;<br>    <span class="hljs-keyword">return</span> node;<span class="hljs-comment">//æ˜“é”™ï¼šè¿”å›ç©ºæŒ‡é’ˆ</span><br>  &#125;<br>  node-&gt;height = <span class="hljs-built_in">getHeight</span>(node);<br>  <br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">getBalance</span>(node) &gt; <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-built_in">getBalance</span>(node-&gt;left) &gt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">rightRotate</span>(node);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">getBalance</span>(node) &gt; <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-built_in">getBalance</span>(node-&gt;left) &lt; <span class="hljs-number">0</span>) &#123;<br>    node-&gt;left = <span class="hljs-built_in">leftRotate</span>(node-&gt;left);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">rightRotate</span>(node);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">getBalance</span>(node) &lt; <span class="hljs-number">-1</span> &amp;&amp; <span class="hljs-built_in">getBalance</span>(node-&gt;right) &lt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">leftRotate</span>(node);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">getBalance</span>(node) &lt; <span class="hljs-number">-1</span> &amp;&amp; <span class="hljs-built_in">getBalance</span>(node-&gt;right) &gt; <span class="hljs-number">0</span>) &#123;<br>    node-&gt;right = <span class="hljs-built_in">rightRotate</span>(node-&gt;right);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">leftRotate</span>(node);<br>  &#125;<br>  <span class="hljs-keyword">return</span> node;<span class="hljs-comment">//æ³¨æ„ï¼ï¼ï¼</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>2.åˆ é™¤èŠ‚ç‚¹æ—¶</p><p>åˆ é™¤èŠ‚ç‚¹å¯¼è‡´äºŒå‰æ ‘å¤±è¡¡ä¹Ÿåˆ†ä¸ºå››ç§æƒ…å†µï¼šLL LR RR RL</p><p>ä½†è¦æ³¨æ„ç‰¹æ®Šæƒ…å†µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“åˆ é™¤äº†rootçš„å³å­æ ‘ï¼Œå·¦å­æ ‘çš„å¹³è¡¡å› å­=0ï¼Œæ­¤æ—¶ä»ä¸ºLLå¤±è¡¡ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/AVL%E6%88%AA%E5%B1%8F2024-01-14%2016.17.56.png" /></p><p>åªéœ€è¦ç»™LLå’ŒRRåŠ ä¸Šç­‰äºå·å³å¯ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs CPP"><span class="hljs-comment">// äºŒå‰æœç´¢æ ‘åˆ é™¤èŠ‚ç‚¹</span><br><span class="hljs-function">TreeNode *<span class="hljs-title">BSTDelete</span><span class="hljs-params">(TreeNode *node, <span class="hljs-type">int</span> val)</span> </span>&#123;<br>  <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">nullptr</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>; <span class="hljs-comment">// ç©ºæŒ‡é’ˆå¤„ç†</span><br><br>  <span class="hljs-keyword">if</span> (node-&gt;value &gt; val) &#123;<br>    node-&gt;left = <span class="hljs-built_in">BSTDelete</span>(node-&gt;left, val); <span class="hljs-comment">// èŠ‚ç‚¹çš„å·¦å­æ ‘æœ‰ç›®æ ‡åˆ é™¤èŠ‚ç‚¹</span><br>    <span class="hljs-keyword">return</span> node;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (node-&gt;value &lt; val) &#123; <span class="hljs-comment">// èŠ‚ç‚¹çš„å³å­æ ‘æœ‰ç›®æ ‡åˆ é™¤èŠ‚ç‚¹</span><br>    node-&gt;right = <span class="hljs-built_in">BSTDelete</span>(node-&gt;right, val);<br>    <span class="hljs-keyword">return</span> node;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (node-&gt;value == val) &#123; <span class="hljs-comment">// æ‰¾åˆ°åˆ é™¤èŠ‚ç‚¹ï¼Œåˆ†ä¸ºå››ç§æƒ…å†µ1.æ²¡æœ‰å·¦å³å­æ ‘</span><br><br>    <span class="hljs-keyword">if</span> (node-&gt;left == <span class="hljs-literal">nullptr</span> &amp;&amp; node-&gt;right == <span class="hljs-literal">nullptr</span>) &#123;<br>      <span class="hljs-keyword">delete</span> node;<br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node-&gt;left != <span class="hljs-literal">nullptr</span> &amp;&amp; node-&gt;right == <span class="hljs-literal">nullptr</span>) &#123;<br>      TreeNode *temp = node-&gt;left; <span class="hljs-comment">// ä¸´æ—¶ä¿å­˜T</span><br>      <span class="hljs-keyword">delete</span> node;<br>      <span class="hljs-keyword">return</span> temp;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node-&gt;left == <span class="hljs-literal">nullptr</span> &amp;&amp; node-&gt;right != <span class="hljs-literal">nullptr</span>) &#123;<br>      TreeNode *temp = node-&gt;right; <span class="hljs-comment">// ä¸´æ—¶ä¿å­˜T</span><br>      <span class="hljs-keyword">delete</span> node;<br>      <span class="hljs-keyword">return</span> temp;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// å·¦å³éƒ½æœ‰ï¼Œä¸¤ç§è§£å†³æ–¹æ¡ˆ</span><br>      <span class="hljs-comment">// solution1.å³å­æ ‘åŠ åˆ°å·¦å­æ ‘</span><br>      TreeNode *cur = node-&gt;left;<br>      <span class="hljs-keyword">while</span> (cur-&gt;right != <span class="hljs-literal">nullptr</span>)<br>        cur = cur-&gt;right;<br>      cur-&gt;right = node-&gt;right;<br>      TreeNode *temp = node-&gt;left;<br>      <span class="hljs-keyword">delete</span> node;<br>      <span class="hljs-keyword">return</span> temp;<br><br>      <span class="hljs-comment">// solution2.å·¦å­æ ‘åŠ åˆ°å³å­æ ‘</span><br>      <span class="hljs-comment">/* TreeNode* cur = T-&gt;right; */</span><br>      <span class="hljs-comment">/* while(cur-&gt;left!= nullptr) cur = cur-&gt;left; */</span><br>      <span class="hljs-comment">/* cur-&gt;left = T-&gt;left; */</span><br>      <span class="hljs-comment">/* TreeNode* temp = T-&gt;right; */</span><br>      <span class="hljs-comment">/* delete T; */</span><br>      <span class="hljs-comment">/* return temp; */</span><br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>  <span class="hljs-comment">// åˆ é™¤å®Œæˆä¸‹é¢å¼€å§‹è°ƒæ•´</span><br>  <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">nullptr</span>) &#123;<br>    <span class="hljs-keyword">return</span> node;<br>  &#125;<br>  <span class="hljs-comment">// æ›´æ–°æ ‘é«˜</span><br>  node-&gt;height = <span class="hljs-built_in">getHeight</span>(node);<br><br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">getBalance</span>(node) &gt; <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-built_in">getBalance</span>(node-&gt;left) &gt;= <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">rightRotate</span>(node);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">getBalance</span>(node) &gt; <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-built_in">getBalance</span>(node-&gt;left) &lt; <span class="hljs-number">0</span>) &#123;<br>    node-&gt;left = <span class="hljs-built_in">leftRotate</span>(node-&gt;left);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">rightRotate</span>(node);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">getBalance</span>(node) &lt; <span class="hljs-number">-1</span> &amp;&amp; <span class="hljs-built_in">getBalance</span>(node-&gt;right) &lt;= <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">leftRotate</span>(node);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">getBalance</span>(node) &lt; <span class="hljs-number">-1</span> &amp;&amp; <span class="hljs-built_in">getBalance</span>(node-&gt;right) &gt; <span class="hljs-number">0</span>) &#123;<br>    node-&gt;right = <span class="hljs-built_in">rightRotate</span>(node-&gt;right);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">leftRotate</span>(node);<br>  &#125;<br>  <span class="hljs-keyword">return</span> node;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æ—‹è½¬çŸ©é˜µè§£ç®—æ¬§æ‹‰è§’</title>
    <link href="/2023/12/20/matrixEular/"/>
    <url>/2023/12/20/matrixEular/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€.æ—‹è½¬çŸ©é˜µ">ä¸€.æ—‹è½¬çŸ©é˜µ</h2><center><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-38f253e4128e2809f85fb42121f5eff2_720w.webp" /></p><p><span class="math inline">\(x&#39;=|OP|\,cos(\alpha +\beta)=|OP|(cos\alpha cos\beta - sin\alphasin\beta)=xcos\beta-ysin\beta\)</span></p><span class="math inline">\(y&#39;=|OP|sin(\alpha + \beta) =|OP|(sin\alpha cos\beta+cos\alpha sin\beta) =ycos\beta+xsin\beta\)</span></center>æ”¹å†™çŸ©é˜µå½¢å¼ï¼š<center><p><spanclass="math inline">\(\begin{bmatrix}x&#39;\\y&#39;\end{bmatrix} =\begin{bmatrix}cos\beta\,-sin\beta\\sin\beta\,\,\,\,\,cos\beta\end{bmatrix}\begin{bmatrix}x\\y\end{bmatrix}\)</span></p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-0a18ca4a6a06fa2da2e68010d57adc54_720w.webp" /></p><p><spanclass="math inline">\(\begin{bmatrix}x&#39;\\y&#39;\\z&#39;\end{bmatrix}=\begin{bmatrix}cos\beta\,-sin\beta\,\,0\\sin\beta\,\,\,\,\,cos\beta\,\,\,\,\,0\\\,\,\,\,\,0\,\,\,\,\,\,\,\,\,\,\,\,0\,\,\,\,\,\,\,\,\,\,\,1\end{bmatrix}\begin{bmatrix}x\\y\\z\end{bmatrix}\)</span></p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-da669f4d1d9f5852bc926a185254b5d3_720w.webp" /></p><p><spanclass="math inline">\(\begin{bmatrix}x&#39;\\y&#39;\\z&#39;\end{bmatrix}=\begin{bmatrix}cos\beta\,0\,\,sin\beta\\0\,\,\,\,\,1\,\,\,\,\,0\\\,\,\,\,\,-sin\beta\,\,\,\,\,\,\,\,\,\,\,\,0\,\,\,\,\,\,\,\,\,\,\,cos\beta\end{bmatrix}\begin{bmatrix}x\\y\\z\end{bmatrix}\)</span>ï¼ˆyæœ‰ç‚¹ä¸åŒï¼‰</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-fbee9db2b50dd93f3fa4576b3062791d_720w.webp" /></p><spanclass="math inline">\(\begin{bmatrix}x&#39;\\y&#39;\\z&#39;\end{bmatrix}=\begin{bmatrix}1\,0\,\,0\\0\,\,\,\,\,cos\beta\,\,\,\,\,-sin\beta\\\,\,\,\,\,0\,\,\,\,\,\,\,\,\,\,\,\,sin\beta\,\,\,\,\,\,\,\,\,\,\,cos\beta\end{bmatrix}\begin{bmatrix}x\\y\\z\end{bmatrix}\)</span></center><p>æ—‹è½¬çŸ©é˜µ<span class="math inline">\(A\)</span>ä¸é€†çŸ©é˜µ<spanclass="math inline">\(A^{-1}\)</span>è§’åº¦ç›¸åŒï¼Œæ—‹è½¬æ–¹å‘ç›¸åã€‚</p><p>åæ ‡ç³»æ—‹è½¬ä¸å‘é‡æ—‹è½¬äº’ä¸ºé€†è¿‡ç¨‹<strong>åæ ‡ç³»æ—‹è½¬</strong>çš„æ—‹è½¬çŸ©é˜µä¸ä¸Šé¢<strong>å‘é‡æ—‹è½¬</strong>çš„æ—‹è½¬çŸ©é˜µæ­£å¥½æ˜¯<strong>è½¬ç½®çš„å…³ç³»</strong>(å®é™…ä¸Šæ˜¯<strong>é€†çŸ©é˜µ</strong>ï¼Œå› ä¸ºæ­£äº¤é˜µçš„é€†çŸ©é˜µä¸è½¬ç½®çŸ©é˜µç›¸åŒ)ï¼Œå› ä¸ºè¿™ä¸¤ç§æ—‹è½¬æœ¬è´¨ä¸Šæ˜¯ç›¸å¯¹è¿åŠ¨ï¼Œäº’ä¸ºé€†è¿‡ç¨‹ã€‚</p><h2 id="äºŒ.æ¬§æ‹‰è§’æ—‹è½¬">äºŒ.æ¬§æ‹‰è§’æ—‹è½¬</h2><h3 id="é™æ€å®šä¹‰">é™æ€å®šä¹‰</h3><p>å¯¹äºåœ¨ä¸‰ç»´ç©ºé—´é‡Œçš„ä¸€ä¸ª<strong>å‚è€ƒç³»</strong>ï¼Œä»»ä½•<strong>åæ ‡ç³»</strong>çš„å–å‘ï¼Œéƒ½å¯ä»¥ç”¨ä¸‰ä¸ªæ¬§æ‹‰è§’æ¥è¡¨ç°ã€‚</p><ul><li><p><strong>å‚è€ƒç³»</strong>åˆç§°ä¸ºå®éªŒå®¤å‚è€ƒç³»ï¼Œæ˜¯é™æ­¢ä¸åŠ¨çš„ï¼Œå¯ä»¥å…ˆç®€å•çš„ç†è§£ç†è§£ä¸º<strong>å¤§åœ°åæ ‡ç³»</strong>ï¼Œä¹Ÿç§°<strong>æƒ¯æ€§åæ ‡ç³»</strong>ã€‚</p></li><li><p><strong>åæ ‡ç³»</strong>åˆ™å›ºå®šäºåˆšä½“ï¼Œéšè‘—åˆšä½“çš„æ—‹è½¬è€Œæ—‹è½¬ï¼Œæ¯”å¦‚<strong>é£è¡Œå™¨è‡ªèº«çš„åæ ‡ç³»</strong>ï¼Œä¹Ÿç§°<strong>è½½ä½“åæ ‡ç³»</strong>ã€‚</p><center><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-5542d4a1edb53d1ec8ae39e99926bacc_720w.webp" /></p></center></li></ul><p>å¦‚ä¸Šå›¾ä¸ºä¸€ç§<strong>ZYZé¡ºåºæ—‹è½¬</strong>çš„æ¬§æ‹‰è§’ç¤ºæ„å›¾ï¼š</p><ul><li><p>è®¾è“è‰²çš„<strong>xyz-è½´</strong>ä¸ºæƒ¯æ€§ç³»çš„å‚è€ƒè½´ï¼Œå³å¤§åœ°åæ ‡ç³»çš„3ä¸ªè½´ã€‚</p></li><li><p>è®¾çº¢è‰²çš„<strong>XYZ-è½´</strong>ä¸ºè½½ä½“ç³»çš„å‚è€ƒè½´ï¼Œå³é£è¡Œå™¨åæ ‡ç³»çš„3ä¸ªè½´ã€‚</p></li><li><p>ç§°<strong>xy-å¹³é¢</strong>ä¸<strong>XY-å¹³é¢</strong>çš„ç›¸äº¤ä¸º<strong>äº¤ç‚¹çº¿</strong>ï¼Œç”¨è‹±æ–‡<strong>å­—æ¯N</strong>è¡¨ç¤ºã€‚</p></li></ul><p>å›¾ä¸­çš„è§’åº¦ç¬¦å·ï¼š</p><ul><li><p>Î±æ˜¯x-è½´ä¸äº¤ç‚¹çº¿çš„å¤¹è§’ï¼Œè½½ä½“åæ ‡ç³»å…ˆç»•Zè½´æ—‹è½¬äº†Î±è§’åº¦ï¼ˆèŒƒå›´0~2Piå¼§åº¦ï¼‰ã€‚</p></li><li><p>Î²æ˜¯z-è½´ä¸Z-è½´çš„å¤¹è§’ï¼Œè½½ä½“åæ ‡ç³»åˆç»•å½“å‰çš„Yè½´æ—‹è½¬äº†Î²è§’åº¦ï¼ˆèŒƒå›´<strong>0~Pi</strong>å¼§åº¦ï¼‰ã€‚</p></li><li><p>Î³æ˜¯äº¤ç‚¹çº¿ä¸X-è½´çš„å¤¹è§’ï¼Œè½½ä½“åæ ‡ç³»åˆç»•å½“å‰çš„Zè½´æ—‹è½¬äº†Î³è§’åº¦ï¼ˆèŒƒå›´0~2Piå¼§åº¦ï¼‰ã€‚</p></li><li><p>è¿™é‡Œè§’åº¦çš„æ­£è´Ÿæ˜¯æŒ‰ç…§<strong>å³æ‰‹å®šåˆ™</strong>ï¼Œå¦‚å³æ‰‹å¤§æ‹‡æŒ‡æŒ‡å‘z-è½´ï¼Œå››æŒ‡å¼¯æ›²çš„æ—‹è½¬æ–¹å‘ä¸ºÎ±æ­£æ–¹å‘ã€‚</p></li></ul><p>å®é™…ä¸Šï¼Œå¯¹äºå¤¹è§’çš„é¡ºåºå’Œæ ‡è®°ï¼Œå¤¹è§’çš„ä¸¤ä¸ªè½´çš„æŒ‡å®šï¼Œå¹¶æ²¡æœ‰æ˜ç¡®çš„è§„å®šã€‚å› æ­¤å½“ç”¨åˆ°æ¬§æ‹‰è§’æ—¶ï¼Œéœ€è¦æ˜ç¡®åœ°è¡¨ç¤ºå‡ºå¤¹è§’çš„é¡ºåºï¼ŒæŒ‡å®šå…¶å‚è€ƒè½´ã€‚åˆæ³•çš„æ¬§æ‹‰è§’ç»„ä¸­ï¼Œå”¯ä¸€çš„é™åˆ¶æ˜¯ï¼Œä»»ä½•ä¸¤ä¸ªè¿ç»­çš„æ—‹è½¬ï¼Œå¿…é¡»ç»•ç€ä¸åŒçš„è½¬åŠ¨è½´æ—‹è½¬ã€‚å› æ­¤ï¼Œä¸€å…±æœ‰12ç§è¡¨ç¤ºã€‚</p><ul><li><p>6ç§ç»•ä¸‰æ¡è½´çš„æ—‹è½¬ï¼ˆ<strong>Tait-Bryan Angle</strong>ï¼‰ï¼šXYZ, XZY,YXZ, YZX, ZXY, <strong>ZYX</strong></p></li><li><p>6ç§åªç»•ä¸¤æ¡è½´çš„æ—‹è½¬ï¼ˆ<strong>Proper Euler Angle</strong>ï¼‰ï¼šXYX,YXY, XZX, ZXZ, YZY, ZYZ</p></li></ul><h3 id="åŠ¨æ€å®šä¹‰">åŠ¨æ€å®šä¹‰</h3><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™äºˆæ¬§æ‹‰è§’ä¸¤ç§ä¸åŒçš„åŠ¨æ€å®šä¹‰ã€‚ä¸€ç§æ˜¯ç»•<strong>å›ºå®šäºè½½ä½“çš„åæ ‡è½´</strong>çš„ä¸‰ä¸ªæ—‹è½¬çš„å¤åˆï¼›å¦å¤–ä¸€ç§æ˜¯ç»•<strong>å¤§åœ°åæ ‡ç³»å‚è€ƒè½´</strong>çš„ä¸‰ä¸ªæ—‹è½¬çš„å¤åˆã€‚</p><p>ç”¨åŠ¨æ€çš„å®šä¹‰ï¼Œæˆ‘ä»¬èƒ½æ›´äº†è§£ï¼Œæ¬§æ‹‰è§’åœ¨ç‰©ç†ä¸Šçš„å«ä¹‰ä¸åº”ç”¨ã€‚</p><p>æ³¨æ„ï¼Œä»¥ä¸‹çš„æè¿°,<strong>å¤§å†™å­—æ¯XYZåæ ‡è½´</strong>æ˜¯æ—‹è½¬çš„è½½ä½“åæ ‡è½´ï¼›<strong>å°å†™å­—æ¯xyzåæ ‡è½´</strong>æ˜¯é™æ­¢ä¸åŠ¨çš„å¤§åœ°å‚è€ƒè½´ã€‚</p><p>ç°åœ¨ä»¥<strong>æ—‹è½¬é¡ºåº</strong>ä¾æ¬¡æ˜¯<strong>Zã€Yã€X</strong>çš„æ–¹å¼æ¥æè¿°æ¬§æ‹‰è§’çš„ä¸¤ç§åŠ¨æ€å®šä¹‰ã€‚</p><ul><li><p><strong>å®šä¹‰Aï¼šç»•ç€XYZåæ ‡è½´æ—‹è½¬</strong>ï¼ˆè½½ä½“åæ ‡è½´ï¼‰ï¼š</p></li><li><p>æœ€åˆï¼Œä¸¤ä¸ªåæ ‡ç³»ç»Ÿxyzä¸XYZçš„åæ ‡è½´éƒ½æ˜¯é‡å çš„ã€‚</p></li><li><p>å¼€å§‹ï¼Œç»•ç€Z-è½´æ—‹è½¬Î±è§’åº¦ã€‚</p></li><li><p>ç„¶åï¼Œç»•ç€Y-è½´æ—‹è½¬Î²è§’åº¦ã€‚</p></li><li><p>æœ€åï¼Œç»•ç€X-è½´æ—‹è½¬Î³è§’åº¦ã€‚</p></li></ul><p>è®¾ä»»ä½•ä¸€ç‚¹P1åœ¨xyzä¸XYZåæ ‡ç³»ç»Ÿçš„åæ ‡åˆ†åˆ«ä¸ºr1ä¸R1ã€‚å®šä¹‰Z(Î±)ä¸ºç»•ç€Z-è½´æ—‹è½¬Î±è§’åº¦ï¼ŒY(Î²)ä¸ºç»•ç€Y-è½´æ—‹è½¬Î²è§’åº¦ï¼ŒX(Î³)ä¸ºç»•ç€X-è½´æ—‹è½¬Î³è§’åº¦ã€‚åˆ™å®šä¹‰Aå¯ä»¥è¡¨è¿°å¦‚ä¸‹ï¼š</p><center><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-45983061372651d5806873334cdbaa8b_720w.webp" /></center><p>æ³¨æ„è¿™é‡Œåˆæœ‰<strong>çŸ©é˜µå·¦ä¹˜ä¸å³ä¹˜</strong>çš„æ¦‚å¿µï¼Œç»•è½½ä½“åæ ‡ç³»æ—‹è½¬æ˜¯<strong>çŸ©é˜µä¾æ¬¡å·¦ä¹˜</strong>ï¼Œå³<strong>X&lt;- Y &lt;- Z</strong>ã€‚</p><ul><li><p><strong>å®šä¹‰Bï¼šç»•ç€xyzåæ ‡è½´æ—‹è½¬</strong>ï¼ˆå¤§åœ°åæ ‡è½´ï¼‰ï¼š</p></li><li><p>æœ€åˆï¼Œä¸¤ä¸ªåæ ‡ç³»ç»Ÿxyzä¸XYZçš„åæ ‡è½´éƒ½æ˜¯é‡å çš„ã€‚</p></li><li><p>å¼€å§‹ï¼Œç»•ç€z-è½´æ—‹è½¬Î±è§’åº¦ã€‚</p></li><li><p>ç„¶åï¼Œç»•ç€y-è½´æ—‹è½¬Î²è§’åº¦ã€‚</p></li><li><p>æœ€åï¼Œç»•ç€x-è½´æ—‹è½¬Î³è§’åº¦ã€‚</p></li></ul><p>è®¾ä»»ä½•ä¸€ç‚¹P2åœ¨xyzä¸XYZåæ ‡ç³»ç»Ÿçš„åæ ‡åˆ†åˆ«ä¸ºr2ä¸R2ã€‚å®šä¹‰z(Î±)ä¸ºç»•ç€z-è½´æ—‹è½¬Î±è§’åº¦ï¼Œy(Î²)ä¸ºç»•ç€y-è½´æ—‹è½¬Î²è§’åº¦ï¼Œx(Î³)ä¸ºç»•ç€x-è½´æ—‹è½¬Î³è§’åº¦ã€‚åˆ™å®šä¹‰Bå¯ä»¥è¡¨è¿°å¦‚ä¸‹ï¼š</p><center><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-bd3cd2568708713e3c1c8a35a58664fb_720w.webp" /></center><p>æ³¨æ„ç»•å¤§åœ°åæ ‡ç³»æ—‹è½¬æ˜¯<strong>çŸ©é˜µä¾æ¬¡å³ä¹˜</strong>ï¼Œå³<strong>z-&gt; y -&gt; x</strong>ã€‚</p><p>å®šä¹‰Aä¸é™æ€å®šä¹‰çš„ç›¸ç­‰ï¼Œè¿™å¯ä»¥ç›´æ¥ç”¨å‡ ä½•åˆ¶å›¾æ–¹æ³•æ¥æ ¸å¯¹ã€‚</p><p><strong>å®šä¹‰Aä¸å®šä¹‰Bçš„ç›¸ç­‰</strong>å¯ä»¥ç”¨æ—‹è½¬çŸ©é˜µæ¥è¯æ˜ï¼š</p><center><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-bc2da96876f5527ffca48120c9561f77_720w.webp" /></center><h2 id="ä¸‰.åŠ é€Ÿåº¦è®¡è§£ç®—">ä¸‰.åŠ é€Ÿåº¦è®¡è§£ç®—</h2><p>å§¿æ€çš„æ—‹è½¬é€‰ç”¨ZYXé¡ºåºçš„3æ¬¡æ—‹è½¬æ–¹å¼ï¼Œåˆ™ä¸Šè¿°æè¿°å¯è¡¨ç¤ºä¸ºï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-3dc75acdc5b5e64f2af9b3fb28b368de_720w.webp" /></p><center><p><spanclass="math inline">\(a_x=-g\,sin\,pitch(1)\\a_y=cos\,pitch\,sin\,roll\,g(2)\\a_z=cos\,pitch\,cos\,roll\,g(3)\)</span></p><p>(2)/(3)ï¼š <span class="math inline">\(\frac{a_y}{a_z}=tan\,roll=&gt;roll = arctan\frac{a_y}{a_z}\)</span></p><p><span class="math inline">\(\sqrt{(2)^2+(3)^2}ï¼š\)</span> <spanclass="math inline">\(\sqrt{a_y^2 + a_z^2}=cospitch \,g(4)\)</span></p>ï¼ˆ1ï¼‰/ï¼ˆ4ï¼‰ï¼š <span class="math inline">\(pitch =-arctan\frac{a_x}{\sqrt{a_y^2+a_z^2}}\)</span></center><p>è§£è¿™ä¸ªæ–¹ç¨‹ï¼Œå¯ä»¥å¾—åˆ°rollå’Œpitchè§’ï¼ˆç”±äºç»•Zæ—‹è½¬æ—¶ï¼Œæ„Ÿå—åˆ°çš„é‡åŠ›åŠ é€Ÿåº¦æ˜¯ä¸å˜çš„ï¼Œå› æ­¤åŠ é€Ÿåº¦è®¡æ— æ³•è®¡ç®—yawè§’ï¼‰</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-0c08fbd578d1aa64ea64c617c6eac39a_720w.webp" /></p><p>3æ¬¡æ—‹è½¬è¿‡ç¨‹çš„åˆ†è§£è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-4ea6ee4cd2b5e33586959d13a3fef083_720w.webp" /></p><h2 id="å››.è§’é€Ÿåº¦è®¡è§£ç®—">å››.è§’é€Ÿåº¦è®¡è§£ç®—</h2><p>é™€èºä»ªæµ‹é‡çš„ç»•3ä¸ªè½´è½¬åŠ¨çš„è§’é€Ÿåº¦ï¼Œå› æ­¤ï¼Œå¯¹è§’é€Ÿåº¦ç§¯åˆ†ï¼Œå¯ä»¥å¾—åˆ°è§’åº¦ã€‚é™€èºä»ªçš„è‹±æ–‡ç®€å†™ä¸ºgyroï¼Œä¸‹é¢ç”¨<strong>é¦–å­—æ¯g</strong>ä»£è¡¨é™€èºä»ªæ•°æ®ã€‚</p><p>å¦‚ä¸‹å›¾ï¼ŒIMUåœ¨ç¬¬nä¸ªæ—¶åˆ»çš„å§¿æ€è§’åº¦ä¸ºrã€pã€yï¼Œå…¶å«ä¹‰ä¸ºIMUåæ ‡ç³»ä»åˆå§‹ä½ç½®ï¼Œç»è¿‡ç»•Zæ—‹è½¬yè§’åº¦ï¼Œç»•Yæ—‹è½¬pè§’åº¦ï¼Œç»•Xæ—‹è½¬rè§’åº¦ï¼Œå¾—åˆ°äº†æœ€ç»ˆçš„å§¿æ€ï¼Œæ­¤æ—¶éœ€è¦è®¡ç®—ä¸‹ä¸€ä¸ªæ—¶åˆ»(n+1)çš„å§¿æ€ã€‚è®¾n+1æ—¶åˆ»çš„å§¿æ€è§’ä¸ºr+Î”rã€p+Î”pã€y+Î”yï¼Œè¯¥å§¿æ€ä¹Ÿæ˜¯ç»å†äº†3æ¬¡æ—‹è½¬ã€‚è¦æƒ³è®¡ç®—n+1æ—¶åˆ»çš„å§¿æ€ï¼Œåªè¦åœ¨næ—¶åˆ»å§¿æ€çš„åŸºç¡€ä¸Šï¼ŒåŠ ä¸Šå¯¹åº”çš„å§¿æ€è§’åº¦å˜åŒ–é‡å³å¯ã€‚å§¿æ€è§’åº¦çš„å˜åŒ–é‡å¯ä»¥é€šè¿‡è§’é€Ÿåº¦ä¸é‡‡ç”¨æ—¶é—´å‘¨æœŸç§¯åˆ†å³å¯ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-8ccc744d3fc64f86e3133ac836b2e0cb_720w.webp" /></p><p>è¿™é‡Œ<strong>çº¢æ¡†ä¸­dr/dtç­‰è§’é€Ÿåº¦</strong>å®é™…æ˜¯å‡æƒ³çš„è§’é€Ÿåº¦ï¼Œç”¨äº<strong>å§¿æ€æ›´æ–°</strong>ï¼Œå§¿æ€æ›´æ–°æ˜¯ä»¥å¤§åœ°åæ ‡ç³»ä¸ºå‚è€ƒï¼Œè€Œé™€èºä»ªåœ¨ç¬¬nä¸ªçŠ¶æ€è¯»å‡ºçš„è§’é€Ÿåº¦æ˜¯ä»¥å®ƒè‡ªå·±æ‰€åœ¨çš„åæ ‡ç³»ä¸ºå‚è€ƒï¼Œéœ€è¦å°†è¯»åˆ°çš„gyroé™€èºæ•°æ®ç»è¿‡å˜æ¢ï¼Œæ‰èƒ½ç”¨äºè®¡ç®—æ›´æ–°ç¬¬n+1æ¬¡çš„å§¿æ€ã€‚</p><p>é‚£dr/dtç­‰è§’é€Ÿåº¦è¯¥æ€æ ·ç†è§£å‘¢ï¼Ÿçœ‹ä¸‹é¢è¿™ä¸ªå›¾ï¼Œè¿˜æ˜¯å°†å…¶åˆ†è§£ä¸º3æ¬¡æ—‹è½¬ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-f42b5d1dbdaac7e99cb91f2f9bafbb87_720w.webp" /></p><p><strong>é¦–å…ˆæ¥çœ‹dy/dt</strong>ï¼Œå®ƒæ˜¯3æ¬¡æ—‹è½¬è¿‡ç¨‹ä¸­<strong>ç»•Zè½´çš„yawè§’çš„è§’é€Ÿåº¦</strong>ï¼Œ3æ¬¡æ—‹è½¬é¦–å…ˆå°±æ˜¯ç»•ç€Zè½´æ—‹è½¬ï¼ŒZè½´æ–¹å‘çš„å•ä½å‘é‡å¯è¡¨ç¤ºä¸º[00 1]Tï¼ŒTè¡¨ç¤ºå‘é‡è½¬ç½®ï¼Œå› æ­¤[0 0dy/dt]Tè¡¨ç¤ºåœ¨å›¾ä¸­çŠ¶æ€â‘ çš„åæ ‡ä¸­ç»•Zçš„è§’é€Ÿåº¦ã€‚ç”±äºä¹‹åè¯¥åæ ‡ç³»è¿˜è¦ç»å†<strong>ç»•Yå’Œç»•Xçš„ä¸¤æ¬¡æ—‹è½¬</strong>ï¼Œå› æ­¤è¿™é‡Œ[00dy/dt]Tè§’é€Ÿåº¦åœ¨ç»å†ä¸¤æ¬¡æ—‹è½¬åï¼Œåœ¨æœ€ç»ˆçš„åæ ‡ç³»(çŠ¶æ€â‘¢)ä¸­çš„åæ ‡ä¹Ÿè¦ç»å†ä¸¤æ¬¡å˜æ¢ã€‚å›¾ä¸­çš„[gx_Zgy_Zgz_Z]Tè¡¨ç¤º3æ¬¡æ—‹è½¬è¿‡ç¨‹ä¸­ç»•Zè½´çš„yawè§’çš„è§’é€Ÿåº¦åœ¨æœ€ç»ˆå§¿æ€ä¸­çš„<strong>ç­‰æ•ˆ</strong>è½¬åŠ¨è§’é€Ÿåº¦ï¼Œå®é™…å°±æ˜¯çŠ¶æ€â‘ åæ ‡ç³»ä¸­ç»•Zè½´çš„è§’é€Ÿåº¦åœ¨çŠ¶æ€â‘¢åæ ‡ç³»ä¸­çš„æ–°çš„åæ ‡ã€‚</p><p><strong>åŒç†</strong>ï¼Œdp/dtè¿˜éœ€è¦ç»å†1æ¬¡æ—‹è½¬å˜æ¢ï¼Œè€Œdr/dtä¸éœ€è¦ç»å†æ—‹è½¬ã€‚</p><p>å°†dy/dtï¼Œdp/dtï¼Œdr/dtä¸‰è€…éƒ½å˜æ¢åˆ°çŠ¶æ€â‘¢åæ ‡ç³»ä¸­çš„æ–°çš„åæ ‡ç›¸åŠ ï¼Œå®é™…å°±æ˜¯çŠ¶æ€â‘¢æ—¶åˆ»é™€èºä»ªè‡ªå·±è¯»åˆ°çš„gyroæ•°æ®ã€‚</p><p><strong>æ‰€ä»¥</strong>ï¼Œä»dr/dtç­‰è§’é€Ÿåº¦åˆ°é™€èºä»ªè¯»åˆ°çš„è§’é€Ÿåº¦gxç­‰çš„è½¬æ¢å…³ç³»æ¨å¯¼è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-b8e2f588258c2297a06bb2dca7381e8f_720w.webp" /></p><p><strong>è¿›ä¸€æ­¥</strong>ï¼Œå†æŠŠè¿™é‡Œçš„çŠ¶æ€â‘¢ç†è§£ä¸ºçŠ¶æ€nï¼Œåˆ™æ ¹æ®çŠ¶æ€næ—¶åˆ»è¯»åˆ°çš„é™€èºä»ªæ•°æ®ï¼Œåè§£dy/dtç­‰è§’é€Ÿåº¦æ•°æ®ï¼Œå³å¯æ›´æ–°å¾—åˆ°çŠ¶æ€n+1çš„å§¿æ€ã€‚åè§£å°±æ˜¯æ±‚é€†çŸ©é˜µï¼Œå³ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-8f9e706d1378f9aa57b57320c1d48c5d_720w.webp" /></p><h2 id="äº”.å§¿æ€èåˆ">äº”.å§¿æ€èåˆ</h2><p>ç”±ä¸Šé¢çš„åˆ†æå¯çŸ¥ï¼Œ<strong>åŠ é€Ÿåº¦è®¡</strong>åœ¨é™æ­¢æ—¶åˆ»ï¼Œæ ¹æ®æ„Ÿå—åˆ°çš„é‡åŠ›åŠ é€Ÿåº¦ï¼Œå¯ä»¥è®¡ç®—å‡ºrollå’Œpitchè§’ï¼Œå¹¶ä¸”è§’åº¦è®¡ç®—åªä¸å½“å‰å§¿æ€æœ‰å…³ã€‚è€Œ<strong>é™€èºä»ª</strong>æ˜¯å¯¹æ—¶é—´é—´éš”å†…çš„è§’é€Ÿåº¦ç§¯åˆ†ï¼Œå¾—åˆ°æ¯ä¸€æ¬¡çš„è§’åº¦å˜æ¢é‡ï¼Œç´¯åŠ åˆ°ä¸Šä¸€æ¬¡çš„å§¿æ€è§’ä¸Šï¼Œå¾—åˆ°æ–°çš„å§¿æ€è§’ï¼Œé™€èºä»ªå¯ä»¥è®¡ç®—rollã€pitchã€yawä¸‰ä¸ªè§’ã€‚</p><p>å®é™…ä¸Šï¼ŒåŠ é€Ÿåº¦ä»…åœ¨é™æ­¢æ—¶åˆ»å¯ä»¥å¾—åˆ°è¾ƒå‡†ç¡®çš„å§¿æ€ï¼Œè€Œé™€èºä»ªä»…å¯¹è½¬åŠ¨æ—¶çš„å§¿æ€å˜åŒ–æ•æ„Ÿï¼Œä¸”é™€èºä»ªè‹¥æœ¬èº«å­˜åœ¨è¯¯å·®ï¼Œåˆ™ç»è¿‡è¿ç»­çš„æ—¶é—´ç§¯åˆ†ï¼Œè¯¯å·®ä¼šä¸æ–­å¢å¤§ã€‚å› æ­¤ï¼Œéœ€è¦ç»“åˆä¸¤è€…è®¡ç®—çš„å§¿æ€ï¼Œè¿›è¡Œäº’è¡¥èåˆã€‚å½“ç„¶ï¼Œè¿™é‡Œåªèƒ½å¯¹rollå’Œpitchèåˆï¼Œå› ä¸ºåŠ é€Ÿåº¦è®¡æ²¡æœ‰å¾—åˆ°yawã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/matrixv2-b2bb643d59b3f143b7555074e4d5b3b6_720w.webp" /></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Kalmanæ»¤æ³¢ç®—æ³•</title>
    <link href="/2023/11/27/KalmanFilter/"/>
    <url>/2023/11/27/KalmanFilter/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€.åŸºç¡€çŸ¥è¯†">ä¸€.åŸºç¡€çŸ¥è¯†</h2>1.é«˜æ–¯å™ªå£°ï¼šå™ªå£°æ»¡è¶³æ­£æ€åˆ†å¸ƒ<br />2.å®è§‚æ„ä¹‰ï¼šæ»¤æ³¢å³åŠ æƒ<br />ç†æƒ³çŠ¶æ€ï¼š ä¿¡å·x1 + å™ªå£°x0<br />LPF(Low pass filter):ä½ç”µå¹³x1é«˜ç”µå¹³x0<br />å¡å°”æ›¼æ»¤æ³¢ï¼šä¼°è®¡å€¼xï¼ˆæƒé‡ï¼‰ è§‚æµ‹å€¼xï¼ˆæƒé‡ï¼‰ -&gt;ä¿®æ­£<br />3.åæ–¹å·® ï¼šæè¿°ä¸¤ä¸ªéšæœºå˜é‡çš„ç›¸å…³æ€§<br /><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/kalmanimage.png"alt="image.png" /><br /><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/kalmanimage%20(1).png"alt="image.png" /><br />åæ ‡åŸç‚¹ä¸ºå¹³å‡å€¼<spanclass="math inline">\((\bar{x},\,\bar{y})\)</span>ï¼Œæ¯ä¸ªæ ·æœ¬ç‚¹ä¸åŸç‚¹å›´æˆçš„çŸ©å½¢é¢ç§¯ä¹‹å’Œå¯ä»¥æè¿°ç›¸å…³æ€§ï¼ˆçº¢è‰²ä¸ºæ­£ï¼Œè“è‰²ä¸ºè´Ÿï¼‰ï¼š<br />å…¬å¼è¡¨ç¤ºä¸ºï¼š<br /><center><span class="math inline">\(\sum(x_i - \bar{x})(y_i -\bar{y})\begin{cases} &gt;0ï¼Œæ­£ç›¸å…³ \\= 0, ä¸ç›¸å…³ \\&lt;0ï¼Œè´Ÿç›¸å…³\end{cases}\)</span></center>å¸¸ç”¨åŠ æƒå½¢å¼ï¼ˆæ¦‚ç‡ä¸ºç»Ÿè®¡ç»éªŒï¼‰ï¼š<br /><center><span class="math inline">\(\sum p_i(x_i - \mu_X)(y_i - \mu_Y)\)</span></center><br /><center><span class="math inline">\(Cov(X, Y) = E[(X-\mu_X)(Y-\mu_Y)]\)</span></center><br />4.åæ–¹å·®çŸ©é˜µ<br />ç»è¿‡å»ä¸­å¿ƒåŒ–å¤„ç†åçš„mä¸ªæ ·æœ¬ç‚¹ï¼Œæ¯ä¸ªæ ·æœ¬åŒ…å«3ä¸ªæ•°æ®<spanclass="math inline">\(a_i\,b_i\,c_i\)</span>ï¼Œæ¯ç»„æ ·æœ¬çš„æ•°æ®åˆ—å‘é‡çš„å½¢å¼ä¿å­˜åœ¨çŸ©é˜µXä¸­ï¼š<br /><center><span class="math inline">\(X=\begin{bmatrix}a_1\,a_2\,a_3\,......\,a_m\\b_1\,b_2\,b_3\,......\,b_m\\c_1\,c_2\,c_3\,......\,c_m\end{bmatrix}\)</span></center><br /><center><spanclass="math inline">\(P=\frac{1}{m}XX^T=\frac{1}{m}\begin{bmatrix}a_1\,a_2\,......\,a_m\\b_1\,b_2\,......\,b_m\\c_1\,c_2\,......\,c_m\end{bmatrix}\begin{bmatrix}a_1\,b_1\,c_1\\a_2\,b_2\,c_2\\......\\a_m\,b_m\,c_m\end{bmatrix}=\begin{bmatrix}Cov(a,\,a)\,\,\,\,Cov(a,\,b)\,\,\,\,Cov(a,\,c)\\Cov(b,\,a)\,\,\,\,Cov(b,\,b)\,\,\,\,Cov(b,\,c)\\Cov(c,\,a)\,\,\,\,Cov(c,\,b)\,\,\,\,Cov(c,\,c) \end{bmatrix}\)</span></center><p><br />å¯è§ï¼Œåæ–¹å·®çŸ©é˜µç”±æ–¹å·®å’Œåæ–¹å·®ç»„æˆã€‚</p><h2 id="äºŒ.è¿›é˜¶">äºŒ.è¿›é˜¶</h2>1.çŠ¶æ€ç©ºé—´è¡¨è¾¾å¼<br />çŠ¶æ€æ–¹ç¨‹<br /><center><span class="math inline">\(x_k = Ax_{k-1} + Bu_k + w_k\)</span></center><br />xkå½“å‰çŠ¶æ€å½“å‰å€¼ x_k-1ä¸Šä¸ªæ—¶åˆ»ç»™çŠ¶æ€çš„å€¼ uè¾“å…¥wkè¿‡ç¨‹å™ªå£°<br />AçŠ¶æ€è½¬ç§»çŸ©é˜µ Bæ§åˆ¶çŸ©é˜µ <br />eg.å°è½¦åŒ€é€Ÿç›´çº¿è¿åŠ¨ <spanclass="math inline">\(x_k = x_{k - 1} + v dt +w_k\)</span><br />è§‚æµ‹æ–¹ç¨‹<br /><center><span class="math inline">\(y_k = Cx_k + v_k\)</span></center><br />2.å‚æ•°åˆ†æ<br />ï¼ˆ1ï¼‰è¿‡ç¨‹å™ªå£°<spanclass="math inline">\(w_kæœä»N(0, Q_k)\)</span><br /> è§‚æµ‹å™ªå£°<spanclass="math inline">\(v_kæœä»N(0,R_k)\)</span><br />ç§°ä¸ºé«˜æ–¯ç™½å™ªå£°<br /> (2) æ–¹å·® ä¸€ç»´æ–¹å·®deltaäºŒç»´åæ–¹å·®<br />å½“å‰å…ˆéªŒä¼°è®¡å€¼ + è§‚æµ‹å€¼ â€”â€”â€”â€”&gt; å½“å‰æœ€ä¼˜ä¼°è®¡å€¼<br />3.é¢„æµ‹é˜¶æ®µ<br />é¢„æµ‹tæ—¶åˆ»å…ˆéªŒä¼°è®¡ï¼š<br /><center><span class="math inline">\(\hat{x_t^-}=F\hat{x}_{t-1}+Bu_{t-1}\)</span></center><br />tæ—¶åˆ»Påæ–¹å·®é¢„æµ‹ï¼š<br /><center><span class="math inline">\(P_t^- = FP_{t-1}F^T + Q\)</span></center><br />4.çŠ¶æ€æ›´æ–°é˜¶æ®µ<br />ï¼ˆ1ï¼‰<br /><center><span class="math inline">\(\hat{x_t} = \hat{x_t^-}+K_t(z_t -H\hat{x_t^-})\)</span></center><br />xtä¸º<strong>æœ€ç»ˆæ»¤æ³¢ç»“æœ</strong>ï¼Œxt-ä¸ºå…ˆéªŒä¼°è®¡ï¼ŒKtå¡å°”æ›¼å¢ç›Šï¼Œztè§‚æµ‹å€¼<br />ï¼ˆ2ï¼‰æ›´æ–°å¡å°”æ›¼å¢ç›Š<br /><center><span class="math inline">\(K_t=P_t^-H^T(HP^-_tH^T + R)^{-1}\)</span></center><br />Pä¸ºå…ˆéªŒåæ–¹å·®Rè§‚å¯Ÿé‡åæ–¹å·®çŸ©é˜µï¼ˆè§‚æµ‹å™ªå£°ï¼‰ã€‚<br />(3)<br /><center><span class="math inline">\(P_t = (I - K_tH)P_t^-\)</span></center><h2 id="ä¸‰.mpu6050å¡å°”æ›¼æ»¤æ³¢å§¿æ€è§£ç®—">ä¸‰.MPU6050å¡å°”æ›¼æ»¤æ³¢å§¿æ€è§£ç®—</h2><p>æ³¨ï¼šæ— æ³•å¯¹yawè½´è¿›è¡Œå¡å°”æ›¼ç®—æ³•ï¼Œéœ€è¦9è½´IMUå€ŸåŠ©ç£åŠ›è®¡è¿›è¡Œè§£ç®—<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;kalman_cal.h&quot;</span></span><br><br><span class="hljs-comment">//å¡å°”æ›¼è§£ç®—æ³•åº“</span><br><br><span class="hljs-type">short</span> aacx,aacy,aacz;<span class="hljs-comment">//åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨åŸå§‹æ•°æ® </span><br><span class="hljs-type">short</span> gyrox,gyroy,gyroz;<span class="hljs-comment">//é™€èºä»ªåŸå§‹æ•°æ® </span><br><span class="hljs-type">short</span> temperature;<span class="hljs-comment">//é™€èºä»ªæ¸©åº¦æ•°æ®</span><br><span class="hljs-type">float</span> accel_x;     <span class="hljs-comment">//Xè½´åŠ é€Ÿåº¦å€¼</span><br><span class="hljs-type">float</span> accel_y;    <span class="hljs-comment">//Yè½´åŠ é€Ÿåº¦å€¼</span><br><span class="hljs-type">float</span> accel_z;     <span class="hljs-comment">//Zè½´åŠ é€Ÿåº¦å€¼</span><br><span class="hljs-type">float</span> gyro_x;<span class="hljs-comment">//Xè½´é™€èºä»ªè§’é€Ÿåº¦æ•°æ®</span><br><span class="hljs-type">float</span> gyro_y;        <span class="hljs-comment">//Yè½´é™€èºä»ªè§’é€Ÿåº¦æ•°æ®</span><br><span class="hljs-type">float</span> gyro_z; <span class="hljs-comment">//Zè½´é™€èºä»ªè§’é€Ÿåº¦æ•°æ®</span><br><span class="hljs-type">float</span> yaw_raw;   <span class="hljs-comment">//èˆªçº¿è§’yawåŸå§‹æ•°æ®</span><br><span class="hljs-type">float</span> yaw_kalman;  <span class="hljs-comment">//yawæ»¤æ³¢åæ•°æ®</span><br><span class="hljs-type">float</span> pitch_raw;   <span class="hljs-comment">//ä¿¯ä»°è§’pitchåŸå§‹æ•°æ®</span><br><span class="hljs-type">float</span> pitch_kalman;  <span class="hljs-comment">//pitchæ»¤æ³¢åæ•°æ®</span><br><span class="hljs-type">float</span> roll_raw;     <span class="hljs-comment">//æ¨ªæ»šè§’rollåŸå§‹æ•°æ®</span><br><span class="hljs-type">float</span> roll_kalman;  <span class="hljs-comment">//rollæ»¤æ³¢åæ•°æ®</span><br><br><span class="hljs-type">rt_int16_t</span> temp;        <span class="hljs-comment">//æ¸©åº¦</span><br><span class="hljs-type">rt_int16_t</span> gx,gy,gz;    <span class="hljs-comment">//ä¸‰è½´åŠ é€Ÿåº¦</span><br><span class="hljs-type">rt_int16_t</span> ax,ay,az;    <span class="hljs-comment">//ä¸‰è½´è§’é€Ÿåº¦</span><br><span class="hljs-comment">//åˆ¤æ–­æ•°æ®æ¥æ”¶æ˜¯å¦æ­£å¸¸</span><br><span class="hljs-type">rt_err_t</span> temp_ret;<br><span class="hljs-type">rt_err_t</span> a_ret;<br><span class="hljs-type">rt_err_t</span> g_ret;<br><br><span class="hljs-comment">//é™€èºä»ªæ•°æ®è®¡ç®—</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Angle_Cal</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br><span class="hljs-comment">//1. åŸå§‹æ•°æ®è·å–</span><br><span class="hljs-type">float</span> accx,accy,accz;<span class="hljs-comment">//ä¸‰æ–¹å‘è§’åŠ é€Ÿåº¦å€¼</span><br><span class="hljs-comment">//è·å–æ¸©åº¦</span><br>  temp_ret = mpu6050_temperature_get(&amp;temp);    <br><span class="hljs-comment">//è·å–åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨æ•°æ®</span><br>  a_ret = mpu6050_accelerometer_get(&amp;ax, &amp;ay, &amp;az);<br>  <span class="hljs-comment">//è·å¾—é™€èºä»ªæ•°æ®</span><br>g_ret = mpu6050_gyroscope_get(&amp;gx, &amp;gy, &amp;gz);<br>accel_x = ax;<span class="hljs-comment">//xè½´åŠ é€Ÿåº¦å€¼æš‚å­˜</span><br>accel_y = ay;<span class="hljs-comment">//yè½´åŠ é€Ÿåº¦å€¼æš‚å­˜</span><br>accel_z = az;<span class="hljs-comment">//zè½´åŠ é€Ÿåº¦å€¼æš‚å­˜</span><br>gyro_x  = gx;<span class="hljs-comment">//xè½´é™€èºä»ªå€¼æš‚å­˜</span><br>gyro_y  = gy;<span class="hljs-comment">//yè½´é™€èºä»ªå€¼æš‚å­˜</span><br>gyro_z  = gz;<span class="hljs-comment">//zè½´é™€èºä»ªå€¼æš‚å­˜</span><br><br><span class="hljs-comment">//2.è§’åŠ é€Ÿåº¦åŸå§‹å€¼å¤„ç†è¿‡ç¨‹</span><br><span class="hljs-comment">//åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨é…ç½®å¯„å­˜å™¨0X1Cå†…å†™å…¥0x01,è®¾ç½®èŒƒå›´ä¸ºÂ±2gã€‚æ¢ç®—å…³ç³»ï¼š2^16/4 = 16384LSB/g</span><br><span class="hljs-keyword">if</span>(accel_x&lt;<span class="hljs-number">32764</span>) accx=accel_x/<span class="hljs-number">16384.0</span>;<span class="hljs-comment">//è®¡ç®—xè½´åŠ é€Ÿåº¦</span><br><span class="hljs-keyword">else</span>              accx=<span class="hljs-number">1</span>-(accel_x<span class="hljs-number">-49152</span>)/<span class="hljs-number">16384.0</span>;<br><span class="hljs-keyword">if</span>(accel_y&lt;<span class="hljs-number">32764</span>) accy=accel_y/<span class="hljs-number">16384.0</span>;<span class="hljs-comment">//è®¡ç®—yè½´åŠ é€Ÿåº¦</span><br><span class="hljs-keyword">else</span>              accy=<span class="hljs-number">1</span>-(accel_y<span class="hljs-number">-49152</span>)/<span class="hljs-number">16384.0</span>;<br><span class="hljs-keyword">if</span>(accel_z&lt;<span class="hljs-number">32764</span>) accz=accel_z/<span class="hljs-number">16384.0</span>;<span class="hljs-comment">//è®¡ç®—zè½´åŠ é€Ÿåº¦</span><br><span class="hljs-keyword">else</span>              accz=(accel_z<span class="hljs-number">-49152</span>)/<span class="hljs-number">16384.0</span>;<br><span class="hljs-comment">//åŠ é€Ÿåº¦åæ­£åˆ‡å…¬å¼è®¡ç®—ä¸‰ä¸ªè½´å’Œæ°´å¹³é¢åæ ‡ç³»ä¹‹é—´çš„å¤¹è§’</span><br>pitch_raw=(<span class="hljs-built_in">atan</span>(accy/accz))*<span class="hljs-number">180</span>/<span class="hljs-number">3.14</span>;<br>roll_raw=(<span class="hljs-built_in">atan</span>(accx/accz))*<span class="hljs-number">180</span>/<span class="hljs-number">3.14</span>;<br><span class="hljs-comment">//åˆ¤æ–­è®¡ç®—åè§’åº¦çš„æ­£è´Ÿå·</span><br><span class="hljs-keyword">if</span>(accel_x&lt;<span class="hljs-number">32764</span>) roll_raw = +roll_raw;<br><span class="hljs-keyword">if</span>(accel_x&gt;<span class="hljs-number">32764</span>) roll_raw = -roll_raw;<br><span class="hljs-keyword">if</span>(accel_y&lt;<span class="hljs-number">32764</span>) pitch_raw = +pitch_raw;<br><span class="hljs-keyword">if</span>(accel_y&gt;<span class="hljs-number">32764</span>) pitch_raw = -pitch_raw;<br><br><span class="hljs-comment">//3.è§’é€Ÿåº¦åŸå§‹å€¼å¤„ç†è¿‡ç¨‹</span><br><span class="hljs-comment">//é™€èºä»ªé…ç½®å¯„å­˜å™¨0X1Bå†…å†™å…¥0x18ï¼Œè®¾ç½®èŒƒå›´ä¸ºÂ±2000deg/sã€‚æ¢ç®—å…³ç³»ï¼š2^16/4000=16.4LSB/(Â°/S)</span><br><span class="hljs-comment">////è®¡ç®—è§’é€Ÿåº¦</span><br><span class="hljs-keyword">if</span>(gyro_x&lt;<span class="hljs-number">32768</span>) gyro_x=-(gyro_x/<span class="hljs-number">16.4</span>);<br><span class="hljs-keyword">if</span>(gyro_x&gt;<span class="hljs-number">32768</span>) gyro_x=+(<span class="hljs-number">65535</span>-gyro_x)/<span class="hljs-number">16.4</span>;<br><span class="hljs-keyword">if</span>(gyro_y&lt;<span class="hljs-number">32768</span>) gyro_y=-(gyro_y/<span class="hljs-number">16.4</span>);<br><span class="hljs-keyword">if</span>(gyro_y&gt;<span class="hljs-number">32768</span>) gyro_y=+(<span class="hljs-number">65535</span>-gyro_y)/<span class="hljs-number">16.4</span>;<br><span class="hljs-keyword">if</span>(gyro_z&lt;<span class="hljs-number">32768</span>) gyro_z=-(gyro_z/<span class="hljs-number">16.4</span>);<br><span class="hljs-keyword">if</span>(gyro_z&gt;<span class="hljs-number">32768</span>) gyro_z=+(<span class="hljs-number">65535</span>-gyro_z)/<span class="hljs-number">16.4</span>;<br><br><span class="hljs-comment">//4.è°ƒç”¨å¡å°”æ›¼å‡½æ•°</span><br>Kalman_Cal_Pitch(pitch_raw,gyro_x);  <span class="hljs-comment">//å¡å°”æ›¼æ»¤æ³¢è®¡ç®—Xå€¾è§’</span><br>Kalman_Cal_Roll(roll_raw,gyro_y);  <span class="hljs-comment">//å¡å°”æ›¼æ»¤æ³¢è®¡ç®—Yå€¾è§’  </span><br><br><br>&#125;<br> <br><span class="hljs-comment">//å¡å°”æ›¼å‚æ•°</span><br><span class="hljs-type">static</span> <span class="hljs-type">float</span> Q_angle = <span class="hljs-number">0.001</span>;<span class="hljs-comment">//è§’åº¦æ•°æ®ç½®ä¿¡åº¦ï¼Œè§’åº¦å™ªå£°çš„åæ–¹å·®</span><br><span class="hljs-type">static</span> <span class="hljs-type">float</span> Q_gyro  = <span class="hljs-number">0.003</span>;<span class="hljs-comment">//è§’é€Ÿåº¦æ•°æ®ç½®ä¿¡åº¦ï¼Œè§’é€Ÿåº¦å™ªå£°çš„åæ–¹å·®  </span><br><span class="hljs-type">static</span> <span class="hljs-type">float</span> R_angle = <span class="hljs-number">0.5</span>;<span class="hljs-comment">//åŠ é€Ÿåº¦è®¡æµ‹é‡å™ªå£°çš„åæ–¹å·®</span><br><span class="hljs-type">static</span> <span class="hljs-type">float</span> dt      = <span class="hljs-number">0.01</span>;<span class="hljs-comment">//é‡‡æ ·å‘¨æœŸå³è®¡ç®—ä»»åŠ¡å‘¨æœŸ10ms</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Kalman_Cal_Pitch</span><span class="hljs-params">(<span class="hljs-type">float</span> acc,<span class="hljs-type">float</span> gyro)</span> <span class="hljs-comment">//å¡å°”æ›¼æ»¤æ³¢pitchè½´è®¡ç®—</span><br>&#123;<br><span class="hljs-type">static</span> <span class="hljs-type">float</span> Q_bias;<span class="hljs-comment">//Q_bias:é™€èºä»ªçš„åå·®</span><br><span class="hljs-type">static</span> <span class="hljs-type">float</span> K_0, K_1;<span class="hljs-comment">//å¡å°”æ›¼å¢ç›Š  K_0:ç”¨äºè®¡ç®—æœ€ä¼˜ä¼°è®¡å€¼  K_1:ç”¨äºè®¡ç®—æœ€ä¼˜ä¼°è®¡å€¼çš„åå·® t_0/1:ä¸­é—´å˜é‡</span><br><span class="hljs-type">static</span> <span class="hljs-type">float</span> PP[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] = &#123; &#123; <span class="hljs-number">1</span>, <span class="hljs-number">0</span> &#125;,&#123; <span class="hljs-number">0</span>, <span class="hljs-number">1</span> &#125; &#125;;<span class="hljs-comment">//è¿‡ç¨‹åæ–¹å·®çŸ©é˜µPï¼Œåˆå§‹å€¼ä¸ºå•ä½é˜µ</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">å¡å°”æ›¼æ»¤æ³¢çš„ä½¿ç”¨æ­¥éª¤</span><br><span class="hljs-comment">(1) é€‰æ‹©çŠ¶æ€é‡ã€è§‚æµ‹é‡</span><br><span class="hljs-comment">(2) æ„å»ºæ–¹ç¨‹</span><br><span class="hljs-comment">(3) åˆå§‹åŒ–å‚æ•°</span><br><span class="hljs-comment">(4) å¸¦å…¥å…¬å¼è¿­ä»£</span><br><span class="hljs-comment">(5) è°ƒèŠ‚è¶…å‚æ•°Pã€Q</span><br><span class="hljs-comment">*/</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">X(k)ï¼škæ—¶åˆ»ç³»ç»ŸçŠ¶æ€Z(k)ï¼škæ—¶åˆ»æµ‹é‡å€¼</span><br><span class="hljs-comment">U(k)ï¼škæ—¶åˆ»å¯¹ç³»ç»Ÿæ§åˆ¶é‡Hï¼šæµ‹é‡ç³»ç»Ÿå‚æ•°</span><br><span class="hljs-comment"> æ–¹å·®</span><br><span class="hljs-comment">A/Fï¼šçŠ¶æ€è½¬ç§»çŸ©é˜µW(k)ï¼šè¿‡ç¨‹å™ªå£° ----&gt; Q</span><br><span class="hljs-comment"> æ–¹å·®</span><br><span class="hljs-comment">Bï¼šæ§åˆ¶çŸ©é˜µV(k)ï¼šæµ‹é‡å™ªå£° ----&gt; R</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">ç¦»æ•£æ§åˆ¶ç³»ç»Ÿ</span><br><span class="hljs-comment">ç³»ç»Ÿæè¿°ï¼šX(k|k-1) = AX(k-1|k-1) + BU(k) + (W(k))</span><br><span class="hljs-comment">æµ‹é‡å€¼ï¼šZ(k) = HX(k) + V(k)</span><br><span class="hljs-comment">*/</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">1. å…ˆéªŒä¼°è®¡</span><br><span class="hljs-comment">* * *å…¬å¼1ï¼šX(k|k-1) = AX(k-1|k-1) + BU(k) + (W(k))</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">X = (Angle,Q_bias)</span><br><span class="hljs-comment">A(1,1) = 1,A(1,2) = -dt</span><br><span class="hljs-comment">A(2,1) = 0,A(2,2) = 1</span><br><span class="hljs-comment">æ³¨ï¼šä¸Šä¸‹è¿â€œ[â€ä»£è¡¨çŸ©é˜µ</span><br><span class="hljs-comment">é¢„æµ‹å½“å‰è§’åº¦å€¼ï¼š</span><br><span class="hljs-comment">[ angle ] [1 -dt][ angle ] [dt]</span><br><span class="hljs-comment">[ Q_bias] = [0  1 ][ Q_bias] + [ 0] * newGyro(åŠ é€Ÿåº¦è®¡æµ‹é‡å€¼)</span><br><span class="hljs-comment">æ•…</span><br><span class="hljs-comment">angle = angle - Q_bias*dt + newGyro * dt</span><br><span class="hljs-comment">Q_bias = Q_bias</span><br><span class="hljs-comment">*/</span><br>pitch_kalman += (gyro - Q_bias) * dt; <span class="hljs-comment">//çŠ¶æ€æ–¹ç¨‹,è§’åº¦å€¼ç­‰äºä¸Šæ¬¡æœ€ä¼˜è§’åº¦åŠ è§’é€Ÿåº¦å‡é›¶æ¼‚åç§¯åˆ†</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">2. é¢„æµ‹åæ–¹å·®çŸ©é˜µ</span><br><span class="hljs-comment">* * *å…¬å¼2ï¼šP(k|k-1)=AP(k-1|k-1)A^T + Q </span><br><span class="hljs-comment"></span><br><span class="hljs-comment">ç”±å…ˆéªŒä¼°è®¡æœ‰ç³»ç»Ÿå‚æ•°</span><br><span class="hljs-comment">[1 -dt]</span><br><span class="hljs-comment">A = [0  1 ]</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">ç³»ç»Ÿè¿‡ç¨‹åæ–¹å·®å™ªå£°Qå®šä¹‰ï¼š</span><br><span class="hljs-comment">| cov(angle,angle)  cov(Q_bias,angle) |</span><br><span class="hljs-comment">|cov(angle,Q_bias) cov(Q_bias,Q_bias)|</span><br><span class="hljs-comment"> è§’åº¦å™ªå£°å’Œè§’é€Ÿåº¦æ¼‚ç§»å™ªå£°ç›¸äº’ç‹¬ç«‹</span><br><span class="hljs-comment">| D( angle )  0  |</span><br><span class="hljs-comment">= |0 D( Q_bias )|</span><br><span class="hljs-comment">åˆQ_angleå’ŒQ_biasçš„æ–¹å·®ä¸ºå¸¸æ•°ï¼Œ</span><br><span class="hljs-comment">å¯ç”±ç»éªŒæˆ–è®¡ç®—å¾—å‡º</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">ä»¤D( angle )  = Q_angle </span><br><span class="hljs-comment">D( Q_bias ) = Q_gyro </span><br><span class="hljs-comment"></span><br><span class="hljs-comment">è®¾ä¸Šä¸€æ¬¡é¢„æµ‹åæ–¹å·®çŸ©é˜µä¸ºP(k-1)</span><br><span class="hljs-comment">|a(k-1)  b(k-1)|</span><br><span class="hljs-comment">|c(k-1)  d(k-1)|</span><br><span class="hljs-comment">æœ¬æ¬¡é¢„æµ‹åæ–¹å·®çŸ©é˜µP(k)</span><br><span class="hljs-comment">|a(k)  b(k)|</span><br><span class="hljs-comment">                  |c(k)  d(k)|</span><br><span class="hljs-comment">ç”±å…¬å¼2ï¼šP(k|k-1)=AP(k-1|k-1)A^T + Q å¾—</span><br><span class="hljs-comment">|a(k)  b(k)||1 -dt||a(k-1) b(k-1)| |1  0|| D( angle )  0  |</span><br><span class="hljs-comment">|c(k)  d(k)| =  |0  1 | |c(k-1) d(k-1)| |-dt 1| + |0 D( Q_bias )|</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">è¿›ä¸€æ­¥å¾—</span><br><span class="hljs-comment">|a(k)  b(k)||a(k-1) - [c(k-1) + b(k-1)]*dt + d(dt)^2b(k-1) - d(k-1)*dt|| D( angle )  0  |</span><br><span class="hljs-comment">  |c(k)  d(k)| =  |c(k-1) - d(k-1)*dtd(k-1)| + |0 D( Q_bias )|</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">ç”±äºdt^2å¤ªå°ï¼Œæ•…dt^2çœç•¥</span><br><span class="hljs-comment">*/</span><br><br>PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + Q_angle - (PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] + PP[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>])*dt;<br>PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] - PP[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]*dt;<br>PP[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = PP[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] - PP[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]*dt;<br>PP[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = PP[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] + Q_gyro;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">3. å»ºç«‹æµ‹é‡æ–¹ç¨‹</span><br><span class="hljs-comment">ç³»ç»Ÿæµ‹é‡æ–¹ç¨‹ Z(k) = HX(k) + V(k)</span><br><span class="hljs-comment">ç³»ç»Ÿæµ‹é‡ç³»æ•° H = [1, 0]</span><br><span class="hljs-comment">å› ä¸ºé™€èºä»ªè¾“å‡ºè‡ªå¸¦å™ªå£°</span><br><span class="hljs-comment">æ‰€ä»¥</span><br><span class="hljs-comment">measure = newAngle</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">4. è®¡ç®—å¡å°”æ›¼å¢ç›Š</span><br><span class="hljs-comment">* * *å…¬å¼3ï¼šKg(k)= P(k|k-1)H^T/(HP(k|k-1)H^T+R)</span><br><span class="hljs-comment">Kg = (K_0,K_1) å¯¹åº”angle,Q_biaså¢ç›Š</span><br><span class="hljs-comment">H = (1,0)</span><br><span class="hljs-comment">*/</span><br>K_0 = PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] / (PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + R_angle);<br>K_1 = PP[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] / (PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + R_angle);<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">5. è®¡ç®—å½“å‰æœ€ä¼˜åŒ–ä¼°è®¡å€¼</span><br><span class="hljs-comment">* * *å…¬å¼4ï¼šX(k|k) = X(k|k-1) + kg(k)[z(k) - HX(k|k-1)]</span><br><span class="hljs-comment">angle = angle + K_0*(newAngle - angle)</span><br><span class="hljs-comment">Q_bias = Q_bias + K_1*(newAngle - angle)</span><br><span class="hljs-comment">*/</span><br><br>pitch_kalman = pitch_kalman + K_0 * (acc - pitch_kalman);<br>Q_bias = Q_bias + K_1 * (acc - pitch_kalman);<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">6. æ›´æ–°åæ–¹å·®çŸ©é˜µ</span><br><span class="hljs-comment">* * *å…¬å¼5ï¼šP(k|k)=[I-Kg(k)H]P(k|k-1)</span><br><span class="hljs-comment">*/</span><br>PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] - K_0 * PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];<br>PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] - K_0 * PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>];<br>PP[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = PP[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] - K_1 * PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];<br>PP[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = PP[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] - K_1 * PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>];<br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Kalman_Cal_Roll</span><span class="hljs-params">(<span class="hljs-type">float</span> acc,<span class="hljs-type">float</span> gyro)</span> <span class="hljs-comment">//å¡å°”æ›¼æ»¤æ³¢rollè½´è®¡ç®—</span><br>&#123;<br><span class="hljs-type">static</span> <span class="hljs-type">float</span> Q_bias;<span class="hljs-comment">//Q_bias:é™€èºä»ªçš„åå·®  Angle_err:è§’åº¦åé‡ </span><br><span class="hljs-type">static</span> <span class="hljs-type">float</span> K_0, K_1;<span class="hljs-comment">//å¡å°”æ›¼å¢ç›Š  K_0:ç”¨äºè®¡ç®—æœ€ä¼˜ä¼°è®¡å€¼  K_1:ç”¨äºè®¡ç®—æœ€ä¼˜ä¼°è®¡å€¼çš„åå·® t_0/1:ä¸­é—´å˜é‡</span><br><span class="hljs-type">static</span> <span class="hljs-type">float</span> PP[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] = &#123; &#123; <span class="hljs-number">1</span>, <span class="hljs-number">0</span> &#125;,&#123; <span class="hljs-number">0</span>, <span class="hljs-number">1</span> &#125; &#125;;<span class="hljs-comment">//è¿‡ç¨‹åæ–¹å·®çŸ©é˜µPï¼Œåˆå§‹å€¼ä¸ºå•ä½é˜µ</span><br>roll_kalman += (gyro - Q_bias) * dt; <span class="hljs-comment">//çŠ¶æ€æ–¹ç¨‹,è§’åº¦å€¼ç­‰äºä¸Šæ¬¡æœ€ä¼˜è§’åº¦åŠ è§’é€Ÿåº¦å‡é›¶æ¼‚åç§¯åˆ†</span><br>PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + Q_angle - (PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] + PP[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>])*dt;<br>PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] - PP[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]*dt;<br>PP[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = PP[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] - PP[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]*dt;<br>PP[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = PP[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] + Q_gyro;<br>K_0 = PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] / (PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + R_angle);<br>K_1 = PP[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] / (PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + R_angle);<br>roll_kalman = roll_kalman + K_0 * (acc - roll_kalman);<br>Q_bias = Q_bias + K_1 * (acc - roll_kalman);<br>PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] - K_0 * PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];<br>PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] - K_0 * PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>];<br>PP[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = PP[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] - K_1 * PP[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];<br>PP[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = PP[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] - K_1 * PP[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>];<br>&#125;<br><br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>FreeRTOS</title>
    <link href="/2023/11/20/FreeRTOS/"/>
    <url>/2023/11/20/FreeRTOS/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€.stm32f103ç³»ç»Ÿç§»æ¤">ä¸€.stm32f103ç³»ç»Ÿç§»æ¤</h2><p>æ­¤è¿‡ç¨‹å¯ä»¥ç”±CubeMXæ›¿ä»£ï¼Œé€‰æ‹©å¯¹åº”çš„èŠ¯ç‰‡åç‚¹å‡» Middlewares å‹¾é€‰FreeRTOS é€‰é¡¹å³å¯ã€‚ç”Ÿæˆä»£ç æ—¶è‡ªåŠ¨åŠ å…¥ FreeRTOS</p><p>FreeRTOSConfig.hé…ç½®æ–‡ä»¶æ·»åŠ ä¸­æ–­å‡½æ•°ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> xPortPendSVHandler PendSV_Handler</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> xPortSysTickHandler SysTick_Handler</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> vPortSVCHandler SVC_Handler</span><br></code></pre></td></tr></table></figure>ç›¸åº”çš„ï¼Œæ³¨é”€æ‰åŸæœ‰çš„ä¸­æ–­ï¼š <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* void SVC_Handler(void) */</span><br><span class="hljs-comment">/* &#123; */</span><br><span class="hljs-comment">/* &#125; */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function handles Debug Monitor exception.</span><br><span class="hljs-comment">  * @param  None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">DebugMon_Handler</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function handles PendSVC exception.</span><br><span class="hljs-comment">  * @param  None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* void PendSV_Handler(void) */</span><br><span class="hljs-comment">/* &#123; */</span><br><span class="hljs-comment">/* &#125; */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function handles SysTick Handler.</span><br><span class="hljs-comment">  * @param  None</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-comment">/* void SysTick_Handler(void) */</span><br><span class="hljs-comment">/* &#123; */</span><br><span class="hljs-comment">/* &#125; */</span><br></code></pre></td></tr></table></figure></p><h2 id="äºŒ.åŠ¨æ€ä»»åŠ¡åˆ›å»ºå’Œåˆ é™¤">äºŒ.åŠ¨æ€ä»»åŠ¡åˆ›å»ºå’Œåˆ é™¤</h2><p>å®å®šä¹‰typedef tskTCB TCB_t; taskTCBå°±æ˜¯TCB_t<br />åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">BaseType_t <span class="hljs-title function_">xTaskCreate</span><span class="hljs-params">( TaskFunction_t pxTaskCode,</span><br><span class="hljs-params">                            <span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-type">const</span> pcName, <span class="hljs-comment">/*lint !e971 Unqualified char types are allowed for strings and single characters only. */</span></span><br><span class="hljs-params">                            <span class="hljs-type">const</span> configSTACK_DEPTH_TYPE usStackDepth,</span><br><span class="hljs-params">                            <span class="hljs-type">void</span> * <span class="hljs-type">const</span> pvParameters,</span><br><span class="hljs-params">                            UBaseType_t uxPriority,</span><br><span class="hljs-params">                            TaskHandle_t * <span class="hljs-type">const</span> pxCreatedTask )</span><br></code></pre></td></tr></table></figure> para1: pxTaskCodeä¸ºä»»åŠ¡å‡½æ•°åç§°(TaskFunction_t)start_task<br />para2: "å­—ç¬¦ä¸²ä¸ºä»»åŠ¡åç§°"<br />para3:uint16_tä»£è¡¨å †æ ˆä¸­çš„å¤§å°ï¼ˆå•ä½ï¼šå­— = 4å­—èŠ‚ï¼‰<br />para4: ä»»åŠ¡å‚æ•°usually NULL<br />para5:ä¼˜å…ˆçº§0~31ï¼Œæ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜<br />para6ï¼šä»»åŠ¡å¥æŸ„<br />xTaskCreate()å‡½æ•°çš„å®ç°<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">if</span> ( configSUPPORT_DYNAMIC_ALLOCATION == 1 )<span class="hljs-comment">//æ¡ä»¶ç¼–è¯‘ï¼šéœ€è¦åœ¨configæ–‡ä»¶ä¸­å®šä¹‰å® configSUPPORT_DYNAMIC_ALLOCATION</span></span><br><br>    BaseType_t <span class="hljs-title function_">xTaskCreate</span><span class="hljs-params">( TaskFunction_t pxTaskCode,</span><br><span class="hljs-params">                            <span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-type">const</span> pcName, <span class="hljs-comment">/*lint !e971 Unqualified char types are allowed for strings and single characters only. */</span></span><br><span class="hljs-params">                            <span class="hljs-type">const</span> configSTACK_DEPTH_TYPE usStackDepth,</span><br><span class="hljs-params">                            <span class="hljs-type">void</span> * <span class="hljs-type">const</span> pvParameters,</span><br><span class="hljs-params">                            UBaseType_t uxPriority,</span><br><span class="hljs-params">                            TaskHandle_t * <span class="hljs-type">const</span> pxCreatedTask )</span><br>    &#123;<br>        TCB_t * pxNewTCB;<span class="hljs-comment">//ä»»åŠ¡æ§åˆ¶å—ï¼š1.pxOfStackTopä»»åŠ¡æ ˆæ ˆé¡¶2.StateList 3.EventList4.uxPriorityä»»åŠ¡ä¼˜å…ˆçº§</span><br>        BaseType_t xReturn;<br><br>        <span class="hljs-comment">/* If the stack grows down then allocate the stack then the TCB so the stack</span><br><span class="hljs-comment">         * does not grow into the TCB.  Likewise if the stack grows up then allocate</span><br><span class="hljs-comment">         * the TCB then the stack. */</span><br>        <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( portSTACK_GROWTH &gt; 0 )<span class="hljs-comment">//æ ˆä»é«˜åˆ°ä½ï¼Œå †ç”±ä½åˆ°é«˜(malloc)</span></span><br>        &#123;<br>            <span class="hljs-comment">/* Allocate space for the TCB.  Where the memory comes from depends on</span><br><span class="hljs-comment">             * the implementation of the port malloc function and whether or not static</span><br><span class="hljs-comment">             * allocation is being used. */</span><br>            pxNewTCB = ( TCB_t * ) pvPortMalloc( <span class="hljs-keyword">sizeof</span>( TCB_t ) );<br><br>            <span class="hljs-keyword">if</span>( pxNewTCB != <span class="hljs-literal">NULL</span> )<br>            &#123;<br>                <span class="hljs-built_in">memset</span>( ( <span class="hljs-type">void</span> * ) pxNewTCB, <span class="hljs-number">0x00</span>, <span class="hljs-keyword">sizeof</span>( TCB_t ) );<br><br>                <span class="hljs-comment">/* Allocate space for the stack used by the task being created.</span><br><span class="hljs-comment">                 * The base of the stack memory stored in the TCB so the task can</span><br><span class="hljs-comment">                 * be deleted later if required. */</span><br>                pxNewTCB-&gt;pxStack = ( StackType_t * ) pvPortMallocStack( ( ( ( <span class="hljs-type">size_t</span> ) usStackDepth ) * <span class="hljs-keyword">sizeof</span>( StackType_t ) ) ); <span class="hljs-comment">/*lint !e961 MISRA exception as the casts are only redundant for some ports. */</span><br><br>                <span class="hljs-keyword">if</span>( pxNewTCB-&gt;pxStack == <span class="hljs-literal">NULL</span> )<br>                &#123;<br>                    <span class="hljs-comment">/* Could not allocate the stack.  Delete the allocated TCB. */</span><br>                    vPortFree( pxNewTCB );<br>                    pxNewTCB = <span class="hljs-literal">NULL</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-meta">#<span class="hljs-keyword">else</span> <span class="hljs-comment">/* portSTACK_GROWTH */</span></span><br>        &#123;<br>            StackType_t * pxStack;<br><br>            <span class="hljs-comment">/* Allocate space for the stack used by the task being created. */</span><br>            pxStack = pvPortMallocStack( ( ( ( <span class="hljs-type">size_t</span> ) usStackDepth ) * <span class="hljs-keyword">sizeof</span>( StackType_t ) ) ); <span class="hljs-comment">/*lint !e9079 All values returned by pvPortMalloc() have at least the alignment required by the MCU&#x27;s stack and this allocation is the stack. */</span><br>                                                                                <span class="hljs-comment">// StackType_t ä¸º uint32_tï¼Œå•ä½ä¸º4å­—èŠ‚=å­—</span><br>            <span class="hljs-keyword">if</span>( pxStack != <span class="hljs-literal">NULL</span> )<br>            &#123;<br>                <span class="hljs-comment">/* Allocate space for the TCB. */</span><br>                pxNewTCB = ( TCB_t * ) pvPortMalloc( <span class="hljs-keyword">sizeof</span>( TCB_t ) ); <span class="hljs-comment">/*lint !e9087 !e9079 All values returned by pvPortMalloc() have at least the alignment required by the MCU&#x27;s stack, and the first member of TCB_t is always a pointer to the task&#x27;s stack. */</span><br><br>                <span class="hljs-keyword">if</span>( pxNewTCB != <span class="hljs-literal">NULL</span> )<span class="hljs-comment">//å¦‚æœç”³è¯·æˆåŠŸ</span><br>                &#123;<br>                    <span class="hljs-built_in">memset</span>( ( <span class="hljs-type">void</span> * ) pxNewTCB, <span class="hljs-number">0x00</span>, <span class="hljs-keyword">sizeof</span>( TCB_t ) );<br><br>                    <span class="hljs-comment">/* Store the stack location in the TCB. */</span><br>                    pxNewTCB-&gt;pxStack = pxStack;<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    <span class="hljs-comment">/* The stack cannot be used as the TCB was not created.  Free</span><br><span class="hljs-comment">                     * it again. */</span><br>                    vPortFreeStack( pxStack );<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                pxNewTCB = <span class="hljs-literal">NULL</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* portSTACK_GROWTH */</span></span><br><br>        <span class="hljs-keyword">if</span>( pxNewTCB != <span class="hljs-literal">NULL</span> )<br>        &#123;<br>            <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( tskSTATIC_AND_DYNAMIC_ALLOCATION_POSSIBLE != 0 ) <span class="hljs-comment">/*lint !e9029 !e731 Macro has been consolidated for readability reasons. */</span></span><br>            &#123;<br>                <span class="hljs-comment">/* Tasks can be created statically or dynamically, so note this</span><br><span class="hljs-comment">                 * task was created dynamically in case it is later deleted. */</span><br>                pxNewTCB-&gt;ucStaticallyAllocated = tskDYNAMICALLY_ALLOCATED_STACK_AND_TCB;<br>            &#125;<br>            <span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* tskSTATIC_AND_DYNAMIC_ALLOCATION_POSSIBLE */</span></span><br><br>            prvInitialiseNewTask( pxTaskCode, pcName, ( <span class="hljs-type">uint32_t</span> ) usStackDepth, pvParameters, uxPriority, pxCreatedTask, pxNewTCB, <span class="hljs-literal">NULL</span> );<br>            prvAddNewTaskToReadyList( pxNewTCB );<span class="hljs-comment">//æ·»åŠ åˆ°å°±åºåˆ—è¡¨</span><br>            xReturn = pdPASS;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            xReturn = errCOULD_NOT_ALLOCATE_REQUIRED_MEMORY;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> xReturn;<br>    &#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* configSUPPORT_DYNAMIC_ALLOCATION */</span></span><br></code></pre></td></tr></table></figure> åˆå§‹åŒ–TCB prvInitialiseNewTask():</p><p>prvå‰ç¼€ï¼ˆprivateï¼‰ï¼Œå› ä¸ºå‡½æ•°è¢«staticä¿®é¥°åªåœ¨å½“å‰æ–‡ä»¶å¯è§<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">prvInitialiseNewTask</span><span class="hljs-params">( TaskFunction_t pxTaskCode,</span><br><span class="hljs-params">                                  <span class="hljs-type">const</span> <span class="hljs-type">char</span> * <span class="hljs-type">const</span> pcName, <span class="hljs-comment">/*lint !e971 Unqualified char types are allowed for strings and single characters only. */</span></span><br><span class="hljs-params">                                  <span class="hljs-type">const</span> <span class="hljs-type">uint32_t</span> ulStackDepth,</span><br><span class="hljs-params">                                  <span class="hljs-type">void</span> * <span class="hljs-type">const</span> pvParameters,</span><br><span class="hljs-params">                                  UBaseType_t uxPriority,</span><br><span class="hljs-params">                                  TaskHandle_t * <span class="hljs-type">const</span> pxCreatedTask,</span><br><span class="hljs-params">                                  TCB_t * pxNewTCB,</span><br><span class="hljs-params">                                  <span class="hljs-type">const</span> MemoryRegion_t * <span class="hljs-type">const</span> xRegions )</span><br>&#123;<br>    StackType_t * pxTopOfStack;<br>    UBaseType_t x;<br><br>    <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( portUSING_MPU_WRAPPERS == 1 )</span><br>        <span class="hljs-comment">/* Should the task be created in privileged mode? */</span><br>        BaseType_t xRunPrivileged;<br><br>        <span class="hljs-keyword">if</span>( ( uxPriority &amp; portPRIVILEGE_BIT ) != <span class="hljs-number">0U</span> )<br>        &#123;<br>            xRunPrivileged = pdTRUE;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            xRunPrivileged = pdFALSE;<br>        &#125;<br>        uxPriority &amp;= ~portPRIVILEGE_BIT;<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* portUSING_MPU_WRAPPERS == 1 */</span></span><br><br>    <span class="hljs-comment">/* Avoid dependency on memset() if it is not required. */</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( tskSET_NEW_STACKS_TO_KNOWN_VALUE == 1 )</span><br>    &#123;<br>        <span class="hljs-comment">/* Fill the stack with a known value to assist debugging.ä»pxStackèµ·å§‹åœ°å€å¼€å§‹èµ‹å€¼ä¸º0xA5ï¼Œå¯ç”¨APIæ£€æµ‹å†å²å‰©ä½™æœ€å°æ ˆç©ºé—´ */</span><br>        ( <span class="hljs-type">void</span> ) <span class="hljs-built_in">memset</span>( pxNewTCB-&gt;pxStack, ( <span class="hljs-type">int</span> ) tskSTACK_FILL_BYTE, ( <span class="hljs-type">size_t</span> ) ulStackDepth * <span class="hljs-keyword">sizeof</span>( StackType_t ) );<br>    &#125;<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* tskSET_NEW_STACKS_TO_KNOWN_VALUE */</span></span><br><br>    <span class="hljs-comment">/* Calculate the top of stack address.  This depends on whether the stack</span><br><span class="hljs-comment">     * grows from high memory to low (as per the 80x86) or vice versa.</span><br><span class="hljs-comment">     * portSTACK_GROWTH is used to make the result positive or negative as required</span><br><span class="hljs-comment">     * by the port. */</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( portSTACK_GROWTH &lt; 0 )<span class="hljs-comment">//ä»ä¸Šåˆ°ä¸‹</span></span><br>    &#123;<br>        pxTopOfStack = &amp;( pxNewTCB-&gt;pxStack[ ulStackDepth - ( <span class="hljs-type">uint32_t</span> ) <span class="hljs-number">1</span> ] );<br>        pxTopOfStack = ( StackType_t * ) ( ( ( portPOINTER_SIZE_TYPE ) pxTopOfStack ) &amp; ( ~( ( portPOINTER_SIZE_TYPE ) portBYTE_ALIGNMENT_MASK ) ) ); <span class="hljs-comment">/*lint !e923 !e9033 !e9078 MISRA exception.  Avoiding casts between pointers and integers is not practical.  Size differences accounted for using portPOINTER_SIZE_TYPE type.  Checked by assert(). */</span><br><br>        <span class="hljs-comment">/* Check the alignment of the calculated top of stack is correct. */</span><br>        configASSERT( ( ( ( portPOINTER_SIZE_TYPE ) pxTopOfStack &amp; ( portPOINTER_SIZE_TYPE ) portBYTE_ALIGNMENT_MASK ) == <span class="hljs-number">0UL</span> ) );<br><br>        <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( configRECORD_STACK_HIGH_ADDRESS == 1 )</span><br>        &#123;<br>            <span class="hljs-comment">/* Also record the stack&#x27;s high address, which may assist</span><br><span class="hljs-comment">             * debugging. */</span><br>            pxNewTCB-&gt;pxEndOfStack = pxTopOfStack;<br>        &#125;<br>        <span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* configRECORD_STACK_HIGH_ADDRESS */</span></span><br>    &#125;<br>    <span class="hljs-meta">#<span class="hljs-keyword">else</span> <span class="hljs-comment">/* portSTACK_GROWTH */</span></span><br>    &#123;<br>        pxTopOfStack = pxNewTCB-&gt;pxStack;<br><br>        <span class="hljs-comment">/* Check the alignment of the stack buffer is correct. */</span><br>        configASSERT( ( ( ( portPOINTER_SIZE_TYPE ) pxNewTCB-&gt;pxStack &amp; ( portPOINTER_SIZE_TYPE ) portBYTE_ALIGNMENT_MASK ) == <span class="hljs-number">0UL</span> ) );<br><br>        <span class="hljs-comment">/* The other extreme of the stack space is required if stack checking is</span><br><span class="hljs-comment">         * performed. */</span><br>        pxNewTCB-&gt;pxEndOfStack = pxNewTCB-&gt;pxStack + ( ulStackDepth - ( <span class="hljs-type">uint32_t</span> ) <span class="hljs-number">1</span> );<br>    &#125;<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* portSTACK_GROWTH */</span></span><br><br>    <span class="hljs-comment">/* Store the task name in the TCB. */</span><br>    <span class="hljs-keyword">if</span>( pcName != <span class="hljs-literal">NULL</span> )<br>    &#123;<br>        <span class="hljs-keyword">for</span>( x = ( UBaseType_t ) <span class="hljs-number">0</span>; x &lt; ( UBaseType_t ) configMAX_TASK_NAME_LEN; x++ )<br>        &#123;<br>            pxNewTCB-&gt;pcTaskName[ x ] = pcName[ x ];<br><br>            <span class="hljs-comment">/* Don&#x27;t copy all configMAX_TASK_NAME_LEN if the string is shorter than</span><br><span class="hljs-comment">             * configMAX_TASK_NAME_LEN characters just in case the memory after the</span><br><span class="hljs-comment">             * string is not accessible (extremely unlikely). */</span><br>            <span class="hljs-keyword">if</span>( pcName[ x ] == ( <span class="hljs-type">char</span> ) <span class="hljs-number">0x00</span> )<br>            &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                mtCOVERAGE_TEST_MARKER();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">/* Ensure the name string is terminated in the case that the string length</span><br><span class="hljs-comment">         * was greater or equal to configMAX_TASK_NAME_LEN. */</span><br>        pxNewTCB-&gt;pcTaskName[ configMAX_TASK_NAME_LEN - <span class="hljs-number">1</span> ] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        mtCOVERAGE_TEST_MARKER();<br>    &#125;<br><br>    <span class="hljs-comment">/* This is used as an array index so must ensure it&#x27;s not too large. */</span><br>    configASSERT( uxPriority &lt; configMAX_PRIORITIES );<br><br>    <span class="hljs-keyword">if</span>( uxPriority &gt;= ( UBaseType_t ) configMAX_PRIORITIES )<br>    &#123;<br>        uxPriority = ( UBaseType_t ) configMAX_PRIORITIES - ( UBaseType_t ) <span class="hljs-number">1U</span>; <span class="hljs-comment">//è¶…å‡ºæœ€å¤§ä¼˜å…ˆçº§ï¼Œä¼šèµ‹å€¼ä¸º32-1=31</span><br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        mtCOVERAGE_TEST_MARKER();<br>    &#125;<br><br>    pxNewTCB-&gt;uxPriority = uxPriority;<span class="hljs-comment">//èµ‹å€¼ç»™TCBæˆå‘˜</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( configUSE_MUTEXES == 1 )</span><br>    &#123;<br>        pxNewTCB-&gt;uxBasePriority = uxPriority;<br>    &#125;<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* configUSE_MUTEXES */</span></span><br><br>    vListInitialiseItem( &amp;( pxNewTCB-&gt;xStateListItem ) );<span class="hljs-comment">//åˆå§‹åŒ–çŠ¶æ€åˆ—è¡¨</span><br>    vListInitialiseItem( &amp;( pxNewTCB-&gt;xEventListItem ) );<span class="hljs-comment">//åˆå§‹åŒ–äº‹ä»¶åˆ—è¡¨</span><br><br>    <span class="hljs-comment">/* Set the pxNewTCB as a link back from the ListItem_t.  This is so we can get</span><br><span class="hljs-comment">     * back to  the containing TCB from a generic item in a list. */</span><br>    listSET_LIST_ITEM_OWNER( &amp;( pxNewTCB-&gt;xStateListItem ), pxNewTCB );<br><br>    <span class="hljs-comment">/* Event lists are always in priority order. */</span><br>    <span class="hljs-comment">//äº‹ä»¶åˆ—è¡¨æŒ‰ç…§ä»å°åˆ°å¤§æ’åˆ—</span><br>    <span class="hljs-comment">//å¯¹åˆ—è¡¨ä¸­çš„ä»»åŠ¡å€’ç½®maxPrio - taskPrioå¾—åˆ°æ­£ç¡®çš„é¡ºåº</span><br>    listSET_LIST_ITEM_VALUE( &amp;( pxNewTCB-&gt;xEventListItem ), ( TickType_t ) configMAX_PRIORITIES - ( TickType_t ) uxPriority ); <span class="hljs-comment">/*lint !e961 MISRA exception as the casts are only redundant for some ports. */</span><br>    listSET_LIST_ITEM_OWNER( &amp;( pxNewTCB-&gt;xEventListItem ), pxNewTCB );<br><br>    <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( portUSING_MPU_WRAPPERS == 1 )</span><br>    &#123;<br>        vPortStoreTaskMPUSettings( &amp;( pxNewTCB-&gt;xMPUSettings ), xRegions, pxNewTCB-&gt;pxStack, ulStackDepth );<br>    &#125;<br>    <span class="hljs-meta">#<span class="hljs-keyword">else</span></span><br>    &#123;<br>        <span class="hljs-comment">/* Avoid compiler warning about unreferenced parameter. */</span><br>        ( <span class="hljs-type">void</span> ) xRegions;<br>    &#125;<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( ( configUSE_NEWLIB_REENTRANT == 1 ) || ( configUSE_C_RUNTIME_TLS_SUPPORT == 1 ) )</span><br>    &#123;<br>        <span class="hljs-comment">/* Allocate and initialize memory for the task&#x27;s TLS Block. */</span><br>        configINIT_TLS_BLOCK( pxNewTCB-&gt;xTLSBlock );<br>    &#125;<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br>    <span class="hljs-comment">/* Initialize the TCB stack to look as if the task was already running,</span><br><span class="hljs-comment">     * but had been interrupted by the scheduler.  The return address is set</span><br><span class="hljs-comment">     * to the start of the task function. Once the stack has been initialised</span><br><span class="hljs-comment">     * the top of stack variable is updated. */</span><br>    <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( portUSING_MPU_WRAPPERS == 1 )</span><br>    &#123;<br>        <span class="hljs-comment">/* If the port has capability to detect stack overflow,</span><br><span class="hljs-comment">         * pass the stack end address to the stack initialization</span><br><span class="hljs-comment">         * function as well. */</span><br>        <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( portHAS_STACK_OVERFLOW_CHECKING == 1 )</span><br>        &#123;<br>            <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( portSTACK_GROWTH &lt; 0 )</span><br>            &#123;<br>                pxNewTCB-&gt;pxTopOfStack = pxPortInitialiseStack( pxTopOfStack, pxNewTCB-&gt;pxStack, pxTaskCode, pvParameters, xRunPrivileged );<br>            &#125;<br>            <span class="hljs-meta">#<span class="hljs-keyword">else</span> <span class="hljs-comment">/* portSTACK_GROWTH */</span></span><br>            &#123;<br>                pxNewTCB-&gt;pxTopOfStack = pxPortInitialiseStack( pxTopOfStack, pxNewTCB-&gt;pxEndOfStack, pxTaskCode, pvParameters, xRunPrivileged );<br>            &#125;<br>            <span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* portSTACK_GROWTH */</span></span><br>        &#125;<br>        <span class="hljs-meta">#<span class="hljs-keyword">else</span> <span class="hljs-comment">/* portHAS_STACK_OVERFLOW_CHECKING */</span></span><br>        &#123;<br>            <span class="hljs-comment">//åˆå§‹åŒ–ä»»åŠ¡æ ˆæ ˆé¡¶****</span><br>            pxNewTCB-&gt;pxTopOfStack = pxPortInitialiseStack( pxTopOfStack, pxTaskCode, pvParameters, xRunPrivileged );<br>        &#125;<br>        <span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* portHAS_STACK_OVERFLOW_CHECKING */</span></span><br>    &#125;<br>    <span class="hljs-meta">#<span class="hljs-keyword">else</span> <span class="hljs-comment">/* portUSING_MPU_WRAPPERS */</span></span><br>    &#123;<br>        <span class="hljs-comment">/* If the port has capability to detect stack overflow,</span><br><span class="hljs-comment">         * pass the stack end address to the stack initialization</span><br><span class="hljs-comment">         * function as well. */</span><br>        <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( portHAS_STACK_OVERFLOW_CHECKING == 1 )</span><br>        &#123;<br>            <span class="hljs-meta">#<span class="hljs-keyword">if</span> ( portSTACK_GROWTH &lt; 0 )</span><br>            &#123;<br>                pxNewTCB-&gt;pxTopOfStack = pxPortInitialiseStack( pxTopOfStack, pxNewTCB-&gt;pxStack, pxTaskCode, pvParameters );<br>            &#125;<br>            <span class="hljs-meta">#<span class="hljs-keyword">else</span> <span class="hljs-comment">/* portSTACK_GROWTH */</span></span><br>            &#123;<br>                pxNewTCB-&gt;pxTopOfStack = pxPortInitialiseStack( pxTopOfStack, pxNewTCB-&gt;pxEndOfStack, pxTaskCode, pvParameters );<br>            &#125;<br>            <span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* portSTACK_GROWTH */</span></span><br>        &#125;<br>        <span class="hljs-meta">#<span class="hljs-keyword">else</span> <span class="hljs-comment">/* portHAS_STACK_OVERFLOW_CHECKING */</span></span><br>        &#123;<br>            pxNewTCB-&gt;pxTopOfStack = pxPortInitialiseStack( pxTopOfStack, pxTaskCode, pvParameters );<br>        &#125;<br>        <span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* portHAS_STACK_OVERFLOW_CHECKING */</span></span><br>    &#125;<br>    <span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">/* portUSING_MPU_WRAPPERS */</span></span><br><br>    <span class="hljs-keyword">if</span>( pxCreatedTask != <span class="hljs-literal">NULL</span> )<br>    &#123;<br>        <span class="hljs-comment">/* Pass the handle out in an anonymous way.  The handle can be used to</span><br><span class="hljs-comment">         * change the created task&#x27;s priority, delete the created task, etc.*/</span><br>        *pxCreatedTask = ( TaskHandle_t ) pxNewTCB;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        mtCOVERAGE_TEST_MARKER();<br>    &#125;<br>&#125;<br>/<br></code></pre></td></tr></table></figure> example:å®ç°ä¸¤åªå°ç¯åŒæ—¶é—ªçƒ <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> START_TASK_STACK_SIZE 128<span class="hljs-comment">//å¼€å§‹ä»»åŠ¡å †æ ˆå¤§å°</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> START_TASK_PRIORITY   1<span class="hljs-comment">//å¼€å§‹ä»»åŠ¡ä¼˜å…ˆçº§</span></span><br>TaskHandle_t StartTask_Handler;<span class="hljs-comment">//å¼€å§‹ä»»åŠ¡å¥æŸ„ï¼Œç±»å‹TaskHandle_t</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK_1_STACK_SIZE 128</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK_1_PRIORITY   2</span><br>TaskHandle_t Task1_Handler;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK_2_STACK_SIZE 128</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TASK_2_PRIORITY   3</span><br>TaskHandle_t Task2_Handler;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">RTOS_Init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    xTaskCreate((TaskFunction_t)startTask, <span class="hljs-string">&quot;StartTask&quot;</span>,<br>                START_TASK_STACK_SIZE, <span class="hljs-literal">NULL</span>,<br>                START_TASK_PRIORITY, &amp;StartTask_Handler);<br>    vTaskStartScheduler();<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">startTask</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span> &#123;<br>    taskENTER_CRITICAL();<span class="hljs-comment">//é€šå¸¸åˆ›å»ºä»»åŠ¡æ—¶è¿›å…¥ä¸´ç•Œæ€ï¼Œä¿è¯åˆ›å»ºæ—¶ä¸å‘ç”Ÿä»»åŠ¡è°ƒåº¦ </span><br>    xTaskCreate((TaskFunction_t)task1, <span class="hljs-string">&quot;Task1&quot;</span>,<br>                TASK_1_STACK_SIZE, <span class="hljs-literal">NULL</span>,<br>                TASK_1_PRIORITY, &amp;Task1_Handler);<br>    xTaskCreate((TaskFunction_t)task2, <span class="hljs-string">&quot;Task2&quot;</span>,<br>                TASK_2_STACK_SIZE, <span class="hljs-literal">NULL</span>,<br>                TASK_2_PRIORITY, &amp;Task2_Handler);<br>    vTaskDelete(<span class="hljs-literal">NULL</span>);<br>    taskEXIT_CRITICAL();<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task1</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span> &#123;<span class="hljs-comment">//pvParameters ä»»åŠ¡å‚æ•°æŒ‡é’ˆ</span><br>    LED_Init(GPIOC, GPIO_Pin_13);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        LED_Switch(GPIOC, GPIO_Pin_13);<br>        vTaskDelay(<span class="hljs-number">50</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">task2</span><span class="hljs-params">(<span class="hljs-type">void</span> *pvParameters)</span> &#123;<br>    LED_Init(GPIOB, GPIO_Pin_12);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        LED_Switch(GPIOB, GPIO_Pin_12);<br>        vTaskDelay(<span class="hljs-number">50</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></p><h3 id="æ‹“å±•-cmsis-v2-æä¾›çš„apiæ¥å£">æ‹“å±•: CMSIS-V2 æä¾›çš„APIæ¥å£</h3><p>åœ¨ CMSIS è§„èŒƒä¸­ï¼ŒFreeRTOS çš„ Task å˜æˆ Thread</p><p>ä»»åŠ¡å¥æŸ„ç±»å‹æ˜¯ osThreaedId_t</p><p>åˆå§‹åŒ–ä»»åŠ¡ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">osThreadId_t defaultTaskHandle;<br><span class="hljs-type">const</span> osThreadAttr_t defaultTask_attributes = &#123;<br>  .name = <span class="hljs-string">&quot;defaultTask&quot;</span>,<br>  .stack_size = <span class="hljs-number">128</span> * <span class="hljs-number">4</span>,<br>  .priority = (osPriority_t) osPriorityNormal,<br>&#125;;<br><br>defaultTaskHandle = osThreadNew(StartDefaultTask, <span class="hljs-literal">NULL</span>, &amp;defaultTask_attributes);<br></code></pre></td></tr></table></figure><h2 id="ä¸‰.é™æ€åˆ›å»ºä»»åŠ¡">ä¸‰.é™æ€åˆ›å»ºä»»åŠ¡</h2><p>ä»»åŠ¡å‡½æ•°ä¸éœ€è¦ä¿®æ”¹<br />æ‰‹åŠ¨å®ç°ç©ºé—²ä»»åŠ¡å’Œå®šæ—¶å™¨ä»»åŠ¡åŠå…¶TCBï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">vApplicationGetIdleTaskMemory</span><span class="hljs-params">(StaticTask_t **ppxIdleTaskTCBBuffer,</span><br><span class="hljs-params">                                   StackType_t **ppxIdleTaskStackBuffer,</span><br><span class="hljs-params">                                   <span class="hljs-type">uint32_t</span> *pulIdleTaskStackSize)</span> &#123;<br>    <span class="hljs-type">static</span> StaticTask_t xIdleTaskTCB;<br>    <span class="hljs-type">static</span> StackType_t uxIdleTaskStack[configMINIMAL_STACK_SIZE];<br>    *ppxIdleTaskTCBBuffer = &amp;xIdleTaskTCB;<br>    *ppxIdleTaskStackBuffer = uxIdleTaskStack;<br>    *pulIdleTaskStackSize = configMINIMAL_STACK_SIZE;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">vApplicationGetTimerTaskMemory</span><span class="hljs-params">(StaticTask_t **ppxTimerTaskTCBBuffer,</span><br><span class="hljs-params">                                    StackType_t **ppxTimerTaskStackBuffer,</span><br><span class="hljs-params">                                    <span class="hljs-type">uint32_t</span> *pulTimerTaskStackSize)</span> &#123;<br>    <span class="hljs-type">static</span> StaticTask_t xTimerTaskTCB;<br>    <span class="hljs-type">static</span> StackType_t uxTimerTaskStack[configTIMER_TASK_STACK_DEPTH];<br>    *ppxTimerTaskTCBBuffer = &amp;xTimerTaskTCB;<br>    *ppxTimerTaskStackBuffer = uxTimerTaskStack;<br>    *pulTimerTaskStackSize = configTIMER_TASK_STACK_DEPTH;<br>&#125;<br></code></pre></td></tr></table></figure> ä¸ºä»€ä¹ˆéœ€è¦å®ç°è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨å¼€å¯ä»»åŠ¡è°ƒåº¦å™¨æ—¶ï¼š<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">if</span> ( configSUPPORT_STATIC_ALLOCATION == 1 )</span><br>&#123;<br>    StaticTask_t * pxIdleTaskTCBBuffer = <span class="hljs-literal">NULL</span>;<br>    StackType_t * pxIdleTaskStackBuffer = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-type">uint32_t</span> ulIdleTaskStackSize;<br><br>    <span class="hljs-comment">/* The Idle task is created using user provided RAM - obtain the</span><br><span class="hljs-comment">     * address of the RAM then create the idle task. */</span><br>    vApplicationGetIdleTaskMemory( &amp;pxIdleTaskTCBBuffer, &amp;pxIdleTaskStackBuffer, &amp;ulIdleTaskStackSize );<br>    xIdleTaskHandle = xTaskCreateStatic( prvIdleTask,   <span class="hljs-comment">//è¿”å›å€¼ä¸ºä»»åŠ¡å¥æŸ„</span><br>                                         configIDLE_TASK_NAME,<br>                                         ulIdleTaskStackSize,<br>                                         ( <span class="hljs-type">void</span> * ) <span class="hljs-literal">NULL</span>,       <span class="hljs-comment">/*lint !e961.  The cast is not redundant for all compilers. */</span><br>                                         portPRIVILEGE_BIT,     <span class="hljs-comment">/* In effect ( tskIDLE_PRIORITY | portPRIVILEGE_BIT ), but tskIDLE_PRIORITY is zero. */</span><br>                                         pxIdleTaskStackBuffer,<br>                                         pxIdleTaskTCBBuffer ); <span class="hljs-comment">/*lint !e961 MISRA exception, justified as it is not a redundant explicit cast to all supported compilers. */</span><br></code></pre></td></tr></table></figure> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">if</span> ( configSUPPORT_STATIC_ALLOCATION == 1 )</span><br>&#123;<br>    StaticTask_t * pxTimerTaskTCBBuffer = <span class="hljs-literal">NULL</span>;<br>    StackType_t * pxTimerTaskStackBuffer = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-type">uint32_t</span> ulTimerTaskStackSize;<br><br>    vApplicationGetTimerTaskMemory( &amp;pxTimerTaskTCBBuffer, &amp;pxTimerTaskStackBuffer, &amp;ulTimerTaskStackSize );<br>    xTimerTaskHandle = xTaskCreateStatic( prvTimerTask,<br>                                          configTIMER_SERVICE_TASK_NAME,<br>                                          ulTimerTaskStackSize,<br>                                          <span class="hljs-literal">NULL</span>,<br>                                          ( ( UBaseType_t ) configTIMER_TASK_PRIORITY ) | portPRIVILEGE_BIT,<br>                                          pxTimerTaskStackBuffer,<br>                                          pxTimerTaskTCBBuffer );<br></code></pre></td></tr></table></figure> éœ€è¦æ‰‹åŠ¨å®ç°ä¸¤ä¸ªå‡½æ•°ï¼Œå¦åˆ™ä¼šç¼–è¯‘æŠ¥é”™</p><h2 id="å››.ä»»åŠ¡çš„æŒ‚èµ·ä¸æ¢å¤">å››.ä»»åŠ¡çš„æŒ‚èµ·ä¸æ¢å¤</h2><p>void vTaskSuspend(TaskHandle_t xTaskToSuspend) ä»»åŠ¡æŒ‚èµ·<br />voidvTaskResume(TaskHandle_t xTaskToResume) ä»»åŠ¡æ¢å¤<br />BaseType_txTaskResumeFromISR(TaskHandle_t xTaskToResume)ä»ä¸­æ–­ä¸­æ¢å¤ä»»åŠ¡<br />è¿”å›å€¼ pdTrue:æ¢å¤ååˆ‡æ¢ä»»åŠ¡<br />pdFalseï¼šæ¢å¤åä¸åˆ‡æ¢ä»»åŠ¡<br />ä¸­æ–­ä¼˜å…ˆçº§ä¸èƒ½é«˜äºFreeRTOSæ‰€ç®¡ç†çš„æœ€é«˜ä¼˜å…ˆçº§ï¼ˆ5~15ï¼‰</p><h2 id="äº”.freertosä¸­æ–­ç®¡ç†">äº”.FreeRTOSä¸­æ–­ç®¡ç†</h2>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>PIDç®—æ³•åˆè§</title>
    <link href="/2023/11/12/PID%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95/"/>
    <url>/2023/11/12/PID%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€-ä¸æ‡‚">ä¸€ ä¸æ‡‚</h2><p>P(roportion) I(ntegral) D(erivative)</p><p>æ¯”ä¾‹ ç§¯åˆ† å¾®åˆ†</p><p>ç‰¹ç‚¹ï¼šæ— éœ€å¯¹å­ç³»ç»Ÿè¿›è¡Œç²¾ç¡®çš„å»ºæ¨¡</p><h2 id="äºŒ-ç•¥æ‡‚">äºŒ ç•¥æ‡‚</h2><ol type="1"><li></li></ol><p>A.å¼€ç¯æ§åˆ¶ç³»ç»Ÿ</p><p>Desired output ------&gt; Controller-------&gt;Actuators------&gt;Plant ------&gt;Actual output X Uc Ua YB.å‰é¦ˆæ§åˆ¶ç³»ç»Ÿ</p><p>2.é—­ç¯æ§åˆ¶ç³»ç»Ÿ</p><p>A.å•é—­ç¯<imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/pidimage.png" /></p><p>æ§åˆ¶å™¨E=X-Yï¼Œå…¶ä¸­Xä¸ºæœŸæœ›è¾“å‡ºï¼ŒYæ¥è‡ªä¼ æ„Ÿå™¨</p><p>B.åŒé—­ç¯</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/pidimage%20(1).png" /></p><p>Y1ä¸ºå¤–ç¯æ§åˆ¶ï¼ŒY2ä¸ºå†…ç¯æ§åˆ¶ã€‚</p><p>å‚æ•°ï¼š</p><p>a.è¯¯å·®E(rror) = X ï¼ˆæœŸæœ›è¾“å‡ºï¼‰ - Y(å®é™…)</p><p>b.æ§åˆ¶å™¨è¾“å‡º c.æ‰§è¡Œå™¨è¾“å‡º</p><h2 id="ä¸‰-pidæ•°å­¦å…¬å¼">ä¸‰ PIDæ•°å­¦å…¬å¼</h2><center><span class="math inline">\(u(t) = \frac{1}{p}(e + \frac{1}{T_i}\int_0^t e \, \mathrm{d}t +T_d\,\frac{\mathrm{d}e}{\mathrm{d}t})\)</span></center><p>å…¶ä¸­<span class="math inline">\(p \, T_i \,T_d\)</span>æ˜¯éœ€è¦è°ƒå‚çš„å‚æ•°</p><p>ä¹Ÿå¯ä»¥å†™æˆ</p><center><span class="math inline">\(u(t)=K_pe +K_i\int_0^te\,\mathrm{d}t +K_d\frac{\mathrm{d}e}{\mathrm{d}t}\)</span>ï¼ˆè¿ç»­å‡½æ•°ï¼‰</center><center><span class="math inline">\(u(t)=K_pe_i +K_i\sum_{i=1}^Ne_i+K_d\frac{e_i - e_{i-1}}{\Deltat}\)</span>ï¼ˆç¦»æ•£å‡½æ•°ï¼‰</center><h2 id="å››-å…¶ä»–pidæ§åˆ¶çŸ¥è¯†">å›› å…¶ä»–PIDæ§åˆ¶çŸ¥è¯†</h2><p>1.ç§¯åˆ†é™å¹…ï¼šé˜²æ­¢ç§¯åˆ†é¡¹è¿‡å¤§å¯¼è‡´è¶…å‡ºæœŸæœ›è¾“å‡ºè¿‡å¤šï¼Œå¯¼è‡´ç³»ç»Ÿç´Šä¹±</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/pidimage%20(2).png" /></p><p>å‡è®¾eiä¸ºå¸¸æ•°,pé¡¹å§‹ç»ˆä¸å˜ï¼Œié¡¹ä¼šç§»æ¤å¢å¤§ï¼Œå¯ç”¨è“è‰²çº¿ä½œä¸ºç§¯åˆ†é™å¹…é˜²æ­¢ç§¯åˆ†é¡¹è¿‡å¤§ã€‚</p><p>2.ç§¯åˆ†åˆ†ç¦»ï¼šè¯¯å·®çªå˜æ—¶ï¼Œå¯¼è‡´ié¡¹ç§¯åˆ†é¡¹ä¹Ÿçªå˜å¯¼è‡´ç³»ç»Ÿè¶…è°ƒ</p><p>å½“på‘å¤§äºæŸä¸€é˜ˆå€¼æ—¶ï¼Œè®©Ki = 0ï¼Œç§¯åˆ†é¡¹ä½œç”¨ä¸ºé›¶ã€‚</p><p>3.å¾®åˆ†å…ˆè¡Œï¼šä¼ æ„Ÿå™¨ç»•è¿‡PIé¡¹ï¼Œç›´æ¥è¾“å‡ºç»™Dé¡¹ã€‚</p><h2 id="äº”-cè¯­è¨€ç¨‹åºå®ç°">äº” Cè¯­è¨€ç¨‹åºå®ç°</h2><p>ç¨‹åºä¸­é€šå¸¸ä½¿ç”¨å¢é‡å¼PIDå…¬å¼æ¥å‡å°‘è¿ç®—é‡ï¼š</p><center><span class="math inline">\(\Delta u(k) = u(k) - u(k -1)=K_p(e_k -e_{k-1})+K_ie_k+K_d(e_k - 2e_{k - 1} + e_{k_2})\)</span><center><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">float</span> Kp = <span class="hljs-number">1.0</span>, Ki = <span class="hljs-number">0.5</span>, Kd = <span class="hljs-number">0.1</span>;                                      <span class="hljs-comment">// PIDç³»æ•°</span><br><span class="hljs-type">float</span> error = <span class="hljs-number">0</span>, error_1 = <span class="hljs-number">0</span>, error_2 = <span class="hljs-number">0</span>, integral = <span class="hljs-number">0</span>, derivative = <span class="hljs-number">0</span>; <span class="hljs-comment">// è¯¯å·®ï¼Œä¸Šä¸€æ¬¡è¯¯å·®ï¼Œä¸Šä¸Šæ¬¡è¯¯å·®ï¼Œç§¯åˆ†ï¼Œå¾®åˆ†</span><br><span class="hljs-type">float</span> target = <span class="hljs-number">100</span>, current = <span class="hljs-number">0</span>;                                         <span class="hljs-comment">// ç›®æ ‡å€¼ï¼Œå½“å‰å€¼</span><br><span class="hljs-type">int</span> pwmValue = <span class="hljs-number">0</span>, pwmMax = <span class="hljs-number">1000</span>;<br><br><span class="hljs-comment">// PIDå¢é‡å¼ç®—æ³•</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">PID_Control</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    error = target - current; <span class="hljs-comment">// è®¡ç®—è¯¯å·®</span><br>    <span class="hljs-type">float</span> delta = Kp * (error - error_1) + Ki * error + Kd * (error - <span class="hljs-number">2</span> * error_1 + error_2);<br>    <span class="hljs-keyword">if</span> (pwmValue &gt; pwmMax) &#123;<br>        pwmValue = pwmMax;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pwmValue &lt; -pwmMax) &#123;<br>        pwmValue = <span class="hljs-number">0</span>;<br>    &#125;<br>    pwmValue += delta;<br>    error_2 = error_1;<br>    error_1 = error;<br>&#125;<br><br><span class="hljs-comment">// PIDä½ç½®å¼ç®—æ³•</span><br><span class="hljs-comment">/* void PID_Control(void) &#123; */</span><br><span class="hljs-comment">/*     error = target - current; */</span><br><span class="hljs-comment">/*     integral += error; */</span><br><span class="hljs-comment">/*     if (integral &gt; pwmMax) &#123; */</span><br><span class="hljs-comment">/*         integral = pwmMax; */</span><br><span class="hljs-comment">/*     &#125; else if (integral &lt; -pwmMax) &#123; */</span><br><span class="hljs-comment">/*         integral = -pwmMax; */</span><br><span class="hljs-comment">/*     &#125; */</span><br><span class="hljs-comment">/*     derivative = error - lastError; */</span><br><span class="hljs-comment">/*     pwmValue = Kp * error + Ki * integral + Kd * derivative; */</span><br><span class="hljs-comment">/*     if (pwmValue &gt; pwmMax) &#123; */</span><br><span class="hljs-comment">/*         pwmValue = pwmMax; */</span><br><span class="hljs-comment">/*     &#125; else if (pwmValue &lt; -pwmMax) &#123; */</span><br><span class="hljs-comment">/*         pwmValue = 0; */</span><br><span class="hljs-comment">/*     &#125; */</span><br><span class="hljs-comment">/*     lastError = error; */</span><br><span class="hljs-comment">/* &#125; */</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>åµŒå…¥å¼ï¼šSPIé€šä¿¡</title>
    <link href="/2023/11/09/SPI/"/>
    <url>/2023/11/09/SPI/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€.åŸºç¡€">ä¸€.åŸºç¡€</h2><p>SCKï¼šSerial Clock</p><p>MOSI: Master out Slave In(DI)</p><p>MISO: Master in Slave out(DO)</p><p>SS: Slave select(CS chip select)</p><p>å¸¸ç”¨SPIè®¾å¤‡ï¼šW25Q64 flashå­˜å‚¨å™¨ï¼›SPIåè®®OLEDï¼›2.4GNRF24L01ï¼›microSD</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/SPIimage.png" /></p><p>SSä¸ºé«˜ç”µå¹³æ—¶ï¼Œå…³é—­ä»æœºMISOç”µå¹³è¾“å‡ºï¼ˆé˜²æ­¢å¤šä»æœºå†²çªï¼‰ã€‚</p><p>Mode1:äº¤æ¢ä¸€ä¸ªå­—èŠ‚ CPOL(Clock Polarity) = 0ç©ºé—²çŠ¶æ€SCKä½ç”µå¹³CPHAï¼ˆClock Phaseï¼‰ = 1 SCKå¥‡æ•°æ²¿ç§»å‡ºæ•°æ®ï¼Œå¶æ•°æ²¿ç§»å…¥æ•°æ®ã€‚</p><p>Mode0ï¼ˆåº”ç”¨æœ€å¤šçš„ï¼‰:CPHA =0ç¬¬ä¸€ä¸ªè¾¹æ²¿ç§»å…¥ï¼ˆä¸Šå‡æ²¿é‡‡æ ·ï¼‰ï¼Œç¬¬äºŒä¸ªè¾¹æ²¿ç§»å‡ºï¼ˆè¿›è¡Œæ•°æ®å˜æ¢ï¼‰</p><p>Mode2:CPOL = 1 CPHA = 0</p><p>Mode3: CPOL = 1CPHA = 1</p><h2 id="äºŒ.è¯»å†™">äºŒ.è¯»å†™</h2><p>æŒ‡å®šåœ°å€å†™ï¼š0x02+3 byte addressï¼ˆW25Q64 24ä½å¯»å€ï¼‰+å†™å…¥çš„æ•°æ®</p><p>æŒ‡å®šåœ°å€è¯»ï¼š0x03+3 byte addressï¼ˆW25Q6424ä½å¯»å€ï¼‰+MISOè¯»å–æ•°æ®ï¼ˆMOSIç½®1è¾“å‡º0xFFï¼‰</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>åµŒå…¥å¼ï¼šADCæ¨¡æ•°è½¬æ¢</title>
    <link href="/2023/11/08/ADC/"/>
    <url>/2023/11/08/ADC/</url>
    
    <content type="html"><![CDATA[<p>Analog 2Dataï¼ˆæ¨¡æ‹Ÿä¿¡å·åˆ°æ•°å­—ä¿¡å·ï¼‰é€šå¸¸ä½¿ç”¨stm32å†…ç½®çš„ADCè®¾å¤‡å®ç°ï¼ŒDACï¼ˆæ•°æ¨¡è½¬æ¢ï¼‰é€šå¸¸ä½¿ç”¨TIMè¾“å‡ºæ¯”è¾ƒå¾—åˆ°PWMæ³¢å½¢ã€‚</p><p>æ¥çº¿ï¼šå…‰æ•ç”µé˜»æ¥PA4ï¼ˆæ¨¡æ‹Ÿè¾“å…¥ï¼‰ï¼Œå®ç°å•é€šé“è¿ç»­ADCè½¬æ¢</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> ADCx ADC1</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">AD_Init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br><br>    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);<br>    <span class="hljs-keyword">if</span> (ADCx == ADC1) &#123;<br>        RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC1, ENABLE);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ADCx == ADC2) &#123;<br>        RCC_APB2PeriphClockCmd(RCC_APB2Periph_ADC2, ENABLE);<br>    &#125;<br><br>    RCC_ADCCLKConfig(RCC_PCLK2_Div6);                <span class="hljs-comment">//è®¾ç½®ADCæ—¶é’Ÿé¢‘ç‡ä¸º12MHz</span><br>    GPIO_startUp(GPIOA, GPIO_Pin_4, GPIO_Mode_AIN);  <span class="hljs-comment">//PA0æ¨¡æ‹Ÿè¾“å…¥</span><br><br>    ADC_RegularChannelConfig(ADCx, ADC_Channel_4, <span class="hljs-number">1</span>, ADC_SampleTime_55Cycles5);<span class="hljs-comment">//ADC1,ADCé€šé“0,ç¬¬ä¸€ä¸ªè½¬æ¢,é‡‡æ ·æ—¶é—´ä¸º55.5å‘¨æœŸ</span><br><br>    ADC_InitTypeDef ADC_InitStructure;<br>    ADC_InitStructure.ADC_ContinuousConvMode = ENABLE;<span class="hljs-comment">//è¿ç»­è½¬æ¢æ¨¡å¼</span><br>    ADC_InitStructure.ADC_DataAlign = ADC_DataAlign_Right;<br>    ADC_InitStructure.ADC_ExternalTrigConv = ADC_ExternalTrigConv_None;<span class="hljs-comment">//ä¸ä½¿ç”¨å¤–éƒ¨è§¦å‘è½¬æ¢</span><br>    ADC_InitStructure.ADC_Mode = ADC_Mode_Independent;<br>    ADC_InitStructure.ADC_NbrOfChannel = <span class="hljs-number">1</span>;<br>    ADC_InitStructure.ADC_ScanConvMode = DISABLE;<span class="hljs-comment">//å…³é—­æ‰«ææ¨¡å¼</span><br>    ADC_Init(ADCx, &amp;ADC_InitStructure);<br><br>    ADC_Cmd(ADCx, ENABLE);<br><br>    <span class="hljs-comment">// ADCè®¾å¤‡æ ¡å‡†</span><br>    ADC_ResetCalibration(ADCx);<span class="hljs-comment">//å¤ä½æ ¡å‡†å¯„å­˜å™¨</span><br>    <span class="hljs-keyword">while</span> (ADC_GetResetCalibrationStatus(ADCx));<br>    ADC_StartCalibration(ADCx);<span class="hljs-comment">//æ ¡å‡†ADC1</span><br>    <span class="hljs-keyword">while</span> (ADC_GetCalibrationStatus(ADCx));<span class="hljs-comment">//ç­‰å¾…æ ¡å‡†å®Œæˆ</span><br>    ADC_SoftwareStartConvCmd(ADCx, ENABLE);<span class="hljs-comment">//ä½¿èƒ½æŒ‡å®šçš„ADC1çš„è½¯ä»¶è½¬æ¢å¯åŠ¨åŠŸèƒ½</span><br>&#125;<br><br><span class="hljs-type">uint16_t</span> <span class="hljs-title function_">AD_getValue</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    <span class="hljs-comment">/* while (ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC) == RESET); //ç­‰å¾…è½¬æ¢ç»“æŸ */</span><br>    <span class="hljs-keyword">return</span> ADC_GetConversionValue(ADCx);<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>åµŒå…¥å¼ï¼šDMAè½¬è¿</title>
    <link href="/2023/11/08/DMA(Direct%20Memory%20Access)/"/>
    <url>/2023/11/08/DMA(Direct%20Memory%20Access)/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€.ç¬”è®°">ä¸€.ç¬”è®°</h2><p>c8t6 DMA1 7ä¸ªé€šé“</p><table><thead><tr class="header"><th>ç±»å‹</th><th>èµ·å§‹åœ°å€</th><th>å­˜å‚¨å™¨</th><th>ç”¨é€”</th></tr></thead><tbody><tr class="odd"><td>ROM</td><td>0x0800 0000</td><td>Flashä¸»é—ªå­˜ FLASH_BASE</td><td>å­˜å‚¨ç¼–è¯‘åçš„ä»£ç </td></tr><tr class="even"><td></td><td>0x1FFF F000</td><td>ç³»ç»Ÿå­˜å‚¨å™¨</td><td>bootloader / download</td></tr><tr class="odd"><td></td><td>0x1FFF F800</td><td>é€‰é¡¹å­—èŠ‚</td><td>ç‹¬ç«‹äºç¨‹åºä»£ç çš„é…ç½®ï¼ˆWDG,flashè¯»ä¿æŠ¤ï¼Œå†™ä¿æŠ¤ï¼‰</td></tr><tr class="even"><td>RAM</td><td>0x2000 0000</td><td>è¿å­˜SRAM SRAM_BASE</td><td>==ç”µè„‘çš„å†…å­˜</td></tr><tr class="odd"><td></td><td>0x4000 0000</td><td>å¤–è®¾å¯„å­˜å™¨ PERIPH_BASE</td><td>å¤–è®¾é…ç½®</td></tr><tr class="even"><td></td><td>0xE000 0000</td><td>å†…æ ¸å¤–è®¾å¯„å­˜å™¨</td><td>å†…æ ¸å¤–è®¾é…ç½®NVIC Systick</td></tr></tbody></table><p>DMAåŸºæœ¬ç»“æ„å›¾ï¼š</p><center><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/DMA103942A2A83620881B1141EA26C1A230.png" /></center><p>1.APB1 APB2çš„å¤–è®¾å¯ä»¥é€šè¿‡ DMAè¯·æ±‚ å‘DMAå‘å‡ºç¡¬ä»¶è§¦å‘ä¿¡å·ï¼ˆADCè½¬æ¢å®Œæˆï¼Œä¸²å£æ”¶åˆ°æ•°æ®æ—¶ï¼‰è¯·æ±‚DMAè½¬è¿æ•°æ®ã€‚</p><p>2.CPUæˆ–DMAæ— æ³•å†™å…¥ Flashï¼Œå¯ä»¥è¯»å†™SRAMã€‚</p><p>3.ä¸èƒ½åœ¨DMAå¼€å¯æ—¶å†™ä¼ è¾“è®¡æ•°å™¨ï¼Œå…ˆç”¨DMA_Cmd disable å† enableã€‚</p><p>4.M2M == 1æ—¶è½¯ä»¶è§¦å‘ï¼Œ0æ—¶ç¡¬ä»¶è§¦å‘ã€‚</p><h2 id="äºŒ.åº”ç”¨dmaæ•°æ®è½¬è¿">äºŒ.åº”ç”¨DMAæ•°æ®è½¬è¿</h2><p>copy dataA[] 2 dataB[]</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">dmaInit</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> first, <span class="hljs-type">uint32_t</span> second, <span class="hljs-type">uint16_t</span> size)</span> &#123;<br>    RCC_AHBPeriphClockCmd(RCC_AHBPeriph_DMA1, ENABLE);<span class="hljs-comment">//ä½¿èƒ½DMAæ—¶é’Ÿ</span><br>    <br>    DMA_InitTypeDef DMA_InitStructure;<br>    DMA_InitStructure.DMA_PeripheralBaseAddr = first;<br>    DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Byte; <span class="hljs-comment">// å¤–è®¾æ•°æ®é•¿åº¦ä¸º8ä½</span><br>    DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Enable;<span class="hljs-comment">//å¤–è®¾åœ°å€è‡ªå¢</span><br>    DMA_InitStructure.DMA_MemoryBaseAddr = second;<br>    DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Byte; <span class="hljs-comment">// å†…å­˜æ•°æ®é•¿åº¦ä¸º8ä½</span><br>    DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable; <span class="hljs-comment">// ä½¿èƒ½å†…å­˜åœ°å€è‡ªå¢</span><br>    DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralSRC;<span class="hljs-comment">//æ•°æ®ä¼ è¾“æ–¹å‘ï¼ŒPeriph -&gt; Memory</span><br>    DMA_InitStructure.DMA_BufferSize = size;<span class="hljs-comment">//ä¼ è¾“è®¡æ•°å™¨</span><br>    DMA_InitStructure.DMA_Mode = DMA_Mode_Normal; <span class="hljs-comment">// æ­£å¸¸æ¨¡å¼,ä¸è‡ªåŠ¨é‡è£…</span><br>    DMA_InitStructure.DMA_Priority = DMA_Priority_Medium; <span class="hljs-comment">// ä¸­ç­‰ä¼˜å…ˆçº§</span><br>    DMA_InitStructure.DMA_M2M = DMA_M2M_Enable; <span class="hljs-comment">// ç¦æ­¢å†…å­˜åˆ°å†…å­˜ä¼ è¾“</span><br>    DMA_Init(DMA1_Channel1, &amp;DMA_InitStructure);<br><br>    DMA_Cmd(DMA1_Channel1, ENABLE);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸‰.adcæ‰«ææ¨¡å¼dma">ä¸‰.ADCæ‰«ææ¨¡å¼+DMA</h2><p>ADCæ‰«ææ¨¡å¼æœ‰æ•°æ®è¦†ç›–çš„ç‰¹æ€§ADC_DRå¯„å­˜å™¨ï¼Œé…åˆDMAè¿›è¡Œæ•°æ®è½¬è¿ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>åµŒå…¥å¼ï¼šMPU6050é™€èºä»ª</title>
    <link href="/2023/11/02/Week4%20MPU6050%E9%99%80%E8%9E%BA%E4%BB%AA/"/>
    <url>/2023/11/02/Week4%20MPU6050%E9%99%80%E8%9E%BA%E4%BB%AA/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€.mpuè¯»å–pitché€šè¿‡ä¸²å£è¾“å‡º">ä¸€.mpuè¯»å–pitché€šè¿‡ä¸²å£è¾“å‡º</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><br><span class="hljs-type">float</span> pitch, roll, yaw;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);<br>    Serial_Init(<span class="hljs-number">9600</span>); <span class="hljs-comment">//ä¸²å£åˆå§‹åŒ–ï¼Œæ³¢ç‰¹ç‡9600</span><br>    MPU_Init();<span class="hljs-comment">//é™€èºä»ªåˆå§‹åŒ–</span><br>    mpu_dmp_init();<br>    LED_Init(GPIOC, GPIO_Pin_13);<span class="hljs-comment">//åˆå§‹åŒ–PC13å°ç¯</span><br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">if</span> (mpu_dmp_get_data(&amp;pitch, &amp;roll, &amp;yaw) == <span class="hljs-number">0</span>) &#123;<br>            LED_Switch(GPIOC, GPIO_Pin_13);<br>            <span class="hljs-comment">// å¦‚æœæ­£å¸¸å¾—åˆ°mpu6050æ•°æ® åˆ‡æ¢å°ç¯çŠ¶æ€</span><br>        &#125;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot; %.3f \r\n&quot;</span>, pitch);<span class="hljs-comment">// ä¸²å£è¾“å‡º</span><br>        Delay_ms(<span class="hljs-number">50</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href=""><imgsrc="https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*NNs6TKOR3isAAAAAAAAAAABkARQnAQ"alt="5033848b41d50b9b450170bba370e446.mp4 (2.94MB)" /></a><ahref="https://www.yuque.com/attachments/yuque/0/2023/zip/39043553/1698922853602-f26bf8d2-67b6-4749-adaa-c7d2266a0da1.zip?_lake_card=%7B%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2023%2Fzip%2F39043553%2F1698922853602-f26bf8d2-67b6-4749-adaa-c7d2266a0da1.zip%22%2C%22name%22%3A%22stm32Projectsp1.zip%22%2C%22size%22%3A10792428%2C%22ext%22%3A%22zip%22%2C%22source%22%3A%22%22%2C%22status%22%3A%22done%22%2C%22download%22%3Atrue%2C%22taskId%22%3A%22uf03b097b-91dd-422c-ba45-9e707a0accf%22%2C%22taskType%22%3A%22upload%22%2C%22type%22%3A%22application%2Fx-zip-compressed%22%2C%22__spacing%22%3A%22both%22%2C%22mode%22%3A%22title%22%2C%22id%22%3A%22ua09ddbcd%22%2C%22margin%22%3A%7B%22top%22%3Atrue%2C%22bottom%22%3Atrue%7D%2C%22card%22%3A%22file%22%7D">stm32Projectsp1.zip</a>## äºŒ.å¹³å‡å€¼æ»¤æ³¢ <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;stm32f10x.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;filter.h&quot;</span></span><br><br><span class="hljs-comment">//åˆå§‹åŒ–ï¼ŒæŠŠfilteræ¸…é›¶</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">AverFilter_Init</span><span class="hljs-params">(AverFilter *filter)</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; WINDOW_SIZE; i++) &#123;<br>        filter-&gt;data[i] = <span class="hljs-number">0.0</span>;<br>    &#125;<br>    filter-&gt;pivot = <span class="hljs-number">0</span>;<br>    filter-&gt;count = <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">//æ·»åŠ ä¸€ä¸ªæ•°æ®åˆ°æ•°æ®ç¼“å†²åŒº</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">AverFilter_AddData</span><span class="hljs-params">(AverFilter *filter, <span class="hljs-type">float</span> data)</span> &#123;<br>    filter-&gt;data[filter-&gt;pivot] = data;<br>    filter-&gt;pivot = (filter-&gt;pivot + <span class="hljs-number">1</span>) % WINDOW_SIZE; <span class="hljs-comment">//å¾ªç¯æ•°æ®ç¼“å†²åŒº</span><br>    <span class="hljs-keyword">if</span> (filter-&gt;count &lt; WINDOW_SIZE) &#123;<br>        filter-&gt;count++;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ±‚å’Œå¹¶æ±‚å¹³å‡å€¼</span><br><span class="hljs-type">float</span> <span class="hljs-title function_">AverFilter_GetResult</span><span class="hljs-params">(AverFilter *filter)</span> &#123;<br>    <span class="hljs-type">float</span> sum = <span class="hljs-number">0.0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; filter-&gt;count; i++) &#123;<br>        sum += filter-&gt;data[i];<br>    &#125;<br>    <span class="hljs-keyword">return</span> sum / filter-&gt;count;<br>&#125;<br><br></code></pre></td></tr></table></figure> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __FILTER_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __FILTER_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> WINDOW_SIZE 5 <span class="hljs-comment">// æ±‚å¹³å‡å€¼æ—¶ä¸€ç»„æ•°æ®çš„ä¸ªæ•°</span></span><br><br><span class="hljs-comment">//AverFilterç»“æ„ä½“ï¼Œdata[]ä¸ºæ•°æ®ç¼“å†²åŒºï¼ŒpivotæŒ‡é’ˆï¼Œcountä¸ºä¸ªæ•°</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>    <span class="hljs-type">float</span> data[WINDOW_SIZE];<br>    <span class="hljs-type">uint8_t</span> pivot;<br>    <span class="hljs-type">uint8_t</span> count;<br><br>&#125; AverFilter;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">AverFilter_Init</span><span class="hljs-params">(AverFilter *filter)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">AverFilter_AddData</span><span class="hljs-params">(AverFilter *filter, <span class="hljs-type">float</span> data)</span>;<br><span class="hljs-type">float</span> <span class="hljs-title function_">AverFilter_GetResult</span><span class="hljs-params">(AverFilter *filter)</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure> <a href=""><imgsrc="https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*NNs6TKOR3isAAAAAAAAAAABkARQnAQ"alt="31bef6d0b0c64834275030f573f8ad1c.mp4 (4.3MB)" /></a><ahref="https://www.yuque.com/attachments/yuque/0/2023/zip/39043553/1698922853839-08a3a415-b9eb-4bc2-98a6-fc1c6ff9af9c.zip">stm32Projectsp2.zip</a>## ä¸‰.OLEDæ˜¾ç¤ºpitchæ•°æ® <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">float</span> pitch, roll, yaw;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);<br>    Serial_Init(<span class="hljs-number">9600</span>); <span class="hljs-comment">//ä¸²å£åˆå§‹åŒ–ï¼Œæ³¢ç‰¹ç‡9600</span><br>    MPU_Init();<br>    mpu_dmp_init();<br>    LED_Init(GPIOC, GPIO_Pin_13); <span class="hljs-comment">//åˆå§‹åŒ–PC13å°ç¯</span><br><br>    <span class="hljs-comment">// åˆå§‹åŒ–OLED</span><br>    OLED_Init();<br>    OLED_ColorTurn(<span class="hljs-number">0</span>);<br>    OLED_DisplayTurn(<span class="hljs-number">1</span>);<br>    OLED_ShowString(<span class="hljs-number">70</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;pitch&quot;</span>, <span class="hljs-number">16</span>, <span class="hljs-number">1</span>);<br>    OLED_Refresh();<br><br>    <span class="hljs-type">char</span> res[<span class="hljs-number">10</span>]; <span class="hljs-comment">//reså­—ç¬¦ä¸²æ¥å—pitchæ•°æ®</span><br><br>    AverFilter pitchFilter;<br>    AverFilter_Init(&amp;pitchFilter);<span class="hljs-comment">//åˆå§‹åŒ–å¹³å‡å€¼æ»¤æ³¢</span><br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; WINDOW_SIZE; i++) &#123;<br>            <span class="hljs-keyword">if</span> (mpu_dmp_get_data(&amp;pitch, &amp;roll, &amp;yaw) == <span class="hljs-number">0</span>) &#123;<br>                LED_Switch(GPIOC, GPIO_Pin_13);<br>                <span class="hljs-comment">// å¦‚æœæ­£å¸¸å¾—åˆ°é™€èºä»ªæ•°æ®ï¼Œåˆ‡æ¢å°ç¯çŠ¶æ€</span><br>            &#125;<br>            AverFilter_AddData(&amp;pitchFilter, pitch);<span class="hljs-comment">//æ·»åŠ pitchåˆ°data[]ä¸­</span><br>            Delay_ms(<span class="hljs-number">10</span>);<br>        &#125;<br>        <span class="hljs-built_in">sprintf</span>(res, <span class="hljs-string">&quot; %.3f&quot;</span>, AverFilter_GetResult(&amp;pitchFilter)); <span class="hljs-comment">// sprintfå‡½æ•°ç”¨äºæŠŠæµ®ç‚¹è½¬ä¸ºchar[]ä¿ç•™ä¸‰ä½å°æ•°</span><br><br>        OLED_ShowString(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, res, <span class="hljs-number">16</span>, <span class="hljs-number">1</span>);<span class="hljs-comment">//æ‰“å°å¹³å‡å€¼æ»¤æ³¢åçš„pitchæ•°æ®</span><br>        OLED_Refresh();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure> <a href=""><imgsrc="https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*NNs6TKOR3isAAAAAAAAAAABkARQnAQ"alt="4a36b286086c4ad3eddea0b12f84aced.mp4 (7.72MB)" /></a><ahref="https://www.yuque.com/attachments/yuque/0/2023/zip/39043553/1698922854047-ee8498ea-d342-4008-9c15-fec3faec2e8a.zip">stm32Projectsp3.zip</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>åµŒå…¥å¼ï¼šTIMå®šæ—¶å™¨</title>
    <link href="/2023/10/09/Week3%20TIM%E5%AE%9A%E6%97%B6%E5%99%A8%EF%BC%88%E5%91%BC%E5%90%B8%E7%81%AF%EF%BC%8C%E8%88%B5%E6%9C%BA%EF%BC%8C%E8%B6%85%E5%A3%B0%E6%B3%A2%EF%BC%89/"/>
    <url>/2023/10/09/Week3%20TIM%E5%AE%9A%E6%97%B6%E5%99%A8%EF%BC%88%E5%91%BC%E5%90%B8%E7%81%AF%EF%BC%8C%E8%88%B5%E6%9C%BA%EF%BC%8C%E8%B6%85%E5%A3%B0%E6%B3%A2%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€.å‘¼å¸ç¯">ä¸€.å‘¼å¸ç¯</h2><h6 id="ä»£ç ">1.ä»£ç </h6><p>ç›´æ¥ç”¨äº†èˆµæœºçš„ä»£ç ï¼Œåœ¨mainä¸­å¾ªç¯è°ƒèŠ‚CCRå¯„å­˜å™¨ <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;stm32f10x.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;oled.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;pwm.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;IC.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;key.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);<br>OLED_Init();<br>OLED_ColorTurn(<span class="hljs-number">0</span>);<br>OLED_DisplayTurn(<span class="hljs-number">1</span>);<br><br>PWM_Init();<br><span class="hljs-comment">// IC_Init();</span><br><span class="hljs-comment">// key_Init();</span><br><br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) &#123;<br><span class="hljs-comment">// ç¬¬äºŒè¡Œæ˜¾ç¤º TIM2 è®¡æ—¶å™¨</span><br><span class="hljs-comment">// OLED_ShowNum(1, 16, TIM_GetCounter(TIM2), 6, 16, 1);</span><br><span class="hljs-comment">// OLED_Refresh();</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">100</span>; i++) &#123;<br>PWM_setCompare1(i);<br>Delay_ms(<span class="hljs-number">10</span>);<br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">100</span>; i++) &#123;<br>PWM_setCompare1(<span class="hljs-number">100</span> - i);<br>Delay_ms(<span class="hljs-number">10</span>);<br>&#125;<br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">PWM_Init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2, ENABLE);<br>    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);<br><br>    GPIO_startUp(GPIOA, GPIO_Pin_0, GPIO_Mode_AF_PP);<br><br>    Timer_Init(TIM2, <span class="hljs-number">20000</span> - <span class="hljs-number">1</span>, <span class="hljs-number">72</span> - <span class="hljs-number">1</span>);<br><br>    <span class="hljs-comment">// TIM O(utput) C(Compare) è¾“å‡ºæ¯”è¾ƒåˆå§‹åŒ–</span><br>    TIM_OCInitTypeDef TIM_OCInitStructure;<br>    TIM_OCStructInit(&amp;TIM_OCInitStructure);<br>    TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;<br>    TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;<br>    TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;<br>    TIM_OCInitStructure.TIM_Pulse = <span class="hljs-number">500</span>;              <span class="hljs-comment">// CCR</span><br>    TIM_OC1Init(TIM2, &amp;TIM_OCInitStructure);<br><br>    TIM_Cmd(TIM2, ENABLE);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">PWM_setCompare1</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> cmp)</span> &#123;<br><br>    TIM_SetCompare1(TIM2, cmp);<br>&#125;<br><br><span class="hljs-comment">// è®¾ç½® PSC -&gt; PWM é¢‘ç‡</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">PWM_setPrescaler</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> prescaler)</span> &#123;<br>    TIM_PrescalerConfig(TIM2, prescaler, TIM_PSCReloadMode_Update);<br>&#125;<br></code></pre></td></tr></table></figure> ###### 2.æ¼”ç¤ºè§†é¢‘ <ahref="!%5B%5D(https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/week3image.png)"><imgsrc="" alt="701ffb9687b5dce5ecb368f23a32d10b.mp4 (864.09KB)" /></a> ##äºŒ.èˆµæœºé©±åŠ¨ ###### 1.ä»£ç  (1)360èˆµæœº<br />èˆµæœºå‘¨æœŸ 20ms 50Hz<br />CK_PSC / (ARR + 1) / (PSC + 1) = 50 ARR + 1 = 20000 PSC + 1 =72<br />f = CK_PSC / (PSC + 1) = 1MHz T = 1 / 1M = 10^3ms<br />ç»æµ‹è¯•CCRé¡ºæ—¶é’ˆæœ‰æ•ˆå€¼: 414 ~ 1460 å¯¹åº” 0.414ms ~ 1.46ms å ç©ºæ¯”:2.07% ~ 7.3%<br /> é€†æ—¶é’ˆæœ‰æ•ˆå€¼ï¼š1528 ~ 2573 1.528ms ~ 2.573mså ç©ºæ¯”ï¼š7.64% ~ 12.865% <br />ç¦» 1.5msè¶Šè¿œè½¬é€Ÿè¶Šå¿«?<br />(2)180èˆµæœº<br /> <imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/week3image.png" /><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">PWM_Init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2, ENABLE);<br>    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);<br><br>    GPIO_startUp(GPIOA, GPIO_Pin_0, GPIO_Mode_AF_PP);<br><br>    Timer_Init(TIM2, <span class="hljs-number">20000</span> - <span class="hljs-number">1</span>, <span class="hljs-number">72</span> - <span class="hljs-number">1</span>);<br><br>    <span class="hljs-comment">// TIM OC è¾“å‡ºæ•è·åˆå§‹åŒ–</span><br>    TIM_OCInitTypeDef TIM_OCInitStructure;<br>    TIM_OCStructInit(&amp;TIM_OCInitStructure);<br>    TIM_OCInitStructure.TIM_OCMode = TIM_OCMode_PWM1;<br>    TIM_OCInitStructure.TIM_OCPolarity = TIM_OCPolarity_High;<br>    TIM_OCInitStructure.TIM_OutputState = TIM_OutputState_Enable;<br>    TIM_OCInitStructure.TIM_Pulse = <span class="hljs-number">500</span>;              <span class="hljs-comment">// CCR</span><br>    TIM_OC1Init(TIM2, &amp;TIM_OCInitStructure);<br><br>    TIM_Cmd(TIM2, ENABLE);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">PWM_setCompare1</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> cmp)</span> &#123;<br><br>    TIM_SetCompare1(TIM2, cmp);<br>&#125;<br><br><span class="hljs-comment">// è®¾ç½® PSC -&gt; PWM é¢‘ç‡</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">PWM_setPrescaler</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> prescaler)</span> &#123;<br>    TIM_PrescalerConfig(TIM2, prescaler, TIM_PSCReloadMode_Update);<br>&#125;<br></code></pre></td></tr></table></figure> ###### 2.æ¼”ç¤ºè§†é¢‘ <a href=""><imgsrc="https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*NNs6TKOR3isAAAAAAAAAAABkARQnAQ"alt="8954ffc9eafc0c1970fb15a2d82a98eb.mp4 (322.14KB)" /></a>##ä¸‰.è¶…å£°æ³¢æµ‹è· å®ç°æŒ‰ä¸€ä¸‹æŒ‰é”®åœ¨oledç¬¬ä¸€è¡Œæ‰“å°è·ç¦»(cm) ###### 1.æ ¸å¿ƒä»£ç startTimeè®°å½• CCR1 endTimeè®°å½• CCR2ï¼Œé€šè¿‡æ—¶é—´å·®å¾—åˆ°è·ç¦»ã€‚capturedç›¸ç­‰äºä¸€ä¸ªæ ‡å¿— =0ç­‰å¾…æ•è·ä¸Šå‡ï¼Œ= 1ç­‰å¾…æ•è·ä¸‹é™ã€‚<br />Timer_InitNVIC_startup GPIO_startupåœ¨general.cä¸­å†™å¥½çš„å‡½æ•°ï¼Œæ–¹ä¾¿è°ƒç”¨ã€‚<br />ä¸»è¦å­¦ä¹ äº† TIM_PWMIConfig()å‡½æ•°ï¼Œå®ƒå¯é…ç½®ä¸¤ä¸ªé€šé“æ•è·ä¸€ä¸ª GPIOå¼•è„šï¼ˆechoï¼‰ï¼Œçœ‹äº†å®šä¹‰å‘ç°å°±æ˜¯æŠŠæ‰€æœ‰å–åæ¯”å¦‚falling -&gt; risingï¼Œdirect-&gt; inDirecté…ç½®ç»™å¦å¤–ä¸€ä¸ªé€šé“ã€‚ <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">uint32_t</span> startTime = <span class="hljs-number">0</span>, endTime = <span class="hljs-number">0</span>;<br><span class="hljs-type">uint8_t</span> captured = <span class="hljs-number">0</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">IC_trigger</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    <span class="hljs-comment">// å°†Trigå¼•è„šè®¾ç½®ä¸ºä½ç”µå¹³</span><br>    GPIO_ResetBits(GPIOB, GPIO_Pin_5);<br>    Delay_us(<span class="hljs-number">2</span>); <span class="hljs-comment">// çŸ­æš‚å»¶æ—¶</span><br><br>    <span class="hljs-comment">// ç”Ÿæˆä¸€ä¸ªé«˜ç”µå¹³è„‰å†²</span><br>    GPIO_SetBits(GPIOB, GPIO_Pin_5);<br>    Delay_us(<span class="hljs-number">20</span>);<br><br>    <span class="hljs-comment">// å†æ¬¡å°†Trigå¼•è„šè®¾ç½®ä¸ºä½ç”µå¹³</span><br>    GPIO_ResetBits(GPIOB, GPIO_Pin_5);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">IC_Init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2, ENABLE);<br><br>    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);<br>    GPIO_startUp(GPIOA, GPIO_Pin_0, GPIO_Mode_IN_FLOATING); <span class="hljs-comment">// é…ç½®echoå¼•è„š æµ®ç©ºè¾“å…¥</span><br><br>    Timer_Init(TIM2, <span class="hljs-number">65536</span> - <span class="hljs-number">1</span>, <span class="hljs-number">7200</span> - <span class="hljs-number">1</span>); <span class="hljs-comment">// Timer_Init(TIMx, period, preScaler)</span><br><br>    TIM_ICInitTypeDef TIM_ICInitStructure;<br>    TIM_ICInitStructure.TIM_Channel = TIM_Channel_1;<br>    TIM_ICInitStructure.TIM_ICFilter = <span class="hljs-number">0xF</span>;<br>    TIM_ICInitStructure.TIM_ICPolarity = TIM_ICPolarity_Rising;<br>    TIM_ICInitStructure.TIM_ICPrescaler = TIM_ICPSC_DIV1;<br>    TIM_ICInitStructure.TIM_ICSelection = TIM_ICSelection_DirectTI;<br>    TIM_PWMIConfig(TIM2, &amp;TIM_ICInitStructure);<br><br>    <span class="hljs-comment">// é€šé“1æ•æ‰ä¸Šå‡æ²¿ï¼Œé€šé“2æ•æ‰ä¸‹é™æ²¿</span><br>    TIM_ITConfig(TIM2, TIM_IT_CC1, ENABLE);<br>    TIM_ITConfig(TIM2, TIM_IT_CC2, ENABLE);<br>    NVIC_startUp(TIM2_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>    TIM_Cmd(TIM2, ENABLE);<br>&#125;<br><br><span class="hljs-comment">// è¶…å£°æ³¢ä¸­æ–­å‡½æ•°</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">TIM2_IRQHandler</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    <span class="hljs-keyword">if</span>(TIM_GetITStatus(TIM2, TIM_IT_CC1) == SET) &#123;<br>        <span class="hljs-keyword">if</span>(captured == <span class="hljs-number">0</span>) &#123;<br>            startTime = TIM_GetCapture1(TIM2);<br>            captured = <span class="hljs-number">1</span>;<br>        &#125;<br>        TIM_ClearITPendingBit(TIM2, TIM_IT_CC1);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (TIM_GetITStatus(TIM2, TIM_IT_CC2) == SET) &#123;<br>        <span class="hljs-keyword">if</span> (captured == <span class="hljs-number">1</span>) &#123;<br>            endTime = TIM_GetCapture2(TIM2);<br><br>            <span class="hljs-keyword">if</span> (endTime &gt;= startTime) &#123;<br>                <span class="hljs-comment">// åŠ ä¸Šåˆ¤æ–­é˜²æ­¢å‡ºç° start å’Œ end ä¹‹é—´è®¡æ•°å™¨æº¢å‡ºçš„æƒ…å†µ</span><br>                <span class="hljs-type">uint32_t</span> delta = endTime - startTime;<br>                <span class="hljs-type">float</span> distance = (<span class="hljs-type">float</span>)delta * <span class="hljs-number">3.43</span> / <span class="hljs-number">2</span>;  <span class="hljs-comment">// 72MHz / 7200 = 10^4Hz deltaå•ä½æ˜¯ 10^-4 s</span><br>                <span class="hljs-type">char</span> s[<span class="hljs-number">10</span>];<br>                <span class="hljs-built_in">sprintf</span>(s, <span class="hljs-string">&quot;%.3f&quot;</span>, distance);              <span class="hljs-comment">// float2string </span><br>                OLED_ShowString(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, s, <span class="hljs-number">16</span>, <span class="hljs-number">1</span>);<br>                OLED_Refresh();<br>            &#125;<br>            captured = <span class="hljs-number">0</span>;<br>        &#125;<br>            <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure> æŒ‰é”®ä¸­æ–­è°ƒç”¨IC_trigger() <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">key_Init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br><br>RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);<br>RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO, ENABLE);<br>GPIO_startUp(GPIOB, GPIO_Pin_15, GPIO_Mode_IPD); <span class="hljs-comment">// PB15æ¥æŒ‰é”® OUT</span><br>GPIO_startUp(GPIOB, GPIO_Pin_5, GPIO_Mode_Out_PP);       <span class="hljs-comment">// PB5 æ¥è¶…å£°æ³¢ trig</span><br><br>GPIO_EXTILineConfig(GPIO_PortSourceGPIOB, GPIO_PinSource15);<br><span class="hljs-comment">//é…ç½® EXTI å¤–éƒ¨ä¸­æ–­</span><br>EXTI_InitTypeDef EXTI_InitStructure;<br>EXTI_InitStructure.EXTI_Line = EXTI_Line15;<br>EXTI_InitStructure.EXTI_LineCmd = ENABLE;<br>EXTI_InitStructure.EXTI_Mode = EXTI_Mode_Interrupt;<br>EXTI_InitStructure.EXTI_Trigger = EXTI_Trigger_Rising;<br><br>EXTI_Init(&amp;EXTI_InitStructure);<br>NVIC_startUp(EXTI15_10_IRQn, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">EXTI15_10_IRQHandler</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br><span class="hljs-keyword">if</span>(EXTI_GetITStatus(EXTI_Line15) == SET) &#123;<br>        Delay_ms(<span class="hljs-number">20</span>); <span class="hljs-comment">// æ¶ˆæŠ–</span><br>        <span class="hljs-keyword">if</span>(GPIO_ReadInputDataBit(GPIOB, GPIO_Pin_15)) &#123;<br>            IC_trigger();<br>        &#125;<br>        EXTI_ClearITPendingBit(EXTI_Line15);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;stm32f10x.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;oled.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;pwm.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;IC.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;key.h&quot;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2); <span class="hljs-comment">// é…ç½®NIVCä¼˜å…ˆçº§åˆ†ç»„æ¨¡å¼</span><br>OLED_Init();<br>OLED_ColorTurn(<span class="hljs-number">0</span>);<br>OLED_DisplayTurn(<span class="hljs-number">1</span>);<br><br><span class="hljs-comment">// PWM_Init();</span><br>IC_Init();<br>key_Init();<br><br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-comment">// ç¬¬äºŒè¡Œæ˜¾ç¤º TIM2 è®¡æ—¶å™¨</span><br>OLED_ShowNum(<span class="hljs-number">1</span>, <span class="hljs-number">16</span>, TIM_GetCounter(TIM2), <span class="hljs-number">6</span>, <span class="hljs-number">16</span>, <span class="hljs-number">1</span>);<br>OLED_Refresh();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure> ###### 2.æ¼”ç¤ºè§†é¢‘ <ahref=""><imgsrc="https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*NNs6TKOR3isAAAAAAAAAAABkARQnAQ"alt="152daad5860ce566c6cb966a325d4093.mp4 (4.06MB)" /></a>## å››.é¡¹ç›®æ–‡ä»¶<ahref="https://www.yuque.com/attachments/yuque/0/2023/zip/39043553/1697622338744-a22dd6ec-0945-4985-8881-09d0f2db55ec.zip">stm32Projects3.zip</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>åµŒå…¥å¼ï¼šUARTä¸²å£é€šä¿¡</title>
    <link href="/2023/09/30/Week2%20USART%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1/"/>
    <url>/2023/09/30/Week2%20USART%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€.å®ç°æ•ˆæœ">ä¸€.å®ç°æ•ˆæœ</h2><p>AAåŒ…å¤´ C6 FFåŒ…å°¾ å¯å˜åŒ…é•¿hexæ•°æ®åŒ…<br />a.ä¸²å£ç‚¹ç¯ åªæœ‰å‘é€ AA 20 50AB C6 FFæŒ‡ä»¤ç‚¹ç¯ï¼ŒOLEDæ‰“å°"Led on"ï¼ŒæŒ‡ä»¤ä¸åˆæ³•åˆ™æ‰“å°"ERROR"<br />b.è“ç‰™ç”µç¯æ•ˆæœåŒä¸Š<br />c.è“ç‰™æ¥æ”¶æ•°æ®åŒ…ï¼Œå†å‘é€å›ä¸Šä½æœº ## äºŒ.ä»£ç æ³¨é‡Š1.ä¸²å£ä»£ç åœ¨ Serial.c å’Œ Serial.h ä¸­ <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __SERIAL_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __SERIAL_H</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;stm32f10x.h&quot;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">uint8_t</span> pivot;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Serial_Init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">Serial_SendByte</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> byte)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">Serial_SendArray</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> *<span class="hljs-built_in">array</span>, <span class="hljs-type">uint16_t</span> length)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">Serial_SendString</span><span class="hljs-params">(<span class="hljs-type">char</span> *<span class="hljs-built_in">string</span>)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">Serial_SendPacket</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> *packet)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">Serial_Printf</span><span class="hljs-params">(<span class="hljs-type">char</span> *format, ...)</span>;<br><br><span class="hljs-type">uint16_t</span> <span class="hljs-title function_">Serial_ReadByte</span><span class="hljs-params">(USART_TypeDef *USARTx)</span>;<br><br><span class="hljs-type">uint8_t</span>* <span class="hljs-title function_">getRxPacket</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><span class="hljs-type">uint8_t</span> <span class="hljs-title function_">getRxFlag</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;stm32f10x.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdarg.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LEN 256</span><br><br><span class="hljs-type">uint8_t</span> pivot = <span class="hljs-number">0</span>;<br><span class="hljs-type">uint8_t</span> Serial_RxPacket[LEN];<br><span class="hljs-type">uint8_t</span> RxFlag; <span class="hljs-comment">// æ¥å—åˆ°æ•°æ®æ ‡å¿—</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Serial_Init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>RCC_APB1PeriphClockCmd(RCC_APB1Periph_USART3, ENABLE);<br>RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);<span class="hljs-comment">// USART3 å¯¹åº” PB10 TX PB11 RX</span><br><br>GPIO_InitTypeDef GPIO_InitStructure;<br><span class="hljs-comment">// åˆå§‹åŒ– TX</span><br>GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP; <span class="hljs-comment">// å¤ç”¨æ¨æŒ½è¾“å‡º</span><br>GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10;<br>GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;<br>GPIO_Init(GPIOB, &amp;GPIO_InitStructure);<br><br><span class="hljs-comment">//åˆå§‹åŒ– RX</span><br>GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU; <span class="hljs-comment">// ä¸Šæ‹‰è¾“å…¥</span><br>GPIO_InitStructure.GPIO_Pin = GPIO_Pin_11;<br>GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;<br>GPIO_Init(GPIOB, &amp;GPIO_InitStructure);<br><br>USART_InitTypeDef USART_InitStructure;<br>USART_InitStructure.USART_BaudRate = <span class="hljs-number">9600</span>;<br>USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;<br>USART_InitStructure.USART_Mode = USART_Mode_Tx | USART_Mode_Rx;<br>USART_InitStructure.USART_Parity = USART_Parity_No; <span class="hljs-comment">// æ— æ ¡éªŒ</span><br>USART_InitStructure.USART_StopBits = USART_StopBits_1; <span class="hljs-comment">// åœæ­¢ä½é•¿åº¦</span><br>USART_InitStructure.USART_WordLength = USART_WordLength_8b;<br>USART_Init(USART3, &amp;USART_InitStructure);<br><br><span class="hljs-comment">// é…ç½®ä¸­æ–­</span><br>USART_ITConfig(USART3, USART_IT_RXNE, ENABLE);<br>NVIC_PriorityGroupConfig(NVIC_PriorityGroup_2);<br>NVIC_InitTypeDef NVIC_InitStructure;<br>NVIC_InitStructure.NVIC_IRQChannel = USART3_IRQn;<br>NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;<br>NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = <span class="hljs-number">1</span>;<br>NVIC_InitStructure.NVIC_IRQChannelSubPriority = <span class="hljs-number">1</span>;<br>NVIC_Init(&amp;NVIC_InitStructure);<br><br><span class="hljs-comment">// å¯ç”¨ USART3</span><br>USART_Cmd(USART3, ENABLE);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Serial_SendByte</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> byte)</span> &#123;<br><br>USART_SendData(USART3, byte);<br><span class="hljs-keyword">while</span>(USART_GetFlagStatus(USART3, USART_FLAG_TXE) == RESET);<br><br>&#125;<br><br><span class="hljs-comment">// whileæŸ¥è¯¢ æ¥å—æ•°æ®</span><br><span class="hljs-type">uint16_t</span> <span class="hljs-title function_">Serial_ReadByte</span><span class="hljs-params">(USART_TypeDef *USARTx)</span> &#123;<br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br><span class="hljs-keyword">if</span> (USART_GetFlagStatus(USART3, USART_FLAG_RXNE) == SET)&#123;<br><span class="hljs-keyword">return</span> USART_ReceiveData(USART3);<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// å‘é€æ•°ç»„</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Serial_SendArray</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> *<span class="hljs-built_in">array</span>, <span class="hljs-type">uint16_t</span> length)</span> &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>Serial_SendByte(<span class="hljs-built_in">array</span>[i]);<br>&#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Serial_SendString</span><span class="hljs-params">(<span class="hljs-type">char</span> *<span class="hljs-built_in">string</span>)</span> &#123;<br><span class="hljs-comment">// string ä»¥ 0x00 ç»“å°¾ï¼Œå­˜å‚¨ç©ºé—´=å­—ç¬¦ä¸ªæ•° + 1</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">uint8_t</span> i = <span class="hljs-number">0</span>; <span class="hljs-built_in">string</span>[i] != <span class="hljs-string">&#x27;\0&#x27;</span>; i++) &#123;<br>Serial_SendByte(<span class="hljs-built_in">string</span>[i]);<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// é‡å®šå‘ printf</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">fputc</span><span class="hljs-params">(<span class="hljs-type">int</span> ch, FILE *f)</span> &#123;<br>Serial_SendByte(ch);<br><span class="hljs-keyword">return</span> ch;<br>&#125;<br><br><span class="hljs-comment">// ä¼  æ¥å—æ•°æ®åŒ…æŒ‡é’ˆ</span><br><span class="hljs-type">uint8_t</span>* <span class="hljs-title function_">getRxPacket</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br><span class="hljs-keyword">return</span> Serial_RxPacket;<br>&#125;<br><br><span class="hljs-type">uint8_t</span> <span class="hljs-title function_">getRxFlag</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br><span class="hljs-keyword">if</span> (RxFlag == <span class="hljs-number">1</span>) &#123;<br>RxFlag = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// ä¸­æ–­å‡½æ•°</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">USART3_IRQHandler</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br><span class="hljs-type">static</span> <span class="hljs-type">uint8_t</span> RxState = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span> (USART_GetITStatus(USART3, USART_IT_RXNE) == SET) &#123;<br><span class="hljs-type">uint8_t</span> RxData = USART_ReceiveData(USART3);<br><br><span class="hljs-keyword">if</span>(RxState == <span class="hljs-number">0</span> &amp;&amp; RxData == <span class="hljs-number">0xAA</span>) &#123;<br>RxState = <span class="hljs-number">1</span>;<br>pivot = <span class="hljs-number">0</span>;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (RxState == <span class="hljs-number">1</span>) &#123;<br><span class="hljs-keyword">if</span>(RxData == <span class="hljs-number">0xC6</span>) &#123;<br>RxState = <span class="hljs-number">2</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>Serial_RxPacket[pivot] = RxData;<br>pivot++;<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (RxState == <span class="hljs-number">2</span> &amp;&amp; RxData == <span class="hljs-number">0xFF</span>) &#123;<br>RxState = <span class="hljs-number">0</span>;<br>RxFlag = <span class="hljs-number">1</span>;<br>&#125;<br><br>USART_ClearITPendingBit(USART3, USART_IT_RXNE);<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// å‘é€å¯å˜åŒ…é•¿HEXæ•°æ®åŒ… AAåŒ…å¤´ C6 FFåŒ…å°¾</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">Serial_SendPacket</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> *packet)</span> &#123;<br>Serial_SendByte(<span class="hljs-number">0xAA</span>);<br>Serial_SendArray(packet, pivot);<br>Serial_SendByte(<span class="hljs-number">0xC6</span>);<br>Serial_SendByte(<span class="hljs-number">0xFF</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure>å½“å‡ºå‘USART_IT_RXNEä¸­æ–­æ—¶è¿›å…¥ä¸­æ–­å‡½æ•°æ¥å—æ•°æ®åŒ…<br />æˆ‘ç”¨pivotä½œä¸ºæ¥å—æ•°ç»„çš„ç´¢å¼•ï¼ŒRxstateå˜é‡ä¿å­˜å½“å‰çŠ¶æ€:stage0:æ¥å—åŒ…å¤´å¦‚æœæ¥å— 0xAAè½¬ç§»åˆ°stage1ï¼Œå¼€å§‹æ¥å—æ•°æ®å¹¶ç›‘å¬0xC6ï¼Œå¦‚æœæ˜¯åˆ™è¿›å…¥stage2.ï¼ˆç”¨switchcaseå¥½åƒä¸è¡Œï¼Ÿï¼‰<br />uint16_t Serial_ReadByte(USART_TypeDef *USARTx)è¿™ä¸ªå‡½æ•°å¿½ç•¥ <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">uint8_t</span> cmdPacket[<span class="hljs-number">3</span>] = &#123;<span class="hljs-number">0x20</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0xAB</span>&#125;;<br><br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) &#123;<br><span class="hljs-keyword">if</span> (getRxFlag() == <span class="hljs-number">1</span>) &#123;<br><span class="hljs-type">uint8_t</span> *p = getRxPacket();<br><span class="hljs-keyword">if</span> (pivot == <span class="hljs-number">3</span>) &#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) &#123;<br><span class="hljs-keyword">if</span> (p[i] != cmdPacket[i]) &#123;<br>OLED_Clear();<br>OLED_ShowString(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;ERROR&quot;</span>, <span class="hljs-number">16</span>, <span class="hljs-number">1</span>);<br>OLED_Refresh();<br><span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (i == <span class="hljs-number">2</span>) &#123;<br>LED_Switch(GPIOB, GPIO_Pin_12 | GPIO_Pin_13 | GPIO_Pin_14);<br><span class="hljs-keyword">if</span> (GPIO_ReadOutputDataBit(GPIOB, GPIO_Pin_12) == RESET) &#123;<br>OLED_Clear();<br>OLED_ShowString(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;LED on&quot;</span>, <span class="hljs-number">16</span>, <span class="hljs-number">1</span>);<br>OLED_Refresh();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>OLED_Clear();<br>OLED_ShowString(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;LED off&quot;</span>, <span class="hljs-number">16</span>, <span class="hljs-number">1</span>);<br>OLED_Refresh();<br>&#125;<br>&#125;<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>OLED_Clear();<br>OLED_ShowString(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&quot;ERROR&quot;</span>, <span class="hljs-number">16</span>, <span class="hljs-number">1</span>);<br>OLED_Refresh();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>è¿™æ˜¯éªŒè¯æŒ‡ä»¤ä»£ç ï¼Œå†™çš„æ¯”è¾ƒä¸‘ï¼ˆåº”è¯¥å°è£…ä¸€ä¸‹ï¼‰æˆ‘æƒ³å®ç°éªŒè¯æ•°æ®åŒ…ç‚¹äº®å°ç¯ï¼ŒéªŒè¯pivot== 3ï¼ˆ0:0x20 1:0x50 2:0xABæ·»åŠ å®Œ 0xABååˆpivot++=3ï¼‰æ•°æ®é•¿åº¦æ˜¯å‰æï¼Œæ¯æ¬¡forå¾ªç¯å‰éªŒè¯RxPacketå’Œcmd_packetï¼Œå¦‚æœç¬¬2ä½0xABè¿˜æ²¡æœ‰è¢«breakæ‰è¯´æ˜éªŒè¯é€šè¿‡ã€‚## ä¸‰.æ¼”ç¤ºè§†é¢‘ a. <a href=""><imgsrc="https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*NNs6TKOR3isAAAAAAAAAAABkARQnAQ"alt="691461ea29c2b1475cffe7a93228423c.mp4 (9.68MB)" /></a>b. <ahref=""><imgsrc="https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*NNs6TKOR3isAAAAAAAAAAABkARQnAQ"alt="47919cb39dabaccd0c7269911d2b8731.mp4 (5.16MB)" /></a>c. <ahref=""><imgsrc="https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*NNs6TKOR3isAAAAAAAAAAABkARQnAQ"alt="2c6aa9966e47b381ba7d961d391b3e0c.mp4 (3.79MB)" /></a> ##å››.å·¥ç¨‹æ–‡ä»¶ <ahref="https://www.yuque.com/attachments/yuque/0/2023/zip/39043553/1698922745761-153042a6-f69f-45f6-9283-14e38826267b.zip">stm32Projects930.zip</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>åµŒå…¥å¼ï¼šGPIOç‚¹äº®å°ç¯</title>
    <link href="/2023/09/24/Week1%20%E7%82%B9%E4%BA%AE%E5%B0%8F%E7%81%AF%20GPIO/"/>
    <url>/2023/09/24/Week1%20%E7%82%B9%E4%BA%AE%E5%B0%8F%E7%81%AF%20GPIO/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€å®ç°æ•ˆæœ">ä¸€ã€å®ç°æ•ˆæœ</h2><p>a.åœ¨Delay.cä¸­å®ç°SysTickå®šæ—¶å™¨<br />ç‚¹äº®å°ç¯ï¼Œæ¯2sé—ªçƒ<br />b.æŒ‰é”®åˆ‡æ¢å°ç¯(ç›‘å¬é«˜ç”µå¹³ä¿¡å·ï¼ŒGPIOä¸‹æ‹‰è¾“å…¥)<br />## äºŒã€å¿ƒå¾—ä½“ä¼š</p><table><thead><tr class="header"><th></th><th>å¯„å­˜å™¨</th><th></th><th></th></tr></thead><tbody><tr class="odd"><td>1</td><td>CTRL</td><td>IO</td><td>Systick æ§åˆ¶åŠçŠ¶æ€</td></tr><tr class="even"><td>2</td><td>VAL</td><td>IO</td><td>å½“å‰å€¼å¯„å­˜å™¨</td></tr><tr class="odd"><td>3</td><td>LOAD</td><td>IO</td><td>é‡è£…è½½å¯„å­˜å™¨</td></tr></tbody></table><p>1.CTRL=0x00000005 = 101 <br />bit0: ENABLE 1 enable 0disable<br />bit1: TICKINT 1 æº¢å‡ºä¸­æ–­ 0 æº¢å‡ºä¸ä¸­æ–­<br />bit2: CLKSOURCE1 HCLK 0 HCLK_Div8<br />bit16: COUNTFLAG å¦‚æœåœ¨ä¸Šæ¬¡è¯»å–æœ¬å¯„å­˜å™¨åï¼ŒSysTick å·²ç»è®¡åˆ° äº† 0ï¼Œåˆ™è¯¥ä½ä¸º 1ã€‚<br />while(!(SysTick-&gt;CTRL &amp;0x00010000)); æŒ‰ä½ä¸ä»…å½“COUNTFLAGä¸º1æ—¶ç»ˆæ­¢while<br />2.VALå½“å‰è®¡æ•°å€¼<br />3.LOADå¯„å­˜å™¨å®šæ—¶å™¨é‡è£…å€¼ 72(MHzæ—¶é’Ÿé¢‘ç‡) * us(microsecond)<br /> ## ä¸‰ã€æ¼”ç¤ºè§†é¢‘ï¼ša. <a href=""><imgsrc="https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*NNs6TKOR3isAAAAAAAAAAABkARQnAQ"alt="record.mp4 (4.59MB)" /></a>b. <a href=""><imgsrc="https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*NNs6TKOR3isAAAAAAAAAAABkARQnAQ"alt="2.mp4 (2.23MB)" /></a>å››ã€é¡¹ç›®æ–‡ä»¶ï¼š<br /><ahref="https://www.yuque.com/attachments/yuque/0/2023/zip/39043553/1695379886759-4c771a32-b48a-4a4f-bdb2-a1e2ff16094e.zip">stm32Project924.zip</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>èµ¶ç´§ä¸Šè½¦ï¼šBig Suræ›´æ¢DW1820Aç½‘å¡</title>
    <link href="/2021/08/14/DW1820A/"/>
    <url>/2021/08/14/DW1820A/</url>
    
    <content type="html"><![CDATA[<p>å¤§æ¦‚ä¸¤ä¸‰å¹´å‰ï¼Œæˆ‘å¼€å§‹æ¥è§¦é»‘è‹¹æœã€‚å½“æ—¶ä½¿ç”¨é»‘æœå°å…µçš„å®‰è£…ç›˜åœ¨æˆ‘çš„è€å°å¼æœºä¸Šå®‰è£…i5-4590+ geforcegt740ï¼Œä¸€éæˆåŠŸï¼Œæ²¡æœ‰åšä»»ä½•è°ƒè¯•ã€‚å½“å±å¹•ç¬¬ä¸€æ¬¡ç‚¹äº®ï¼Œè”šè“çš„å¤©ç©ºæ˜ è¡¬ç€å¹¿è¢¤æ— é™…çš„Mojave æ²™æ¼ ï¼Œæˆ‘çœŸæ­£è¢« macOSçš„ç²¾ç¾è®¾è®¡ç”šè‡³è¯´æ˜¯ä¸€ç§è‰ºæœ¯çš„æƒ…æ€€æ‰€æŠ˜æœã€‚éšåç”±äºä¸­è€ƒå¾ˆé•¿æ—¶é—´æ²¡æœ‰ç¢°macOSï¼Œ20å¹´å¯’å‡ï¼Œä¹°äº†ä¸ªè½»è–„æœ¬ï¼Œç»è¿‡å‡ ä¸ªæœˆçš„æŠ˜è…¾åé‡æ–°åƒä¸Šäº†Catalinaã€‚</p><p>å»å¹´ WWDC å‘å¸ƒä¸Šå…¨æ–°çš„ MacBook Pro æ­è½½äº† M1èŠ¯ç‰‡ï¼Œæˆ‘éå¸¸å…´å¥‹ï¼Œä½†å¿ƒåº•å´æœ‰ä¸€ä¸é¡¾å¿Œå’Œé—æ†¾ï¼šIntelå¹³å°å¤„ç†å™¨æˆ–è®¸åœ¨å‡ å¹´ä¹‹å†…å°±ä¸å—æ”¯æŒäº†ï¼Œé»‘è‹¹æœä¹Ÿå°†å¯¿ç»ˆæ­£å¯äº†ï¼Œä¸”ç”¨ä¸”çæƒœå§ã€‚</p><p><del>æ²¡ä¸¤å¤©è‹¹æœåˆå‘å¸ƒäº†æœ€æ–°æ¬¾21å¹´ iPad Proï¼ŒåŒæ—¶æ­è½½äº†è‡ªå®¶çš„ M1èŠ¯ç‰‡ï¼Œä½ çš„ä¸‹ä¸€å°ç”µè„‘ä½•å¿…æ˜¯ç”µè„‘å‘¢ï¼Ÿï¼ˆè‹¹æœNB, yyds!ï¼‰</del></p><p><em><del>ç‰™è†å‚ï¼šWDNMDï¼Œ å§“ A çš„æ²¡ä¸€ä¸ªå¥½ä¸œè¥¿</del></em></p><hr /><p>è¿›å…¥æ­£é¢˜ï¼Œä»Šå¤©å¼€å§‹ç€æ‰‹å†™ä¸€äº›å…³äº Hackintosh çš„æ–‡ç« ã€‚</p><p>ç›®å‰æˆ‘çš„é»‘è‹¹æœä¸»åŠ›æœºæ˜¯è¿™å°ç¬”è®°æœ¬ï¼ši5-10210u 8 + 512ã€‚åŸè£…ç½‘å¡æ˜¯ IntelAC 9462ï¼ŒåŸæ¥ Catalina é‡‡ç”¨çš„æ˜¯ Airportitlwm é©±åŠ¨ï¼Œå‡çº§åˆ° Big Sur 11.2.3åç½‘ç»œå°±æ— æ³•ä½¿ç”¨äº†ï¼ŒIntel ç½‘å¡ä¸æ”¯æŒ Airdropï¼ŒHandoffä½“éªŒæœ¬æ¥å°±å·®ï¼Œç°åœ¨åˆè¦æŠ˜è…¾ã€‚æ–Ÿé…Œäº†ä¸€ä¼šï¼Œä¾¿ç‹ å¿ƒåœ¨æŸå®ä¸Š160 RMB å‰äº†å¼  DW1820Aã€‚</p><p>æ‹†å£³ï¼Œæ–­ç”µï¼Œæ¢å¡ï¼Œä¸Šç›–ä¸€å¥—æå®šï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/DW1820A01.jpeg" /></p><p>DW1820A æœ‰ä¸¤ç‰ˆæœ¬ï¼Œå…·ä½“å‹å·å¦‚ä¸‹ï¼ˆæ‘˜è‡ªé»‘æœå°å…µï¼‰ï¼š</p><p>Dell ç‰ˆ <strong>DW1820A</strong></p><table><thead><tr class="header"><th style="text-align: left;">Part Number</th><th style="text-align: left;">Manufacturer</th><th style="text-align: left;">Module</th><th style="text-align: left;">WLAN</th><th style="text-align: left;">BT 4.1</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">CN-0VW3T3</td><td style="text-align: left;">Dell Wireless 1820A 802.11ac</td><td style="text-align: left;">BCM94350ZAE_2</td><td style="text-align: left;">1028:0021</td><td style="text-align: left;">[0a5c:6412]</td></tr><tr class="even"><td style="text-align: left;">CN-0VW3T3</td><td style="text-align: left;">Dell Wireless 1820A 802.11ac</td><td style="text-align: left;">BCM94356ZEPA50DX_2</td><td style="text-align: left;">1028:0021</td><td style="text-align: left;">[0a5c:6412]</td></tr><tr class="odd"><td style="text-align: left;">CN-096JNT</td><td style="text-align: left;">Dell Wireless 1820A 802.11ac</td><td style="text-align: left;">BCM94356ZEPA50DX_2</td><td style="text-align: left;">1028:0022</td><td style="text-align: left;">[0a5c:6412]</td></tr><tr class="even"><td style="text-align: left;">CN-08PKF4</td><td style="text-align: left;">Dell Wireless 1820A 802.11ac</td><td style="text-align: left;">BCM94356ZEPA50DX_2</td><td style="text-align: left;">1028:0023</td><td style="text-align: left;">[0a5c:6412]</td></tr></tbody></table><p>è”æƒ³ç‰ˆ <strong>BCM94350</strong></p><table><thead><tr class="header"><th style="text-align: left;">Part Number</th><th style="text-align: left;">Manufacturer</th><th style="text-align: left;">Module</th><th style="text-align: left;">WLAN</th><th style="text-align: left;">BT 4.1</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">00JT493</td><td style="text-align: left;">Lenovo</td><td style="text-align: left;">BCM94350ZAE_2</td><td style="text-align: left;">1028:075a</td><td style="text-align: left;">[0a5c:6414]</td></tr><tr class="even"><td style="text-align: left;">00JT494</td><td style="text-align: left;">Lenovo</td><td style="text-align: left;">BCM94350ZAE_2</td><td style="text-align: left;">1028:075a</td><td style="text-align: left;">[0a5c:6414]</td></tr></tbody></table><p>å»ºè®®ä¼˜å…ˆé€‰æ‹©æˆ´å°” CN-0VW3T3 å’Œ CN-08PKF4ä¸¤ç§æ–™å·ã€‚å¹¶ä¸”è”æƒ³åŠç»å¤§å¤šæ•°æœºå‹éœ€è¦å±è”½é’ˆè„šï¼ˆæˆ‘çš„æœºå­ä¸éœ€è¦å±è”½ï¼Œ11å’Œ12é’ˆé•Šå­èƒ¶å¸¦è£¹ä¸€ä¸‹ï¼Œè€é¸Ÿç›´æ¥æ‰£é‡‘æ‰‹æŒ‡éƒ½è¡Œï¼‰ã€‚</p><p>ä¸€å…±éœ€è¦å››ä¸ªå†…æ ¸æ‹“å±•ï¼šAirportBrcmFixupï¼ŒBrcmBluetoothInjectorï¼ŒBrcmFirmwareDataå’Œ BrcmPatchRAM3ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªæ˜¯ WIFI é©±åŠ¨ï¼Œåä¸‰æ˜¯è“ç‰™é©±åŠ¨ï¼Œå°†ä¿¡æ¯å¡«å…¥config.plist -&gt; kernel -&gt; Add è·¯å¾„ä¸­ï¼Œä½†æœ‰ä¸¤ç‚¹è¦æ³¨æ„ï¼š</p><ul><li>æ“ä½œå‰æŠŠ EFI æ–‡ä»¶ä¸­å…¶ä»–çš„ç½‘å¡é©±åŠ¨å½»åº•åˆ é™¤ï¼Œå¦‚ Airportitlwm</li><li>æ‹†åŒ… AirportBrcmFixup åä½ ä¼šå‘ç°é›†æˆäº†ä¸¤å«æ˜Ÿæ’ä»¶ AirPortBrcm4360 å’ŒAirPortBrcmNIC_Injectorï¼ŒBig Sur ç”¨æˆ·è¯·ç§»é™¤4360ï¼Œå¦åˆ™ä¼šé€ æˆæ— æ³•å¼€æœºï¼ï¼ˆ11.5.7åŠæ›´ä½ç‰ˆæœ¬ä¿ç•™ã€‚è‹¹æœä» 11 ç‰ˆæœ¬å¼€å§‹åŠ è½½IOFamily80211 å’Œ AirPortBrcm4360 å†…æ ¸æ‹“å±•ï¼Œå¼ºåˆ¶ç”¨ OC åŠ è½½ä¼šå¯¼è‡´ KernelPanicï¼‰</li></ul><p>å®Œæˆå¦‚ä¸‹å›¾ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/DW1820A02.png" /></p><p>é‡å¯åä¸å‡ºæ„å¤–å°±èƒ½æ‰“å¼€ WIFI å’Œè“ç‰™äº†ï¼ŒAirdrop Handoffä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/DW1820A03.png" /></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>macOSä¸‹ç¼–è¯‘Leançš„Openwrtæºç </title>
    <link href="/2021/08/14/Openwrt/"/>
    <url>/2021/08/14/Openwrt/</url>
    
    <content type="html"><![CDATA[<p>è™½ç„¶è¯´æ˜¯ç”¨ macOS ç³»ç»Ÿï¼Œä½†æ˜¯åƒç¼–è¯‘è¿™ç§å·¥ä½œæ­å»ºä¸ª Dockerç¯å¢ƒå…¶å®æ˜¯ä¸€åŠ³æ°¸é€¸çš„ã€‚è¯·åˆ›å»º Ubuntu18.04LTSæˆ–20.4çš„å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨MacPorts è¿›è¡Œå®‰è£…ï¼Œå…·ä½“æ–¹æ³•ä¸å†èµ˜è¿°ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Openwrt02.png" /></p><p>Lean å¤§åœ¨ä»–çš„æºç ä»“åº“ä¸­æ˜ç¡®æ”¯æŒä¸è¦ä½¿ç”¨ rootç”¨æˆ·è¿›è¡Œç¼–è¯‘ï¼ŒæŒ‰ç…§ä»–æ‰€è®²çš„ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼Œå¹¶åœ¨ /etc/sudoers ä¸­ç»™root æƒé™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">root&amp;&gt; useradd free<br>root&amp;&gt; passwd free<br><br>root&amp;&gt; <span class="hljs-built_in">mkdir</span> /home/free &amp;&amp; <span class="hljs-built_in">chown</span> -R free /home/free <br>root&amp;&gt; vim /etc/sudoers // åˆ«å¿˜äº† wq!<br><br>root&amp;&gt; su free<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ç°åœ¨å·²ç»ä»¥ freeç”¨æˆ·çš„èº«ä»½åœ¨homeç›®å½•ï¼Œå¦‚æœä½ æ²¡æœ‰ä¸€ä¸ªç¨³å®šçš„ä¸Šç½‘ç¯å¢ƒè¿˜éœ€è¦æŠŠ apt çš„sourcelist æ”¹æˆå›½å†…æºã€‚sudo apt update ä¹‹åå®‰è£…ç¼–è¯‘æ‰€éœ€çš„åŸºæœ¬å·¥å…·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt-get -y install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch python3 python2.7 unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs git-core gcc-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler g++-multilib antlr3 gperf wget curl swig rsync<br></code></pre></td></tr></table></figure><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Openwrt01.png" /></p><p>æ¥ç€ä½¿ç”¨ git clone https://github.com/coolsnowwolf/lede.git æŠŠæºç clone åˆ°æœ¬åœ°ï¼Œç„¶å cd lede è¿›å…¥ç›®å½•ã€‚</p><p>é»˜è®¤çš„å›ºä»¶æºç ç›¸å¯¹æ¥è¯´è¿‡äºå¹²å‡€ï¼Œæ²¡æœ‰ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿ã€‚å¦‚æœæƒ³é¢„ç¼–è¯‘å…¶ä»–çš„æ’ä»¶ï¼Œå¦‚Passwall SSRplus ç­‰ç­‰ï¼Œå°±éœ€è¦ç¬¬ä¸‰æ–¹ packagesã€‚æ¨èä½¿ç”¨ github@kenzok8æ•´ç†çš„ <ahref="https://github.com/kenzok8/openwrt-packages">openwrt-packages</a>ï¼Œå·²ç»åŒ…æ‹¬äº†ä»¥ä¸‹æ’ä»¶å’Œä¸»é¢˜ï¼š</p><ul><li>luci-app-vssr ------------------vssrè€ç«­åŠ› å³ helloworld</li><li>luci-app-dnsfilter ------------------åŸºäºDNSçš„å¹¿å‘Šè¿‡æ»¤</li><li>luci-app-openclash ------------------openclashå›¾å½¢<br /></li><li>luci-app-advancedsetting ------------------ç³»ç»Ÿé«˜çº§è®¾ç½®</li><li>luci-app-serverchan ------------------Serveré…± å¾®ä¿¡/Telegramæ¨é€çš„æ’ä»¶</li><li>luci-theme-ifit------------------é€æ˜ä¸»é¢˜ï¼ˆé€‚é…18.06ä¿®å¤ä¸»æœºåé”™è¯¯ï¼‰</li><li>luci-theme-atmaterial ------------------atmaterialä¸‰åˆä¸€ä¸»é¢˜ï¼ˆé€‚é…18.06ï¼‰<br /></li><li>luci-app-aliddns ------------------é˜¿é‡Œäº‘ddns</li><li>luci-app-eqos ------------------ä¾IPåœ°å€é™é€Ÿ</li><li>luci-app-gost ------------------éšè”½çš„httpsä»£ç†</li><li>luci-app-adguardhome ------------------å»å¹¿å‘Š</li><li>luci-app-smartdns ------------------smartdnsé˜²æ±¡æŸ“</li><li>luci-app-passwall ------------------Lienolå¤§ç¥</li><li>luci-theme-argon_new ------------------äºŒåˆè“ ç´«ä¸»é¢˜</li><li>luci-app-ssr-plus ------------------Leanå¤§ç¥</li><li>luci-theme-opentomcat------------------ä¿®å¤ä¸»æœºåé”™è¯¯ï¼ˆé€‚é…18.06ï¼‰<br /></li><li>luci-theme-opentomato------------------ä¿®å¤ä¸»æœºåé”™è¯¯ï¼ˆé€‚é…18.06ï¼‰</li></ul><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Openwrt03.png" /></p><p>å¦‚ä¸Šå›¾ï¼Œç¼–è¾‘ lede/feeds.conf.default æ–‡ä»¶ï¼Œæ·»åŠ ä¸¤è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">src-git kenzo https://github.com/kenzok8/openwrt-packages<br>src-git small https://github.com/kenzok8/small   // è¿™æ˜¯ Passwall æ’ä»¶æ‰€éœ€çš„ä¾èµ–ï¼Œä¹Ÿå¯ä½¿ç”¨ Lienol passwall æ›¿ä»£<br></code></pre></td></tr></table></figure><p>ä¿å­˜å…³é—­åæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">./scripts/feeds update -a<br>./scripts/feeds install -a<br>make menuconfig<br></code></pre></td></tr></table></figure><p>æ³¨æ„åœ¨ç¬¬äºŒæ­¥æ‰§è¡Œ install å‘½ä»¤æ—¶å¯èƒ½ä¼šå‡ºç°ä¸€å¤§å †æœ‰ â€˜has a dependencyon xxx, which does not existâ€™ ä¾èµ–ç¼ºå¤±çš„æŠ¥é”™ï¼Œå†è¾“ä¸€æ¬¡å‘½ä»¤ç¡®ä¿æ— è¯¯å†è¿›è¡Œconfig é…ç½®ã€‚ï¼ˆ'use -f to .....'å¯ä»¥å¿½ç•¥ï¼Œè¿™æ˜¯ç”±äº kenzo8 æä¾›çš„packages å’Œ core é‡Œçš„åŒ…å‡ºç°é‡å¤ï¼Œ-f å‚æ•°ä¼šè¦†ç›–åŸæœ‰çš„ packagesï¼‰</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Openwrt04.png" /></p><p>è¾“å…¥ make menuconfig åæˆ‘ä»¬ä¼šçœ‹åˆ°è¿™æ ·ä¸€ä¸ªå›¾å½¢ç•Œé¢ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Openwrt05.png" /></p><p>Target System é€‰æ‹©èŠ¯ç‰‡ OEMï¼ŒSubtarget æ˜¯å…·ä½“å‹å·ï¼ŒTarget Profileæœºå‹ã€‚åœ¨ç»ˆç«¯åº•éƒ¨æœ‰ä¸€ä¸ª Luci é€‰é¡¹å¡ï¼ŒLuciæ‰€å¸¦æ¥çš„é«˜å¯å®šåˆ¶æ€§å°±æ˜¯è‡ªå·±ç¼–è¯‘å›ºä»¶çš„ä¹è¶£æ‰€åœ¨ã€‚</p><p>LuCi &gt; Themes å¯é€‰æ‹©ä¸»é¢˜ argon ç³»åˆ—çš„éƒ½æ¯”è¾ƒç¾è§‚ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Openwrt06.png" /></p><p>LuCi &gt; Applications é‡Œå‹¾é€‰æ‰€éœ€è¦çš„æ’ä»¶ï¼Œå…·ä½“åº”ç”¨æ‘˜è‡ªæ©å±±è®ºå›ï¼š</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-accesscontrol#è®¿é—®æ—¶é—´æ§åˆ¶</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-adbyby-plus #å¹¿å‘Šå±è”½å¤§å¸ˆPlus+</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-arpbind #IP/MACç»‘å®š</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-autoreboot #æ”¯æŒè®¡åˆ’é‡å¯</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ddns #åŠ¨æ€åŸŸåDNSï¼ˆé›†æˆé˜¿é‡ŒDDNSå®¢æˆ·ç«¯ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-filetransfer#æ–‡ä»¶ä¼ è¾“ï¼ˆå¯webå®‰è£…ipkåŒ…ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-firewall #æ·»åŠ é˜²ç«å¢™</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-flowoffload #TurboACCç½‘ç»œåŠ é€Ÿï¼ˆé›†æˆFLOW,BBR,NAT,DNSâ€¦</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-frpc #å†…ç½‘ç©¿é€ Frp</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-guest-wifi #WiFiè®¿å®¢ç½‘ç»œ</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ipsec-virtual<strong>d#virtual</strong>æœåŠ¡å™¨ IPSec</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-mwan3 #MWAN3è´Ÿè½½å‡è¡¡</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-mwan3helper #MWAN3åˆ†æµåŠ©æ‰‹</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-nlbwmon #ç½‘ç»œå¸¦å®½ç›‘è§†å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ramfree #é‡Šæ”¾å†…å­˜</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-samba #ç½‘ç»œå…±äº«ï¼ˆSambaï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-sqm#æµé‡æ™ºèƒ½é˜Ÿåˆ—ç®¡ç†ï¼ˆQOSï¼‰</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ä¹³é…¸èŒé¥®æ–™-plus#ä¹³é…¸èŒé¥®æ–™ä½è°ƒä¸Šç½‘Plus+</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include s-s New Versiong #æ–°SSä»£ç†</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include s-s Simple-obfs Plugin#simple-obfsç®€å•æ··æ·†å·¥å…· *</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include s-s vè´°ç‘ Plugin #SS vè´°ç‘æ’ä»¶*</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include vè´°ç‘ #vè´°ç‘ä»£ç†</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include Trojan #Trojanä»£ç†</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include redâ€”socks2 #redâ€”socks2ä»£ç†*</p><pre><code class="hljs">luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include Kcptun  #KcptunåŠ é€Ÿ</code></pre><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include è¿ç¦è½¯ä»¶ Server#ä¹³é…¸èŒé¥®æ–™æœåŠ¡å™¨</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-syncdial#å¤šæ‹¨è™šæ‹Ÿç½‘å¡ï¼ˆåŸmacvlanï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-unblockmusic#è§£é”ç½‘æ˜“äº‘ç°è‰²æ­Œæ›²3åˆ1æ–°ç‰ˆæœ¬</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-upnp#é€šç”¨å³æ’å³ç”¨UPnPï¼ˆç«¯å£è‡ªåŠ¨è½¬å‘ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-vlmcsd #KMSæœåŠ¡å™¨è®¾ç½®</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-vsftpd #FTPæœåŠ¡å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-wifischedule #WiFi è®¡åˆ’</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-wireleè¿ç¦è½¯ä»¶egdb#WiFiæ— çº¿</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-wol #WOLç½‘ç»œå”¤é†’</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-wrtbwmon #å®æ—¶æµé‡ç›‘æµ‹</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-xlnetacc #è¿…é›·å¿«é¸Ÿ</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-zerotier #ZeroTierå†…ç½‘ç©¿é€</p><p>Extra packages â€”&gt; ipv6helper #æ”¯æŒ ipv6</p><p>Utilities â€”&gt; open-vm-tools #æ‰“å¼€é€‚ç”¨äºVMwareçš„VM Tools</p><p>ä»¥ä¸‹æ˜¯å…¨éƒ¨ï¼š æ³¨ï¼šåº”ç”¨åé¢æ ‡è®° â€œ * â€ ä¸ºæœ€è¿‘æ–°æ·»åŠ </p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-accesscontrol#è®¿é—®æ—¶é—´æ§åˆ¶</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-acme#ACMEè‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†ç¯å¢ƒ</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-adblock #ADBå¹¿å‘Šè¿‡æ»¤</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-adbyby-plus #å¹¿å‘Šå±è”½å¤§å¸ˆPlus+</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-adbyby#å¹¿å‘Šè¿‡æ»¤å¤§å¸ˆï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-adkill #å¹¿å‘Šè¿‡æ»¤ï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-advanced-reboot#Linksysé«˜çº§é‡å¯</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ahcp #æ”¯æŒAHCPd</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-aliddns#é˜¿é‡ŒDDNSå®¢æˆ·ç«¯ï¼ˆå·²å¼ƒï¼Œé›†æˆè‡³ddnsï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-amule #aMuleä¸‹è½½å·¥å…·</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-aria2 # Aria2ä¸‹è½½å·¥å…·</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-arpbind #IP/MACç»‘å®š</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-asterisk#æ”¯æŒAsteriskç”µè¯æœåŠ¡å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-attendedsysupgrade#å›ºä»¶æ›´æ–°å‡çº§ç›¸å…³</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-autoreboot #æ”¯æŒè®¡åˆ’é‡å¯</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-baidupcs-web #ç™¾åº¦ç½‘ç›˜ç®¡ç†</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-bcp38#BCP38ç½‘ç»œå…¥å£è¿‡æ»¤ï¼ˆä¸ç¡®å®šï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-bird1-ipv4#å¯¹Bird1-ipv4çš„æ”¯æŒ</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-bird1-ipv6#å¯¹Bird1-ipv6çš„æ”¯æŒ</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-bird4 #Bird4ï¼ˆæœªçŸ¥ï¼‰ï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-bird6 #Bird6ï¼ˆæœªçŸ¥ï¼‰ï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-bmx6 #BMX6è·¯ç”±åè®®</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-bmx7 #BMX7è·¯ç”±åè®®</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-caldav #è”ç³»äººï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-cifsd #ç½‘ç»œå…±äº«CIFS/SMBæœåŠ¡å™¨*</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-cjdns #åŠ å¯†IPV6ç½‘ç»œç›¸å…³</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-clamav #ClamAVæ€æ¯’è½¯ä»¶</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-commands #Shellå‘½ä»¤æ¨¡å—</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-cshark #CloudSharkæ•è·å·¥å…·</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ddns #åŠ¨æ€åŸŸåDNSï¼ˆé›†æˆé˜¿é‡ŒDDNSå®¢æˆ·ç«¯ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-diag-core #coreè¯Šæ–­å·¥å…·</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-dnscrypt-proxy#DNSCryptè§£å†³DNSæ±¡æŸ“</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-dnsforwarder#DNSForwarderé˜²DNSæ±¡æŸ“</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-dnspod#DNSPodåŠ¨æ€åŸŸåè§£æï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-dockerman #Dockerå®¹å™¨ *</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-dump1090#æ°‘èˆªæ— çº¿é¢‘ç‡ï¼ˆä¸ç¡®å®šï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-dynapoint#DynaPointï¼ˆæœªçŸ¥ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-e2guardian #Webå†…å®¹è¿‡æ»¤å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-familycloud #å®¶åº­äº‘ç›˜</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-filetransfer#æ–‡ä»¶ä¼ è¾“ï¼ˆå¯webå®‰è£…ipkåŒ…ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-firewall #æ·»åŠ é˜²ç«å¢™</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-flowoffload #TurboACCç½‘ç»œåŠ é€Ÿï¼ˆé›†æˆFLOW,BBR,NAT,DNSâ€¦</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-freifunk-diagnostics#freifunkç»„ä»¶ è¯Šæ–­ï¼ˆæœªçŸ¥ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-freifunk-policyrouting#freifunkç»„ä»¶ ç­–ç•¥è·¯ç”±ï¼ˆæœªçŸ¥ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-freifunk-widgets #freifunkç»„ä»¶ç´¢å¼•ï¼ˆæœªçŸ¥ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-frpc #å†…ç½‘ç©¿é€ Frp</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-fwknopd #Firewall KnockOperatoræœåŠ¡å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-guest-wifi #WiFiè®¿å®¢ç½‘ç»œ</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-gfwlist#GFWåŸŸååˆ—è¡¨ï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-haproxy-tcp#HAProxyè´Ÿè½½å‡è¡¡-TCP</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-hd-idle #ç¡¬ç›˜ä¼‘çœ </p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-hnet #HomenetStatuså®¶åº­ç½‘ç»œæ§åˆ¶åè®®</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ipsec-virtual<strong>d#virtual</strong>æœåŠ¡å™¨ IPSec</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-kodexplorer#KODå¯é“äº‘ç§äººç½‘ç›˜</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-kooldns #virtual**æœåŠ¡å™¨ddnsæ›¿ä»£æ–¹æ¡ˆï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-koolproxy#KPå»å¹¿å‘Šï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-lxc #LXCå®¹å™¨ç®¡ç†</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-meshwizard #ç½‘ç»œè®¾ç½®å‘å¯¼</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-minidlna #å®Œå…¨å…¼å®¹DLNA /UPnP-AVå®¢æˆ·ç«¯çš„æœåŠ¡å™¨è½¯ä»¶</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-mjpg-streamer#å…¼å®¹Linux-UVCçš„æ‘„åƒå¤´ç¨‹åº</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-mtwifi #MTWiFié©±åŠ¨çš„æ”¯æŒ</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-mmc-over-gpio#æ·»åŠ SDå¡æ“ä½œç•Œé¢ï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-multiwan#å¤šæ‹¨è™šæ‹Ÿç½‘å¡ï¼ˆå·²å¼ƒï¼Œç§»è‡³syncdialï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-mwan #MWANè´Ÿè½½å‡è¡¡ï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-mwan3 #MWAN3è´Ÿè½½å‡è¡¡</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-mwan3helper #MWAN3åˆ†æµåŠ©æ‰‹</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-n2n_v2 #N2Nå†…ç½‘ç©¿é€ N2N v2virtual**æœåŠ¡</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-netdata#Netdataå®æ—¶ç›‘æ§ï¼ˆå›¾è¡¨ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-nft-qos #QOSæµæ§Nftablesç‰ˆ</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ngrokc #Ngrokå†…ç½‘ç©¿é€ï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-nlbwmon #ç½‘ç»œå¸¦å®½ç›‘è§†å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-noddos #NodDOS Clientsé˜»æ­¢DDoSæ”»å‡»</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-nps #å†…ç½‘ç©¿é€nps *</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ntpc #NTPæ—¶é—´åŒæ­¥æœåŠ¡å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ocserv #OpenConnectvirtual**æœåŠ¡</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-olsr #OLSRé…ç½®å’ŒçŠ¶æ€æ¨¡å—</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-olsr-services #OLSRæœåŠ¡å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-olsr-viz #OLSRå¯è§†åŒ–</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-openvirtual**#Openvirtual**å®¢æˆ·ç«¯</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-openvirtual<strong>-server#æ˜“äºä½¿ç”¨çš„Openvirtual</strong>æœåŠ¡å™¨ Web-UI</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-oscam #OSCAMæœåŠ¡å™¨ï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-p910nd #æ‰“å°æœåŠ¡å™¨æ¨¡å—</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-pagekitec#Pagekiteå†…ç½‘ç©¿é€å®¢æˆ·ç«¯</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-polipo#Polipoä»£ç†(æ˜¯ä¸€ä¸ªå°å‹ä¸”å¿«é€Ÿçš„ç½‘é¡µç¼“å­˜ä»£ç†)</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-pppoe-relay #PPPoE NATç©¿é€ç‚¹å¯¹ç‚¹åè®®ï¼ˆPPPï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-p p t p-server#virtual**æœåŠ¡å™¨ p p t pï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-privoxy#Privoxyç½‘ç»œä»£ç†(å¸¦è¿‡æ»¤æ— ç¼“å­˜)</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-qbittorrent#BTä¸‹è½½å·¥å…·ï¼ˆqBittorrentï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-qos #æµé‡æœåŠ¡è´¨é‡(QoS)æµæ§</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-radicale#CalDAV/CardDAVåŒæ­¥å·¥å…·</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ramfree #é‡Šæ”¾å†…å­˜</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-rp-pppoe-server #RoaringPenguin PPPoE Server æœåŠ¡å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-samba #ç½‘ç»œå…±äº«ï¼ˆSambaï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-samba4 #ç½‘ç»œå…±äº«ï¼ˆSamba4ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-sfe #TurboACCç½‘ç»œåŠ é€Ÿï¼ˆflowoffloadäºŒé€‰ä¸€ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-s-s #SSä½è°ƒä¸Šç½‘ï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-s-s-libes #SS-libevæœåŠ¡ç«¯</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-shairplay #æ”¯æŒAirPlayåŠŸèƒ½</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-siitwizard #SIITé…ç½®å‘å¯¼SIIT-Wizzard</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-simple-adblock#ç®€å•çš„å¹¿å‘Šæ‹¦æˆª</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-smartdns#SmartDNSæœ¬åœ°æœåŠ¡å™¨ï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-softethervirtual** #SoftEthervirtual**æœåŠ¡å™¨ NATç©¿é€ *</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-splash#Client-Splashæ˜¯æ— çº¿MESHç½‘ç»œçš„ä¸€ä¸ªçƒ­ç‚¹è®¤è¯ç³»ç»Ÿ</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-sqm#æµé‡æ™ºèƒ½é˜Ÿåˆ—ç®¡ç†ï¼ˆQOSï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-squid #Squidä»£ç†æœåŠ¡å™¨</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ä¹³é…¸èŒé¥®æ–™-plus#ä¹³é…¸èŒé¥®æ–™ä½è°ƒä¸Šç½‘Plus+</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include s-s New Version #æ–°SSä»£ç†</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include s-s Simple-obfs Plugin#simple-obfsç®€å•æ··æ·†å·¥å…· *</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include s-s vè´°ç‘ Plugin #SS vè´°ç‘æ’ä»¶*</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include vè´°ç‘ #vè´°ç‘ä»£ç†</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include Trojan #Trojanä»£ç†</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include redâ€”socks2 #redâ€”socks2ä»£ç†*</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include Kcptun #KcptunåŠ é€Ÿ</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include è¿ç¦è½¯ä»¶ Server#ä¹³é…¸èŒé¥®æ–™æœåŠ¡å™¨</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include DNS2SOCKS#DNSæœåŠ¡å™¨ï¼ˆå·²å¼ƒï¼‰</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include è¿ç¦è½¯ä»¶ Socks andTunnelï¼ˆå·²å¼ƒï¼‰</p><p>luci-app-ä¹³é…¸èŒé¥®æ–™-plus â€”&gt; Include Socks Server#socksä»£ç†æœåŠ¡å™¨ï¼ˆå·²å¼ƒï¼‰</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ä¹³é…¸èŒé¥®æ–™-pro#ä¹³é…¸èŒé¥®æ–™-Proï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ä¹³é…¸èŒé¥®æ–™server-python#è¿ç¦è½¯ä»¶ PythonæœåŠ¡å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-statistics #æµé‡ç›‘æ§å·¥å…·</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-syncdial#å¤šæ‹¨è™šæ‹Ÿç½‘å¡ï¼ˆåŸmacvlanï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-tinyproxy #Tinyproxyæ˜¯HTTP(S)ä»£ç†æœåŠ¡å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-transmission #BTä¸‹è½½å·¥å…·</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-travelmate #æ—…è¡Œè·¯ç”±å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-ttyd #ç½‘é¡µç»ˆç«¯å‘½ä»¤è¡Œ</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-udpxy #udpxyåšç»„æ’­æœåŠ¡å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-uhttpd #uHTTPd WebæœåŠ¡å™¨</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-unblockmusic#è§£é”ç½‘æ˜“äº‘ç°è‰²æ­Œæ›²3åˆ1æ–°ç‰ˆæœ¬</p><p>UnblockNeteaseMusic Golang Version #Golangç‰ˆæœ¬ *</p><p>UnblockNeteaseMusic NodeJS Version #NodeJSç‰ˆæœ¬ *</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-unblockneteasemusic-go#è§£é™¤ç½‘æ˜“äº‘éŸ³ä¹ï¼ˆåˆå¹¶ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-unblockneteasemusic-mini#è§£é™¤ç½‘æ˜“äº‘éŸ³ä¹ï¼ˆåˆå¹¶ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-unbound #Unbound DNSè§£æå™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-upnp#é€šç”¨å³æ’å³ç”¨UPnPï¼ˆç«¯å£è‡ªåŠ¨è½¬å‘ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-usb-printer #USBæ‰“å°æœåŠ¡å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-vè´°ç‘-server #vè´°ç‘ æœåŠ¡å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-vè´°ç‘-pro#vè´°ç‘é€æ˜ä»£ç†ï¼ˆå·²å¼ƒï¼Œé›†æˆä¹³é…¸èŒé¥®æ–™ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-verysync #å¾®åŠ›åŒæ­¥ *</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-vlmcsd #KMSæœåŠ¡å™¨è®¾ç½®</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-vnstat#vnStatç½‘ç»œç›‘æ§ï¼ˆå›¾è¡¨ï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-virtual<strong>bypass#virtual</strong> BypassWebUI ç»•è¿‡virtual**è®¾ç½®</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-vsftpd #FTPæœåŠ¡å™¨</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-watchcat#æ–­ç½‘æ£€æµ‹åŠŸèƒ½ä¸å®šæ—¶é‡å¯</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-webadmin #Webç®¡ç†é¡µé¢è®¾ç½®</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-webshell#ç½‘é¡µå‘½ä»¤è¡Œç»ˆç«¯ï¼ˆå·²å¼ƒï¼‰</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-wifischedule #WiFi è®¡åˆ’</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-wireguard #virtual**æœåŠ¡å™¨WireGuardçŠ¶æ€</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-wireleè¿ç¦è½¯ä»¶egdb#WiFiæ— çº¿</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-wol #WOLç½‘ç»œå”¤é†’</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-wrtbwmon #å®æ—¶æµé‡ç›‘æµ‹</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-xlnetacc #è¿…é›·å¿«é¸Ÿ</p><p>LuCI â€”&gt; Applications â€”&gt; luci-app-zerotier #ZeroTierå†…ç½‘ç©¿é€</p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p><p>éœ€è¦æ³¨æ„çš„æ˜¯é…ç½®ç§‘å­¦ä¸Šç½‘å·¥å…·æ—¶ï¼ŒXRay æ˜¯å‘ä¸‹å…¼å®¹ V2rayçš„ã€‚å¹¶ä¸”ç»è¿‡æˆ‘çš„æµ‹è¯•ï¼Œå‹¾é€‰äº† V2Ray å¯èƒ½ä¼šå¯¼è‡´ XRay ç¼–è¯‘æ—¶å‡ºç°é”™è¯¯ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Openwrt07.png" /></p><p>åŒå‡»ä¸¤ä¸‹ Esc é€€å›ä¸Šä¸€çº§ï¼Œå¹¶é€‰æ‹© Yesä¿å­˜æ–‡ä»¶ã€‚ä¸‹è½½ç¼–è¯‘æ‰€éœ€çš„ç¬¬ä¸‰æ–¹åº“ï¼ˆæ¯æ¬¡æ›´æ”¹é…ç½®æ–‡ä»¶æ—¶éƒ½éœ€æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">make -j8 download V=s<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåƒä¸‡ä¸è¦åªæ‰§è¡Œä¸€éå°±ç›´æ¥ç¼–è¯‘äº†ï¼Œå¿…ä¼šæŠ¥é”™ï¼ï¼ç”±äºç„å­¦é—®é¢˜ç¬¬ä¸€æ¬¡ä¸‹è½½å“ªæ€•ç”¨çš„æ˜¯æµ·å¤–VPS éƒ½ä¼šå‡ºç° 404 Downloadfailedï¼Œæ‰€ä»¥è‡³å°‘é‡å¤ä¸¤è‡³ä¸‰éã€‚æ–¹ä¾¿æ’é”™å¯ä»¥ç›´æ¥æœç´¢ 'failed'å…³é”®å­—è¿›è¡Œè¿‡æ»¤ï¼Œsha256 ç­¾åéªŒè¯å¤±è´¥çš„æ–‡ä»¶å¯ä»¥å¿½ç•¥ï¼Œåªè¦åœ¨ lede/dlç›®å½•èƒ½æ‰¾åˆ°å¯¹åº”æŠ¥é”™çš„æ–‡ä»¶å°±å¯ä»¥äº†ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Openwrt08.png" /></p><p>æœ€åå¼€å§‹ç¼–è¯‘ï¼Œæœ¬æœºå¤§çº¦ç­‰å¾…äº† 6hï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">make -j1 V=s<br></code></pre></td></tr></table></figure><p>æˆ‘åœ¨ç¼–è¯‘åˆ°æœ€åä¸€æ­¥æ‰“åŒ…æ—¶ï¼Œå‡ºç°äº† 'error:ext4_allocate_best_fit_partial: failed to allocate xxxx blocks, out ofspace?' errorï¼ŒåŸå› å¾ˆç®€å•ï¼šé»˜è®¤çš„ç£ç›˜å¤§å°ä¸å¤Ÿã€‚åªéœ€é‡æ–° makemenuconfigï¼Œæ‰¾åˆ° Target Images &gt; Root filesystem partition size(inMB)ï¼Œæ ¹æ®æ‰€ç¼–è¯‘çš„æ’ä»¶æ•°é‡é…Œæƒ…æ‰©å®¹ã€‚</p><p>Billy Shao,</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>WhateverGreenæ ¸æ˜¾é©±åŠ¨è¯¦è§£</title>
    <link href="/2021/05/15/WhateverGreen/"/>
    <url>/2021/05/15/WhateverGreen/</url>
    
    <content type="html"><![CDATA[<p>å‚è€ƒæ–‡æ¡£ï¼š - <ahref="http://bbs.pcbeta.com/forum.php?mod=viewthread&amp;tid=1849093">è¿œæ™¯Â·è‹±ç‰¹å°”å…¨ç³»æ ¸æ˜¾æ˜¾å¡é©±åŠ¨æ•™ç¨‹</a>- <ahref="https://github.com/acidanthera/WhateverGreen/blob/master/Manual/FAQ.IntelHD.en.md">WhateverGreenæ–‡æ¡£Â·IntelÂ®HD Graphics FAQs</a> - <ahref="https://dortania.github.io/OpenCore-Post-Install/gpu-patching/intel-patching/#getting-started">Dortania'sIntel iGPU Patching</a></p><p>æ—©æœŸé»‘è‹¹æœé€šå¸¸ç›´æ¥ä½¿ç”¨ Cloverè¡¥ä¸æ³¨å…¥æ˜¾å¡ï¼Œç„¶è€Œè¿™ç§æ–¹æ³•ä»10.14ç‰ˆæœ¬ä»¥æ¥ä¾¿ä¸å†å—åˆ°æ”¯æŒï¼Œç¨³å®šä¸”é•¿æœŸæ”¯æŒçš„æ–¹æ¡ˆè¿˜æ˜¯è¦é€‰æ‹©WhateverGreenã€‚ä½œä¸ºé«˜é›†æˆåº¦çš„æ˜¾å¡é©±åŠ¨ï¼Œç›®å‰é›†æˆäº†WhateverGreenï¼ŒIntelGraphicsFixupï¼ŒNvidiaGraphicsFixupï¼ŒShiki å’ŒCoreDisplayFixupï¼Œæ”¯æŒ AMD/ATI/Intel/Nvidia ï¼ˆNå¡éœ€è¦ä½¿ç”¨WebDriverï¼Œä¸”æœ€é«˜æ”¯æŒåˆ°10.13.6ï¼›å¼€æ™®å‹’æ¶æ„å¤§éƒ¨åˆ†å…é©±ï¼‰ã€‚æœ¬ç¯‡æ–‡ç« ä¸»è¦è®¨è®ºæ ¸æ˜¾é©±åŠ¨ï¼Œå†…å®¹å¯èƒ½ä¼šæœ‰ä¸€ç‚¹å†—é•¿ï¼Œç¡®ä¿ä½ æœ‰è¶³å¤Ÿçš„è€å¿ƒè¿›è¡Œé˜…è¯»ã€‚ï¸¿(ï¿£ï¸¶ï¿£)ï¸¿</p><p>macOS å¯¹ HD 2000ï¼ˆSandy Bridge æ¶æ„ç®€ç§°SNBï¼‰ç³»åˆ—åŠä»¥ä¸Šçš„æ ¸æ˜¾æä¾›ç›¸å¯¹å®Œæ•´çš„æ”¯æŒã€‚å¦‚æœç‹¬æ˜¾èƒ½å¤Ÿæ­£å¸¸é©±åŠ¨ï¼Œå¿…é¡»é…åˆæ ¸æ˜¾é©±åŠ¨ä»¥åŠåˆé€‚çš„ç¼“å†²å¸§ï¼ˆFramebufferç®€ç§°FBï¼‰ï¼Œæ‰èƒ½å®ç°ç¡¬ä»¶åŠ é€Ÿï¼Œè¿™ä¹Ÿæˆä¸ºäº†ä¸€å°â€å®Œç¾â€œçš„é»‘è‹¹æœç”µè„‘çš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€ã€‚</p><h2 id="å¼€å§‹å‰è¦åšçš„...">å¼€å§‹å‰è¦åšçš„...</h2><p>æ­£ç¡®å¯ç”¨æ ¸æ˜¾æ­¥éª¤ï¼š</p><p>1.ä¿®æ­£è®¾å¤‡çš„ ACPI åç§°ï¼ˆæ ¸æ˜¾æ˜¯ IGPUï¼Œè‹±ç‰¹å°”ç®¡ç†å¼•æ“æ˜¯IMEIï¼‰ã€‚äº‹å®ä¸Šï¼Œè¿™ä¸€æ­¥ WhateverGreen ä¼šè‡ªåŠ¨å®Œæˆï¼Œå¿…è¦çš„æ—¶å€™è¿˜éœ€è¦åœ¨ ACPI-&gt; Patch ä¸­æ‰‹åŠ¨æ‰“æ›¿æ¢è¡¥ä¸å¦‚ Rename GPU0 to IGPUï¼ŒRename PEGP toIGPUã€‚</p><p>2.ä»¿å†’è®¾å¤‡ä¸ºåˆé€‚çš„å‹å·ã€‚</p><p>3.å†™å…¥æ­£ç¡®çš„ FBï¼Œå³ AAPL,ig-platform-idï¼ˆé€‚ç”¨äº Ivy Bridge æˆ–æ›´æ–°ï¼‰æˆ–AAPL,snb-platform-id ï¼ˆä»…é€‚ç”¨äº Sandy Bridgeï¼‰ï¼Œæ˜¯æœ€ä¸ºå…³é”®çš„æ­¥éª¤ã€‚</p><p>4.ä¸æ ¸æ˜¾ç›¸å…³è®¾å¤‡ä¼šç”± WhateverGreen å’Œ AppleALCè‡ªåŠ¨æ·»åŠ é¢å¤–çš„å±æ€§ã€‚</p><p>BIOS è®¾ç½®å»ºè®®ï¼ˆå›¾ç‰‡æ¥è‡ª<ahref="https://github.com/acidanthera/WhateverGreen/blob/master/Manual/FAQ.IntelHD.en.md">WhateverGreenæ–‡æ¡£Â·IntelÂ®HD Graphics FAQs</a>ï¼‰ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/WhateverGreenbios.png" /></p><p>å°† DVMT å†…å­˜é‡è®¾ç½®ä¸ºMAXï¼›å¦‚æœBIOSä¸­æ²¡æœ‰è¯¥é€‰é¡¹ï¼ˆå¤§å¤šæ•°ç¬”è®°æœ¬ä¸æ”¯æŒï¼‰ï¼Œä¹‹åä¼šè®²å¦‚ä½•ä½¿ç”¨framebuffer-stolenmem ç»™ BIOS ä¸­ DVMT æ·»åŠ å†…å­˜å¤§å°ã€‚</p><p>å¼€å§‹ä¹‹å‰éœ€è¦åšä¸€ä¸‹å¼•å¯¼çš„æ¸…ç†å·¥ä½œï¼Œç§»é™¤ä¸‹åˆ—é©±åŠ¨ï¼š</p><ul><li>IntelGraphicsFixup</li><li>NvidiaGraphicsFixup</li><li>CoreDisplayFixup</li><li>Shiki</li><li>IntelGraphicsDVMTFixup</li><li>AzulPatcher4600</li><li>AppleBacklightFixup</li><li>FakePCIID_Intel_HD_Graphics</li><li>FakePCIID_Intel_HDMI_Audio</li><li>FakePCIID.kextï¼ˆä¸ä½¿ç”¨å…¶ä»–ä¾èµ–äº FakePCIID çš„æ’ä»¶æ—¶ï¼‰</li></ul><p>ä»¥ä¸‹é’ˆå¯¹ Clover ç”¨æˆ·ï¼š</p><p>å…³é—­æ‰€æœ‰æ˜¾å¡æ³¨å…¥å‚æ•° Graphics-Inject-ATI/Intel/NVidia Devices-Injectå…¨éƒ¨è®¾ç½®ä¸º falseã€‚å¹¶ç‚¹æ‰ä»¥ä¸‹ Clover çš„ DSDT è¡¥ä¸ï¼š</p><ul><li>AddHDMI</li><li>FixDisplay</li><li>FixIntelGfx</li><li>AddIMEI</li><li>FixHDA</li><li>AddPNLF</li></ul><p>åŒæ—¶å…³é—­ UseIntelHDMIï¼ŒSetIntelBacklight å’ŒSetIntelMaxBacklightã€‚åˆ é™¤ -disablegfxfirmware å’Œ -igfxnohdmiå¯åŠ¨å‚æ•°ã€‚åˆ é™¤æˆ–æ³¨é‡Š IntelGFXï¼ŒIMEI çš„ FakeID å’Œig-platform-idã€‚æ¸…é™¤ä»¥ä¸‹ä½ç½®æ‰€æœ‰å’Œ IGPUï¼ŒHDMI ç›¸å…³çš„æ¡ç›®ï¼š</p><ul><li>config.plist â–¸ Devices â–¸ Arbitrary</li><li>config.plist â–¸ Devices â–¸ Properties</li><li>config.plist â–¸ Devices â–¸ AddProperties</li></ul><p>æœ€åä¸€æ­¥ï¼Œæ¸…é™¤ DSDT Patchesï¼šGFX0 to IGPU, PEGP to GFX0, HECI toIMEI, MEI to IMEI, HDAS to HDEF, B0D3 to HDAUã€‚</p><h2 id="æ¡ˆä¾‹i5-10210u">æ¡ˆä¾‹ï¼ši5-10210u</h2><h3 id="è·å–è®¾å¤‡è·¯å¾„">1.è·å–è®¾å¤‡è·¯å¾„</h3><p>ä»¥ i5-10210u çš„æ ¸æ˜¾ Intel UHD Graphcis ï¼ˆåº”è¯¥æ˜¯ UHD620çš„ä¸€å¼ é©¬ç”²å¡ï¼‰ä¸ºä¾‹å­ï¼Œé¦–å…ˆéœ€è¦æ‰¾åˆ°æ ¸æ˜¾çš„ Pci è®¾å¤‡è·¯å¾„ã€‚é€šå¸¸æ˜¯PciRoot(0x0)/Pci(0x2,0x0)ï¼Œä½†è¿˜æ˜¯éœ€è¦ä½¿ç”¨ gfx-util è¿›è¡Œç¡®è®¤ã€‚è½¯ä»¶å¯åœ¨acidanthera å›¢é˜Ÿç»´æŠ¤çš„ä»“åº“é‡Œä¸‹è½½ release ç‰ˆæœ¬ï¼Œé¡¹ç›®åœ°å€ï¼š<ahref="https://github.com/acidanthera/gfxutil">https://github.com/acidanthera/gfxutil</a>ã€‚ç»ˆç«¯è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt; ./gfxutil | grep IGPU<br>00:02.0 8086:3e9b /PCI0@0/IGPU@2 = PciRoot(0x0)/Pci(0x2,0x0)<br></code></pre></td></tr></table></figure><h3 id="æ³¨å…¥-framebuffer-ç¼“å†²å¸§">2.æ³¨å…¥ Framebuffer ç¼“å†²å¸§</h3><p>config -&gt; DeviceProperties -&gt; Add ä¸­æ·»åŠ ä¸€ä¸ª Dictionaryå‘½åä¸ºä½ çš„æ ¸æ˜¾è·¯å¾„ã€‚é¦–å…ˆæ·»åŠ  Frambufferï¼Œè¿™æ˜¯æ ¸æ˜¾é©±åŠ¨ä¸­æœ€æ ¸å¿ƒçš„æ­¥éª¤ã€‚Dicä¸‹æ·»åŠ  Data ç±»å‹çš„ AAPL,ig-platform-id æˆ– AAPL,snb-platform-id å­é¡¹æŒ‡å®šFB å€¼ï¼Œè¯·é¦–å…ˆä½¿ç”¨å¯¹åº”å‹å·å’Œæ¶æ„çš„ recommandedå€¼ï¼Œå¦‚æœæ— æ³•é©±åŠ¨å¯ä»¥ä¾æ¬¡å°è¯•å…¶ä»–çš„ã€‚</p><p>åœ¨æ¡ˆä¾‹ä¸‹æ–¹çš„å†…å®¹ä¸­ï¼Œæˆ‘æ”¾å‡ºäº†ä»æœ€åˆåˆ°10ä»£ CFL/CMLæ ¸æ˜¾çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¤§éƒ¨åˆ†å†…å®¹æ‘˜è‡ª<ahref="https://github.com/acidanthera/WhateverGreen/blob/master/Manual/FAQ.IntelHD.en.md">WhateverGreenæ–‡æ¡£Â·IntelÂ®HD Graphics FAQs</a>ï¼Œç”±äºæ˜¯10ä»£ Comet Lake æˆ‘è¿™é‡Œé€‰æ‹©ï¼š</p><p><strong>æ¨èçš„ Framebuffers</strong>:</p><ul><li>Desktop:<ul><li>0x3EA50000 (default)</li><li>0x3E9B0007 (recommended)</li></ul></li><li>Laptop:<ul><li>0x3EA50009 (default). &lt;=====</li></ul></li><li>Empty framebuffer (CFL):<ul><li>0x3E910003 (default)</li></ul></li><li>Empty framebuffer (CML):<ul><li>0x9BC80003 (default)</li></ul></li></ul><p>ç”±äº OC ç‰¹æ€§ï¼Œåå…­è¿›åˆ¶æ•° 0x3EA50009 éœ€è¦å»æ‰ 0x ä¸¤ä¸¤ä¸€ç»„å€’åºå¡«å…¥ig-platform-id å‚æ•°ï¼Œè¿™é‡Œæ˜¯ 0900A53Eã€‚æ‰€ä»¥å¡«è¿›å»çš„ä¿¡æ¯åº”æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">AAPL,ig-platform-idData0900A53E<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸æ˜ç™½å€’åºè¾“å…¥çš„å…·ä½“å«ä¹‰ï¼Œå¯ä»¥å‚é˜… <ahref="http://bbs.pcbeta.com/forum.php?mod=viewthread&amp;tid=1849093">è¿œæ™¯Â·è‹±ç‰¹å°”å…¨ç³»æ ¸æ˜¾æ˜¾å¡é©±åŠ¨æ•™ç¨‹</a>ï¼Œè¿™ä¸ªæ•™ç¨‹æœ‰è¯¦ç»†çš„å›¾æ–‡ä»‹ç»ã€‚</p><h3 id="device-id-ä»¿å†’æ ¸æ˜¾">3.device-id ä»¿å†’æ ¸æ˜¾</h3><p>device-idå‚æ•°çš„ä½œç”¨æ˜¯ä»¿å†’æ ¸æ˜¾å‹å·ï¼Œä½†ä»¿å†’å¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚å¦‚æœä½ çš„æ ¸æ˜¾ä½¿ç”¨äº†ç¼“å†²å¸§æŒ‡å®šå¹³å°åä¾ç„¶ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œå¯ä»¥å°è¯•ä»¿å†’ã€‚</p><p>æ¯ä¸€ä»£æ ¸æ˜¾çš„ FB åˆ—è¡¨ä¸‹éƒ½æœ‰ â€˜åŸç”Ÿæ”¯æŒçš„Dev IDâ€™ï¼Œè¿™äº›16è¿›åˆ¶çš„æ ¸æ˜¾IDå°±æ˜¯device-id éœ€è¦å¡«å…¥çš„æ•°å€¼ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘è¦é€‰æ‹© CFL çš„ 0x3E9B ä½œä¸ºä»¿å†’ IDï¼Œå€’åºè¾“å…¥åç”¨ 0 è¡¥é½è‡³ 8ä½ï¼Œåƒè¿™æ ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">device-idData9B3E0000<br></code></pre></td></tr></table></figure><h3 id="weg-è‡ªå®šä¹‰è¡¥ä¸åˆ—è¡¨">4.WEG è‡ªå®šä¹‰è¡¥ä¸åˆ—è¡¨</h3><p>Lilu æ ¸å¿ƒæ‹“å±• + WhateverGreen å¹¶ç§°ä¸ºWEGã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦æ‰‹åŠ¨å»å®šåˆ¶é¢å¤–çš„ Framebufferè¡¥ä¸ã€‚ä½†å¦‚æœå‡ºç°èŠ±å±ï¼ŒBIOS ä¸èƒ½è®¾ç½® DVMTç­‰æƒ…å†µè‡ªå®šä¹‰è¡¥ä¸å°±æ´¾ä¸Šç”¨åœºï¼Œå¸¸ç”¨çš„å¦‚ä¸‹ï¼š</p><ul><li><p>framebuffer-patch-enable (å¯ç”¨è¯­ä¹‰è¡¥ä¸çš„æ€»å¼€å…³)</p></li><li><p>framebuffer-framebufferid (è¦ä¿®æ”¹çš„FBï¼Œä¸€èˆ¬ä¿æŒé»˜è®¤å³å¯)</p></li><li><p>framebuffer-mobile</p></li><li><p>framebuffer-pipecount</p></li><li><p>framebuffer-portcount</p></li><li><p>framebuffer-memorycount</p></li><li><p>framebuffer-stolenmem(ç»™BIOSä¸­DVMTå¢åŠ å†…å­˜å¤§å°ï¼‰ï¼š</p></li><li><p>framebuffer-fbmem</p></li><li><p>framebuffer-unifiedmem(æ ¸æ˜¾æ˜¾å­˜å¤§å°ï¼Œè°ƒå¤§ä¸€ç‚¹å¯èƒ½èƒ½è§£å†³èŠ±å±ï¼‰</p></li><li><p>framebuffer-cursormem (Haswell ä¸“ç”¨è¡¥ä¸)</p></li><li><p>framebuffer-flags</p></li><li><p>framebuffer-camellia (é›†æˆæ˜¾ç¤ºæ§åˆ¶å™¨ï¼Œä»…ä¸ç™½è‹¹æœç›¸å…³)</p></li><li><p>framebuffer-conX-enable (å¯ç”¨ç«¯å£ä¸º X çš„ä¿®æ”¹)</p></li><li><p>framebuffer-conX-index</p></li><li><p>framebuffer-conX-busid</p></li><li><p>framebuffer-conX-pipe</p></li><li><p>framebuffer-conX-type</p></li><li><p>framebuffer-conX-flags</p></li><li><p>framebuffer-conX-alldata (å®Œå…¨æ›¿æ¢ç«¯å£ä¿¡æ¯)</p></li><li><p>framebuffer-conX-YYYYYYYY-alldata (åœ¨å½“å‰ FB ä¸ YYYYYYåŒ¹é…æ—¶å®Œå…¨æ›¿æ¢ç«¯å£ä¿¡æ¯)</p></li></ul><p>æ¥ä¸‹æ¥æ˜¯è¯¦ç»†çš„è¡¥ä¸è¿‡ç¨‹ï¼Œä¸»è¦ä¿®è¡¥3ä¸ªæ–¹é¢ï¼š</p><p>ï¼ˆ1ï¼‰æ˜¾å­˜ï¼ˆ2ï¼‰æ ¸æ˜¾æ¥å£ï¼ˆConnectorsï¼‰é…ç½®</p><p>ä¸€.ä¿®å¤æ˜¾å­˜é—®é¢˜</p><p>æ‰“å¼€ <ahref="https://github.com/acidanthera/WhateverGreen/blob/master/Manual/FAQ.IntelHD.en.md">WhateverGreenæ–‡æ¡£Â·IntelÂ®HD Graphics FAQs</a>ï¼Œå±•å¼€ Spoiler: CFL/CML connectorsï¼Œæˆ‘æ˜¯ç”¨Framebuffer æ˜¯ 0x3EA50009ï¼Œæœç´¢ 0900A53Eä¼šå‘ç°ä»¥ä¸‹ä¿¡æ¯ï¼Œå³é»˜è®¤é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">ID: 3EA50009, STOLEN: 57 MB, FBMEM: 0 bytes, VRAM: 1536 MB, Flags: 0x00830B0A<br>TOTAL STOLEN: 58 MB, TOTAL CURSOR: 1 MB (1572864 bytes), MAX STOLEN: 172 MB, MAX OVERALL: 173 MB (181940224 bytes)<br>Model name: Intel HD Graphics CFL CRB<br>Camellia: CamelliaV3 (3), Freq: 0 Hz, FreqMax: 0 Hz<br>Mobile: 1, PipeCount: 3, PortCount: 3, FBMemoryCount: 3<br>[0] busId: 0x00, pipe: 8, <span class="hljs-built_in">type</span>: 0x00000002, flags: 0x00000098 - ConnectorLVDS<br>[1] busId: 0x05, pipe: 9, <span class="hljs-built_in">type</span>: 0x00000400, flags: 0x000001C7 - ConnectorDP<br>[2] busId: 0x04, pipe: 10, <span class="hljs-built_in">type</span>: 0x00000400, flags: 0x000001C7 - ConnectorDP<br>00000800 02000000 98000000<br>01050900 00040000 C7010000<br>02040A00 00040000 C7010000<br></code></pre></td></tr></table></figure><p>åè¯è§£é‡Šï¼š</p><table><thead><tr class="header"><th style="text-align: left;">æ ‡è¯†ç¬¦</th><th style="text-align: left;">å€¼</th><th style="text-align: left;">æè¿°</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">STOLEN</td><td style="text-align: left;">57 MB</td><td style="text-align: left;">åœ¨ BIOS DVMTè®¾ç½®çš„åŸºç¡€ä¸Šç»™æ ¸æ˜¾å¢åŠ çš„é¢å¤–æ˜¾å­˜</td></tr><tr class="even"><td style="text-align: left;">FBMEM</td><td style="text-align: left;">0 bytes</td><td style="text-align: left;">ç¼“å†²å¸§ä¿ç•™å†…å­˜</td></tr><tr class="odd"><td style="text-align: left;">TOTAL CURSOR</td><td style="text-align: left;">1 MB</td><td style="text-align: left;">å…‰æ ‡å†…å­˜</td></tr><tr class="even"><td style="text-align: left;">TOTAL STOLEN</td><td style="text-align: left;">58 MB</td><td style="text-align: left;">ä»¥ä¸Šä¸‰é¡¹ä¹‹å’Œ</td></tr><tr class="odd"><td style="text-align: left;">VRAM</td><td style="text-align: left;">1536 MB</td><td style="text-align: left;">æ ¸æ˜¾åŠ¨æ€å†…å­˜å€¼ï¼Œä¼šåœ¨å…³äºæœ¬æœºä¸­æ˜¾ç¤º</td></tr></tbody></table><p>é¦–å…ˆå¯ç”¨ framebuffer è¡¥ä¸æ€»å¼€å…³ï¼š</p><p>framebuffer-patch-enableï¼š</p><ul><li><p>DATA æ•°æ®ï¼š01000000-&gt; 1ï¼ˆå¯ç”¨ï¼‰ 00000000 -&gt;0ï¼ˆä¸å¯ç”¨ï¼‰</p></li><li><p>NUMBER æ•°æ®ï¼š0ï¼ˆä¸å¯ç”¨ï¼‰ 1ï¼ˆå¯ç”¨ï¼‰</p></li></ul><p>å¦å¤–å¯èƒ½éœ€è¦ä»¥ä¸‹è¡¥ä¸ï¼š</p><p>1.framebuffer-stolenmemï¼Œå¯¹åº”ä¿®æ”¹è¡¨æ ¼ä¸­çš„ STOLENå€¼ï¼Œå¯¹äºé«˜åˆ†è¾¨ç‡å±å¹•å¾ˆé‡è¦ï¼Œä½†ä¹Ÿä¸åº”è®¾ç½®å¤ªé«˜ï¼š</p><ul><li>ä¸€èˆ¬ 1080P ï¼Œè®¾ç½®ä¸º 19 M å¯ä»¥ï¼š00003001</li><li>2K å±å¹•è®¾ç½®ä¸º64Mï¼š00000004</li><li>4K å°è¯•128Mï¼š00000008ï¼ˆæœ¬äººæ²¡æœ‰å°è¯•è¿‡ <del>4Kå±å¹•å¤ªè´µ</del>ï¼‰</li></ul><p>ä»¥19M çš„Stolen Memoryä¸ºä¾‹ï¼ŒFBMEM å’Œ STOLENå…·ä½“çš„æ¢ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">i. å…†å­—èŠ‚è½¬æ¢ä¸ºå­—èŠ‚<br>19 x 1024 ^ 2 = 19922944<br><br>ii.åè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼ˆå¯ä½¿ç”¨ Hackintool è®¡ç®—å™¨ï¼‰<br>19922944 -&gt; 1300000<br><br>iii.ä»å¼€å¤´è¡¥0å¹¶è¡¥é½8ä¸ªå­—ç¬¦ï¼Œå†ä¸¤ä¸¤ä¸€ç»„å€’åºæ’åˆ—<br>1300000 -&gt; 01300000 -&gt; 01 30 00 00 -&gt; 00 00 30 01 -&gt; 00003001<br></code></pre></td></tr></table></figure><p>2.framebuffer-fbmemï¼Œå¯¹åº”ä¿®æ”¹è¡¨æ ¼ä¸­çš„ FBMEM å€¼ï¼š - ä¸€èˆ¬å±å¹•è®¾ç½®æˆ 9Må¤§å°å°±å¥½ï¼š00009000 - é«˜åˆ†å±çš„è¯æœ€å¥½ç›´æ¥è®¾ç½®æˆ 48Mï¼š00000003</p><p>3.framebuffer-unifiedmemï¼Œå¯¹åº”ä¿®æ”¹è¡¨æ ¼ä¸­çš„ VRAMå€¼ï¼Œé™¤éé‡åº¦å¼ºè¿«ç—‡ï¼Œä¸€èˆ¬æƒ…å†µä¿æŒåŸç”Ÿä¸å»ºè®®ä¿®æ”¹ã€‚æ¯”å¦‚æˆ‘åŸé»˜è®¤ç°å­˜1536Mï¼Œå¯ä»¥é€šè¿‡æ­¤è¡¥ä¸ä¿®æ”¹ä¸º2048Mï¼š - 2048Mï¼š00000080 - 3072Mï¼š000000C0</p><p>4.framebuffer-cursormemï¼ˆHasswell å¹³å°ä¸“å±ï¼Œå¯èƒ½è§£å†³èŠ±å±é—®é¢˜ï¼‰ï¼š -ä¸€èˆ¬å±å¹•è®¾ç½®æˆ 9M å¤§å°å°±å¥½ï¼š00009000 - é«˜åˆ†å±çš„è¯æœ€å¥½ç›´æ¥è®¾ç½®æˆ48Mï¼š00000003</p><p>äºŒ.ä¿®å¤æ ¸æ˜¾æ¥å£</p><p>æŒ‰ç†è¯´ï¼Œç¬¬ä¸€éƒ¨åˆ†çš„é…ç½®åŸºæœ¬ä¸Šå¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚ä½†å¦‚æœå‡ºç°å¤–ç•Œæ˜¾ç¤ºå±é»‘å±çš„æƒ…å†µï¼Œå°±éœ€è¦å®šåˆ¶æ ¸æ˜¾æ¥å£äº†ã€‚</p><p>è¿˜æ˜¯å›åˆ° 3EA50009 çš„ Spoiler ä¿¡æ¯ï¼Œå…¶ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[0] busId: 0x00, pipe: 8, <span class="hljs-built_in">type</span>: 0x00000002, flags: 0x00000098 - ConnectorLVDS<br>[1] busId: 0x05, pipe: 9, <span class="hljs-built_in">type</span>: 0x00000400, flags: 0x000001C7 - ConnectorDP<br>[2] busId: 0x04, pipe: 10, <span class="hljs-built_in">type</span>: 0x00000400, flags: 0x000001C7 - ConnectorDP<br>00000800 02000000 98000000<br>01050900 00040000 C7010000<br>02040A00 00040000 C7010000<br></code></pre></td></tr></table></figure><p>æ˜¾ç„¶æ˜“è§ï¼Œè¯¥ç¼“å†²å¸§æœ‰3ä¸ªè¾“å‡ºæ¥å£ï¼Œä¸€ä¸ª LVDSï¼ˆé€šå¸¸æ˜¯ç¬”è®°æœ¬å†…å»ºè¾“å‡ºï¼‰ä¸¤ä¸ª DP è¾“å‡ºã€‚åä¸‰è¡Œçš„æ•°å€¼åˆ†åˆ«å¯¹åº”æ¯ä¸€ä¸ªconnectorï¼Œå¦‚ con0 æ¥å£çš„å®Œæ•´ä¿¡æ¯æ˜¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[0] busId: 0x00, pipe: 8, <span class="hljs-built_in">type</span>: 0x00000002, flags: 0x00000098 - ConnectorLVDS<br>00000800 02000000 98000000<br></code></pre></td></tr></table></figure><p>ä¸å¦¨è®©ä¸¤ä½ä¸º1 Bit é‚£ä¹ˆï¼š</p><ul><li><p>Bit1 00ã€‚ä»£è¡¨çš„æ˜¯æ¥å£ç¼–å·ï¼Œä»¥æ­¤ç±»æ¨æœ‰01 02</p></li><li><p>Bit2 00ã€‚ä»£è¡¨çš„æ˜¯ BusIDï¼ŒåŠ ä¸Š0xå°±å¯¹åº”äº† â€˜busId: 0x00â€™</p></li><li><p>Bit3-4 0800ã€‚æŒ‡è¯¥ connector å¯¹åº”çš„ pipe ç¼–å·</p></li><li><p>Bit5-8 02000000ã€‚æ­¤å€¼è¡¨ç¤ºæ¥å£çš„ç±»å‹ã€‚ä»ä¸­å¯ä»¥å¾—çŸ¥ LVDS æ¥å£å¯¹åº”ç€02000000ã€‚åŒç†ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å¯¹åº”å…³ç³»ï¼š</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">&lt;02 00 00 00&gt;        LVDS and eDP      // ç¬”è®°æœ¬å†…å»ºæ˜¾ç¤ºè¾“å‡º<br>&lt;10 00 00 00&gt;        VGA              <br>&lt;00 04 00 00&gt;        DisplayPort       // DP æˆ– VGA<br>&lt;01 00 00 00&gt;        DUMMY             // æ— ç‰©ç†æ¥å£æ—¶<br>&lt;00 08 00 00&gt;        HDMI<br>&lt;80 00 00 00&gt;        S-Video // Sç«¯å­è¾“å‡ºï¼Œè€å¤è‘£äº†<br>&lt;04 00 00 00&gt;        DVI (Dual Link)// DVIè€å¤è‘£äº†<br>&lt;00 02 00 00&gt;        DVI (Single Link)<br><br>æ³¨æ„ï¼šVGAæ¥å£åœ¨10.8ä»¥åŠæ›´æ–°ç³»ç»Ÿä¸Šä½¿ç”¨ 00040000 ä»£æ›¿ 10000000ï¼Œ10000000 åœ¨è€ç‰ˆæœ¬ç³»ç»Ÿä¸Šä½¿ç”¨<br></code></pre></td></tr></table></figure><p>è¿™äº›éƒ½æ˜¯ç†è®ºçŸ¥è¯†å‚¨å¤‡ï¼Œæ¥éªŒè¯ä¸€ä¸‹æ˜¯ä¸æ˜¯è¿™æ ·çš„ï¼Ÿæ‰“å¼€IORegistryExplorerï¼Œæœç´¢ IGPUå®šä½åˆ°æ ¸æ˜¾ä½ç½®ï¼Œå†ç‚¹ä¸€ä¸‹æœç´¢æ¡†çš„å‰å‰ä»¥æ˜¾ç¤ºä»–ä¸‹é¢çš„æ‰€æœ‰å­é¡¹ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°AppleIntelFramebuffer@0 AppleIntelFramebuffer@1AppleIntelFramebuffer@2ï¼Œåˆ†åˆ«å¯¹åº” con0ï¼Œcon1 å’Œ con2ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/WhateverGreen02.png" /></p><p>con0 å·²ç»è¢« LVDS æ¥å£å ç”¨ï¼Œè¿™æ˜¯å¦‚æœè¦ä½¿ç”¨ HDMI è¾“å‡ºï¼Œåˆ™éœ€è¦ä¿®æ”¹ con1æ¥å£ã€‚</p><p>1.framebuffer-conN-enableï¼ˆconN æ¥å£æ˜¯å¦å¯ç”¨è¡¥ä¸ï¼‰ï¼š</p><ul><li>DATA æ•°æ®ï¼š01000000 -&gt; 1ï¼ˆå¯ç”¨ï¼‰ 00000000 -&gt; 0ï¼ˆä¸å¯ç”¨ï¼‰</li><li>NUMBER æ•°æ®ï¼š0ï¼ˆä¸å¯ç”¨ï¼‰ 1ï¼ˆå¯ç”¨ï¼‰</li></ul><p>2.framebuffer-conN-typeï¼ŒæŒ‡å®š conN è¾“å‡ºç±»å‹</p><p>3.framebuffer-conN-indexï¼ˆè®¾ç½® conNçš„ç´¢å¼•å€¼ï¼Œä¼šæŒ‡å®šæ¥å£çš„ä¼˜å…ˆçº§ï¼‰:è¿™ä¸ªæŒ‰ä¸ªäººéœ€è¦è®¾ç½®ï¼Œå¦‚æœéœ€è¦å±è”½è¿™ä¸ªè¾“å‡ºå£ï¼Œå¯ä»¥è®¾ç½®æˆFFFFFFFFï¼Œä¹Ÿå°±æ˜¯æœ€å¤§çš„æ•°å­—ï¼Œè®©å®ƒè¶³å¤Ÿé åï¼Œè¿™æ ·å°±è¾¾åˆ°äº†å±è”½æ•ˆæœï¼</p><p>4.framebuffer-conX-busidï¼ŒæŒ‡å®š conN çš„æ€»çº¿IDï¼ŒBusIDå¯ç»è¿‡åå¤å°è¯•è·å¾—æœ€ä½³å€¼å¹¶ä¸”ä¸ª BusID æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªæ¥å£ä¸ä¹‹å¯¹åº”ã€‚</p><p>5.framebuffer-conX-alldataï¼Œæ›¿æ¢æ¥å£çš„æ‰€æœ‰ä¿¡æ¯å­—èŠ‚ã€‚</p><p>æœ€åè´´ä¸€å¼  i5 10210u è¾ƒå®Œç¾çš„é…ç½®ï¼ŒH256 HEVC ç¼–ç éƒ½æ”¯æŒ 4Kç¡¬ä»¶åŠ é€Ÿã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/WhateverGreen03.png" /></p><p><del>ç»“æŸäº†ï¼Ÿè¿˜æ²¡å‘¢ï¼Œå°±æ˜¯ç©</del></p><p>1.HDMI é«˜åˆ†å±æ”¯æŒ 60fpsï¼Œéœ€è¦æ·»åŠ  enable-hdmi20 å±æ€§ï¼Œä¸ -cdfonå¯åŠ¨å‚æ•°æ•ˆæœä¸€è‡´ã€‚</p><p>2.ç¦ç”¨ç‹¬æ˜¾å¯æ·»åŠ  disable-external-gpuï¼Œå¼•å¯¼å‚æ•° -wegnoegpuå¯è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚ä½†äº‹å®ä¸Šå¦‚æœæ˜¯é‡‡ç”¨ AOACæ¨¡å¼ç¡çœ çš„æ–°æ¬¾ç¬”è®°æœ¬ç‹¬ç«‹æ˜¾å¡æ­¤æ—¶è¿˜åœ¨å·ç”µï¼Œåªæ˜¯å¾®ä¹å…¶å¾®ï¼Œæƒ³è¦å½»åº•å±è”½ç‹¬æ˜¾éœ€è¦SSDT-NDGP_OFF-AOAC.aml è¡¥ä¸ï¼Œå…·ä½“å‚è€ƒ OC-little è¿™é‡Œä¸å†å±•å¼€ã€‚</p><p>3.WEGè¿˜æä¾›äº†äºŒè¿›åˆ¶è¡¥ä¸ï¼Œå®é™…ä¸Šæ ¹æœ¬ç”¨ä¸åˆ°ï¼Œå…¶å®æˆ‘è‡ªå·±ä¹Ÿæ²¡æœ‰ç ”ç©¶è¿‡ï¼Œè¡¥å……ä¸€ä¸‹ï¼š</p><p>framebuffer-patchN-enable (enabling patch number N)</p><p>framebuffer-patchN-framebufferid (the framebuffer that we'repatching, the current by default)</p><p>framebuffer-patchN-find</p><p>framebuffer-patchN-replace</p><p>framebuffer-patchN-count (the amount of pattern iterations to searchfor, the default is 1)</p><h2 id="intel-hd-graphicsironlake-ä¸€ä»£è¿œå¤ç‰ˆæœ¬">Intel HDGraphicsï¼ˆIronlake ä¸€ä»£è¿œå¤ç‰ˆæœ¬ï¼‰</h2><p>æŒ‰ç†è¯´ä¸€ä»£å¹¶ä¸åœ¨é©±åŠ¨æ”¯æŒçš„èŒƒå›´ä¹‹å†…ï¼Œä½†è¿˜æ˜¯æœ‰è§£å†³åŠæ³•çš„ï¼Œè¯¦è§ Guruså¤§ç¥çš„å¸–å­https://www.insanelymac.com/forum/topic/286092-guide-1st-generation-intel-hd-graphics-qeci</p><p>æ³¨æ„ï¼šä¸€ä»£æ ¸æ˜¾æ”¯æŒ Mac OS X 10.6.x åˆ° macOS10.13.6ï¼Œæ›´é«˜ç‰ˆæœ¬ç³»ç»Ÿä¸æ”¯æŒã€‚ä¸”åªèƒ½ä½¿ç”¨ LVDS æ˜¾ç¤ºå±ã€‚</p><p>åŸç”Ÿæ”¯æŒçš„Dev IDï¼š 0x0042 0x0046</p><h2 id="intel-hd-graphics-20003000-sandy-bridgeæ¶æ„">Intel HD Graphics2000/3000 (Sandy Bridgeæ¶æ„)</h2><p>æ”¯æŒç³»ç»Ÿç‰ˆæœ¬ï¼šMac OS X 10.7.x to macOS 10.13.6</p><p>SNB FB åˆ—è¡¨ï¼š</p><table><thead><tr class="header"><th style="text-align: left;">Framebufferå€¼</th><th style="text-align: left;">Typeç±»å‹</th><th style="text-align: left;">Connectorsè¾“å‡ºæ¥å£æ•°</th><th style="text-align: left;">TOTAL STOLEN Memory</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">0x00010000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">4</td><td style="text-align: left;">32 MB</td></tr><tr class="even"><td style="text-align: left;">0x00020000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">1</td><td style="text-align: left;">32 MB</td></tr><tr class="odd"><td style="text-align: left;">0x00030010</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">32 MB</td></tr><tr class="even"><td style="text-align: left;">0x00030020</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">32 MB</td></tr><tr class="odd"><td style="text-align: left;">0x00030030</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">32 MB</td></tr><tr class="even"><td style="text-align: left;">0x00040000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">32 MB</td></tr><tr class="odd"><td style="text-align: left;">0x00050000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">32 MB</td></tr></tbody></table><p>åŸç”Ÿæ”¯æŒçš„Dev IDï¼š 0x0106 0x1106 0x1601 0x0116 0x0126 0x0102</p><p><strong>æ¨èçš„ Framebuffers</strong>ï¼š</p><ul><li>Desktopï¼š0x00030010</li><li>Laptopï¼š 0x00010000</li><li>ç©ºç¼“å†²å¸§ï¼š 0x00050000</li></ul><p>æ³¨æ„ï¼š</p><p>1.åªæœ‰ HD3000 èƒ½å¤Ÿç›´æ¥é©±åŠ¨ï¼ŒHD2000éœ€è¦é€‰æ‹©ç©ºç¼“å†²å¸§ä»¥ä½¿ IQSVæ­£å¸¸å·¥ä½œï¼Œå…·ä½“è¯¦è§https://www.applelife.ru/threads/zavod-intel-quick-sync-video.817923/</p><p><del>ï¼ˆåªæœ‰ä¿„æ–‡ç‰ˆæœ¬ï¼Œåæ­£æˆ‘è‡ªå·±æ²¡çœ‹è¿‡ï¼Œæ ¹æœ¬çœ‹ä¸æ‡‚ï¼‰</del></p><p>2.é€šå¸¸ SNB å¹³å°ä¸ç”¨å†™ FBï¼ŒWhateverGreen ä¼šæ ¹æ® board-id å€¼è‡ªåŠ¨è¡¥å……FBã€‚å¦‚æœä¸æ˜¯ SNB æ¶æ„ï¼ˆå¦‚ Ivy + HD3000 çš„ MacBookPro9,1ï¼‰éœ€è¦æŒ‡å®šFBï¼ŒAAPL,snb-platform-id å¯ä»¥å†™ 10000300ã€‚</p><p>3.æ¡Œé¢çº§éœ€è¦ä»¿å†’ device-id ä¸º 26010000ã€‚</p><p>4.å¦‚æœæ˜¯7ç³»åˆ—ä¸»æ¿ï¼ˆå¦‚ X79ï¼ŒZ75ï¼ŒZ77 èŠ¯ç‰‡ç»„ï¼‰éœ€è¦ä»¿å†’ device-id ä¸º3A1C0000ï¼Œå¹¶ä¸”æ‰“ä¸Š <ahref="https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/AcpiSamples/Source/SSDT-IMEI.dsl">SSDT-IMEI</a>è¡¥ä¸</p><h2 id="intel-hd-graphics-25004000-ivy-bridgeæ¶æ„">Intel HD Graphics2500/4000 (Ivy Bridgeæ¶æ„)</h2><p>æ”¯æŒ OS X 10.8.x åŠæ›´æ–°ç‰ˆæœ¬ã€‚</p><p>Ivy FB åˆ—è¡¨ï¼š</p><table><thead><tr class="header"><th style="text-align: left;">Framebufferå€¼</th><th style="text-align: left;">Typeç±»å‹</th><th style="text-align: left;">Connectorsè¾“å‡ºæ¥å£æ•°</th><th style="text-align: left;">TOTAL STOLEN Memory</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">0x01660000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">4</td><td style="text-align: left;">24 MB</td></tr><tr class="even"><td style="text-align: left;">0x01620006</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">0 bytes</td></tr><tr class="odd"><td style="text-align: left;">0x01620007</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">0 bytes</td></tr><tr class="even"><td style="text-align: left;">0x01620005</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">16 MB</td></tr><tr class="odd"><td style="text-align: left;">0x01660001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">4</td><td style="text-align: left;">24 MB</td></tr><tr class="even"><td style="text-align: left;">0x01660002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">1</td><td style="text-align: left;">24 MB</td></tr><tr class="odd"><td style="text-align: left;">0x01660008</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">16 MB</td></tr><tr class="even"><td style="text-align: left;">0x01660009</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">16 MB</td></tr><tr class="odd"><td style="text-align: left;">0x01660003</td><td style="text-align: left;">mobile</td><td style="text-align: left;">4</td><td style="text-align: left;">16 MB</td></tr><tr class="even"><td style="text-align: left;">0x01660004</td><td style="text-align: left;">mobile</td><td style="text-align: left;">1</td><td style="text-align: left;">16 MB</td></tr><tr class="odd"><td style="text-align: left;">0x0166000A</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">16 MB</td></tr><tr class="even"><td style="text-align: left;">0x0166000B</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">16 MB</td></tr></tbody></table><p>åŸç”Ÿæ”¯æŒçš„Dev IDï¼š 0x0152 0x0156 0x0162 0x0166</p><p><strong>æ¨èçš„ Framebuffers</strong>ï¼š</p><ul><li>Desktopï¼š<ul><li>0x0166000A (default)</li><li>0x01620005</li></ul></li><li>Laptopï¼š<ul><li>0x01660003 (default)</li><li>0x01660009</li><li>0x01660004</li></ul></li><li>ç©ºç¼“å†²å¸§ï¼š<ul><li>0x01620007 (default)</li></ul></li></ul><p>æ³¨æ„ï¼š</p><p>1.åªæœ‰ HD4000 èƒ½å¤Ÿç›´æ¥é©±åŠ¨ï¼ŒHD2500éœ€è¦é€‰æ‹©ç©ºç¼“å†²å¸§ä»¥ä½¿ IQSVæ­£å¸¸å·¥ä½œï¼Œå…·ä½“è¯¦è§https://www.applelife.ru/threads/zavod-intel-quick-sync-video.817923/</p><p>2.å¦‚æœæ˜¯6ç³»åˆ—ä¸»æ¿éœ€è¦ä»¿å†’ device-id ä¸º 3A1E0000ï¼Œå¹¶ä¸”æ‰“ä¸Š <ahref="https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/AcpiSamples/Source/SSDT-IMEI.dsl">SSDT-IMEI</a>è¡¥ä¸ã€‚</p><h2 id="intel-hd-graphics-4200-5200-haswellæ¶æ„">Intel HD Graphics4200-5200 (Haswellæ¶æ„)</h2><p>æ”¯æŒ OS X 10.9.x åŠæ›´æ–°ç‰ˆæœ¬ã€‚</p><p>Azul FB åˆ—è¡¨:</p><table><thead><tr class="header"><th style="text-align: left;">Framebufferå€¼</th><th style="text-align: left;">Typeç±»å‹</th><th style="text-align: left;">Connectorsè¾“å‡ºæ¥å£æ•°</th><th style="text-align: left;">TOTAL STOLEN Memory</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">0x0C060000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">209 MB</td></tr><tr class="even"><td style="text-align: left;">0x0C160000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">209 MB</td></tr><tr class="odd"><td style="text-align: left;">0x0C260000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">209 MB</td></tr><tr class="even"><td style="text-align: left;">0x04060000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">209 MB</td></tr><tr class="odd"><td style="text-align: left;">0x04160000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">209 MB</td></tr><tr class="even"><td style="text-align: left;">0x04260000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">209 MB</td></tr><tr class="odd"><td style="text-align: left;">0x0D260000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">209 MB</td></tr><tr class="even"><td style="text-align: left;">0x0A160000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">209 MB</td></tr><tr class="odd"><td style="text-align: left;">0x0A260000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">209 MB</td></tr><tr class="even"><td style="text-align: left;">0x0A260005</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">52 MB</td></tr><tr class="odd"><td style="text-align: left;">0x0A260006</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">52 MB</td></tr><tr class="even"><td style="text-align: left;">0x0A2E0008</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">99 MB</td></tr><tr class="odd"><td style="text-align: left;">0x0A16000C</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">99 MB</td></tr><tr class="even"><td style="text-align: left;">0x0D260007</td><td style="text-align: left;">mobile</td><td style="text-align: left;">4</td><td style="text-align: left;">99 MB</td></tr><tr class="odd"><td style="text-align: left;">0x0D220003</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">52 MB</td></tr><tr class="even"><td style="text-align: left;">0x0A2E000A</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">52 MB</td></tr><tr class="odd"><td style="text-align: left;">0x0A26000A</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">52 MB</td></tr><tr class="even"><td style="text-align: left;">0x0A2E000D</td><td style="text-align: left;">desktop</td><td style="text-align: left;">2</td><td style="text-align: left;">131 MB</td></tr><tr class="odd"><td style="text-align: left;">0x0A26000D</td><td style="text-align: left;">desktop</td><td style="text-align: left;">2</td><td style="text-align: left;">131 MB</td></tr><tr class="even"><td style="text-align: left;">0x04120004</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="odd"><td style="text-align: left;">0x0412000B</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="even"><td style="text-align: left;">0x0D260009</td><td style="text-align: left;">mobile</td><td style="text-align: left;">1</td><td style="text-align: left;">99 MB</td></tr><tr class="odd"><td style="text-align: left;">0x0D26000E</td><td style="text-align: left;">mobile</td><td style="text-align: left;">4</td><td style="text-align: left;">131 MB</td></tr><tr class="even"><td style="text-align: left;">0x0D26000F</td><td style="text-align: left;">mobile</td><td style="text-align: left;">1</td><td style="text-align: left;">131 MB</td></tr></tbody></table><p>åŸç”Ÿæ”¯æŒçš„Dev IDï¼š 0x0d26 0x0a26 0x0a2e 0x0d22 0x0412</p><p><strong>æ¨èçš„ Framebuffers</strong>ï¼š</p><ul><li>Desktop:<ul><li>0x0D220003 (default)</li></ul></li><li>Laptop:<ul><li>0x0A160000 (default)</li><li>0x0A260005 (recommended)</li><li>0x0A260006 (recommended)</li></ul></li><li>Empty Framebuffer:<ul><li>0x04120004 (default)</li></ul></li></ul><p>æ³¨æ„ï¼š æ¡Œé¢ HD4400 å’Œç§»åŠ¨ç«¯ HD4200/HD4400/HD4600 éœ€è¦ä»¿å†’ device-idä¸º 12040000</p><h2 id="intel-hd-graphics-5300-6300-broadwellæ¶æ„">Intel HD Graphics5300-6300 (Broadwellæ¶æ„)</h2><p>æ”¯æŒ OS X 10.10.2 åŠæ›´æ–°ç‰ˆæœ¬ã€‚</p><p>BDW FB åˆ—è¡¨ï¼š</p><table><thead><tr class="header"><th style="text-align: left;">Framebufferå€¼</th><th style="text-align: left;">Typeç±»å‹</th><th style="text-align: left;">Connectorsè¾“å‡ºæ¥å£æ•°</th><th style="text-align: left;">TOTAL STOLEN Memory</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">0x16060000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">32 MB</td></tr><tr class="even"><td style="text-align: left;">0x160E0000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">32 MB</td></tr><tr class="odd"><td style="text-align: left;">0x16160000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">32 MB</td></tr><tr class="even"><td style="text-align: left;">0x161E0000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">32 MB</td></tr><tr class="odd"><td style="text-align: left;">0x16260000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">32 MB</td></tr><tr class="even"><td style="text-align: left;">0x162B0000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">32 MB</td></tr><tr class="odd"><td style="text-align: left;">0x16220000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">32 MB</td></tr><tr class="even"><td style="text-align: left;">0x160E0001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">60 MB</td></tr><tr class="odd"><td style="text-align: left;">0x161E0001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">60 MB</td></tr><tr class="even"><td style="text-align: left;">0x16060002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="odd"><td style="text-align: left;">0x16160002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="even"><td style="text-align: left;">0x16260002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="odd"><td style="text-align: left;">0x16220002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="even"><td style="text-align: left;">0x162B0002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="odd"><td style="text-align: left;">0x16120003</td><td style="text-align: left;">mobile</td><td style="text-align: left;">4</td><td style="text-align: left;">56 MB</td></tr><tr class="even"><td style="text-align: left;">0x162B0004</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="odd"><td style="text-align: left;">0x16260004</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="even"><td style="text-align: left;">0x16220007</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">77 MB</td></tr><tr class="odd"><td style="text-align: left;">0x16260005</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="even"><td style="text-align: left;">0x16260006</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="odd"><td style="text-align: left;">0x162B0008</td><td style="text-align: left;">desktop</td><td style="text-align: left;">2</td><td style="text-align: left;">69 MB</td></tr><tr class="even"><td style="text-align: left;">0x16260008</td><td style="text-align: left;">desktop</td><td style="text-align: left;">2</td><td style="text-align: left;">69 MB</td></tr></tbody></table><p>åŸç”Ÿæ”¯æŒçš„Dev ID: 0x0BD1 0x0BD2 0x0BD3 0x1606 0x160e 0x1616 0x161e0x1626 0x1622 0x1612 0x162b</p><p><strong>æ¨èçš„ Framebuffers</strong>:</p><ul><li>Desktop:<ul><li>0x16220007 (default)</li></ul></li><li>Laptop:<ul><li>0x16260006 (default)</li></ul></li></ul><h2 id="intel-hd-graphics-510-580-skylakeæ¶æ„">Intel HD Graphics 510-580(Skylakeæ¶æ„)</h2><p>æ”¯æŒ OS X 10.11.4 åŠæ›´æ–°ç‰ˆæœ¬ã€‚</p><p>SKL FB åˆ—è¡¨ï¼š</p><table><thead><tr class="header"><th style="text-align: left;">Framebufferå€¼</th><th style="text-align: left;">Typeç±»å‹</th><th style="text-align: left;">Connectorsè¾“å‡ºæ¥å£æ•°</th><th style="text-align: left;">TOTAL STOLEN Memory</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">0x191E0000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="even"><td style="text-align: left;">0x19160000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="odd"><td style="text-align: left;">0x19260000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="even"><td style="text-align: left;">0x19270000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="odd"><td style="text-align: left;">0x191B0000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="even"><td style="text-align: left;">0x193B0000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="odd"><td style="text-align: left;">0x19120000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">56 MB</td></tr><tr class="even"><td style="text-align: left;">0x19020001</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="odd"><td style="text-align: left;">0x19170001</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="even"><td style="text-align: left;">0x19120001</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="odd"><td style="text-align: left;">0x19320001</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="even"><td style="text-align: left;">0x19160002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="odd"><td style="text-align: left;">0x19260002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="even"><td style="text-align: left;">0x191E0003</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">41 MB</td></tr><tr class="odd"><td style="text-align: left;">0x19260004</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">35 MB</td></tr><tr class="even"><td style="text-align: left;">0x19270004</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="odd"><td style="text-align: left;">0x193B0005</td><td style="text-align: left;">mobile</td><td style="text-align: left;">4</td><td style="text-align: left;">35 MB</td></tr><tr class="even"><td style="text-align: left;">0x191B0006</td><td style="text-align: left;">mobile</td><td style="text-align: left;">1</td><td style="text-align: left;">39 MB</td></tr><tr class="odd"><td style="text-align: left;">0x19260007</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">35 MB</td></tr></tbody></table><p>åŸç”Ÿæ”¯æŒçš„Dev ID: 0x1916 0x191E 0x1926 0x1927 0x1912 0x1932 0x19020x1917 0x193B 0x191B</p><p><strong>æ¨èçš„ Framebuffers</strong>:</p><ul><li>Desktop:<ul><li>0x19120000 (default)</li></ul></li><li>Laptop:<ul><li>0x19160000 (default)</li></ul></li><li>Empty Framebuffer:<ul><li>0x19120001 (default)</li></ul></li></ul><h2 id="intel-uhd-graphics-610-650-kaby-lakeå’Œamber-lake-yæ¶æ„">Intel(U)HD Graphics 610-650 (Kaby Lakeå’ŒAmber Lake Yæ¶æ„)</h2><p>æ”¯æŒ macOS 10.12.6 åŠæ›´æ–°ç‰ˆæœ¬ï¼ˆå…¶ä¸­ UHD617 Amber Lake Y å‹å·æœ€ä½ç‰ˆæœ¬macOS 10.14.1ï¼‰ã€‚</p><p>KBL/ABL FB åˆ—è¡¨ï¼š</p><table><thead><tr class="header"><th style="text-align: left;">Framebufferå€¼</th><th style="text-align: left;">Typeç±»å‹</th><th style="text-align: left;">Connectorsè¾“å‡ºæ¥å£æ•°</th><th style="text-align: left;">TOTAL STOLEN Memory</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">0x591E0000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">35 MB</td></tr><tr class="even"><td style="text-align: left;">0x87C00000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">35 MB</td></tr><tr class="odd"><td style="text-align: left;">0x59160000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">35 MB</td></tr><tr class="even"><td style="text-align: left;">0x59230000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">39 MB</td></tr><tr class="odd"><td style="text-align: left;">0x59260000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">39 MB</td></tr><tr class="even"><td style="text-align: left;">0x59270000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">39 MB</td></tr><tr class="odd"><td style="text-align: left;">0x59270009</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">39 MB</td></tr><tr class="even"><td style="text-align: left;">0x59160009</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">39 MB</td></tr><tr class="odd"><td style="text-align: left;">0x59120000</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">39 MB</td></tr><tr class="even"><td style="text-align: left;">0x591B0000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">39 MB</td></tr><tr class="odd"><td style="text-align: left;">0x591E0001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">39 MB</td></tr><tr class="even"><td style="text-align: left;">0x59180002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="odd"><td style="text-align: left;">0x59120003</td><td style="text-align: left;">mobile</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="even"><td style="text-align: left;">0x59260007</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">79 MB</td></tr><tr class="odd"><td style="text-align: left;">0x59270004</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="even"><td style="text-align: left;">0x59260002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="odd"><td style="text-align: left;">0x87C00005</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="even"><td style="text-align: left;">0x591C0005</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="odd"><td style="text-align: left;">0x591B0006</td><td style="text-align: left;">mobile</td><td style="text-align: left;">1</td><td style="text-align: left;">39 MB</td></tr></tbody></table><p>åŸç”Ÿæ”¯æŒçš„Dev ID: - KBL: 0x5912 0x5916 0x591B 0x591C 0x591E 0x59260x5927 0x5923 - ABL: 0x87C0</p><p><strong>æ¨èçš„ Framebuffers</strong>:</p><ul><li>Desktop:<ul><li>0x59160000 (default)</li><li>0x59120000 (recommended)</li></ul></li><li>Laptop:<ul><li>0x591B0000 (default)</li></ul></li><li>Empty Framebuffer:<ul><li>0x59120003 (default)</li></ul></li></ul><p>æ³¨æ„ï¼š UHD620 éœ€è¦ä»¿å†’ device-id ä¸º 16590000</p><h2 id="intel-uhd-graphics-610-655-coffee-lakeå’Œcomet-lakeæ¶æ„">IntelUHD Graphics 610-655 (Coffee Lakeå’ŒComet Lakeæ¶æ„)</h2><p>æ”¯æŒ macOS 10.14 åŠæ›´æ–°ç‰ˆæœ¬ï¼ˆå…¶ä¸­ UHD630 Comet Lake å‹å·æœ€ä½ç‰ˆæœ¬macOS 10.15.4ï¼Œæ¨è10.15.5ï¼‰ã€‚</p><p>CFL/CML FB åˆ—è¡¨ï¼š</p><table><thead><tr class="header"><th style="text-align: left;">Framebufferå€¼</th><th style="text-align: left;">Typeç±»å‹</th><th style="text-align: left;">Connectorsè¾“å‡ºæ¥å£æ•°</th><th style="text-align: left;">TOTAL STOLEN Memory</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">0x3EA50009</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="even"><td style="text-align: left;">0x3E920009</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="odd"><td style="text-align: left;">0x3E9B0009</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="even"><td style="text-align: left;">0x3EA50000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="odd"><td style="text-align: left;">0x3E920000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="even"><td style="text-align: left;">0x3E000000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="odd"><td style="text-align: left;">0x3E9B0000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="even"><td style="text-align: left;">0x3EA50004</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="odd"><td style="text-align: left;">0x3EA50005</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="even"><td style="text-align: left;">0x3EA60005</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="odd"><td style="text-align: left;">0x3E9B0006</td><td style="text-align: left;">mobile</td><td style="text-align: left;">1</td><td style="text-align: left;">39 MB</td></tr><tr class="even"><td style="text-align: left;">0x3E9B0008</td><td style="text-align: left;">mobile</td><td style="text-align: left;">1</td><td style="text-align: left;">58 MB</td></tr><tr class="odd"><td style="text-align: left;">0x3E9B0007</td><td style="text-align: left;">desktop</td><td style="text-align: left;">3</td><td style="text-align: left;">58 MB</td></tr><tr class="even"><td style="text-align: left;">0x3E920003</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="odd"><td style="text-align: left;">0x3E910003</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="even"><td style="text-align: left;">0x3E980003</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="odd"><td style="text-align: left;">0x9BC80003</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="even"><td style="text-align: left;">0x9BC50003</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr><tr class="odd"><td style="text-align: left;">0x9BC40003</td><td style="text-align: left;">desktop</td><td style="text-align: left;">0</td><td style="text-align: left;">1 MB</td></tr></tbody></table><p>åŸç”Ÿæ”¯æŒçš„Dev ID: - CFL: 0x3E9B 0x3EA5 0x3EA6 0x3E92 0x3E91 0x3E98 -CML: 0x9BC8 0x9BC5 0x9BC4</p><p><strong>æ¨èçš„ Framebuffers</strong>:</p><ul><li>Desktop:<ul><li>0x3EA50000 (default)</li><li>0x3E9B0007 (recommended)</li></ul></li><li>Laptop:<ul><li>0x3EA50009 (default)</li></ul></li><li>Empty framebuffer (CFL):<ul><li>0x3E910003 (default)</li></ul></li><li>Empty framebuffer (CML):<ul><li>0x9BC80003 (default)</li></ul></li></ul><p>æ³¨æ„ï¼š</p><p>1.macOS 10.14.4é™¤å¤–ï¼Œä¹ä»£ CoffeLake éœ€ä»¿å†’ device-id ä¸º923E0000ã€‚</p><p>2.Whiskey Lake UHD620 éœ€ä»¿å†’ device-id ä¸º A53E0000ã€‚</p><h2 id="intel-iris-plus-graphics-ice-lakeæ¶æ„">Intel Iris Plus Graphics(Ice Lakeæ¶æ„)</h2><p>æ”¯æŒ macOS 10.15.4 åŠæ›´æ–°ç‰ˆæœ¬ã€‚</p><p>ICL FB åˆ—è¡¨ï¼š</p><table><thead><tr class="header"><th style="text-align: left;">Framebufferå€¼</th><th style="text-align: left;">Typeç±»å‹</th><th style="text-align: left;">Connectorsè¾“å‡ºæ¥å£æ•°</th><th style="text-align: left;">TOTAL STOLEN Memory</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">0xFF050000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">193 MB?</td></tr><tr class="even"><td style="text-align: left;">0x8A710000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">6</td><td style="text-align: left;">193 MB?</td></tr><tr class="odd"><td style="text-align: left;">0x8A700000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">6</td><td style="text-align: left;">193 MB?</td></tr><tr class="even"><td style="text-align: left;">0x8A510000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">6</td><td style="text-align: left;">193 MB?</td></tr><tr class="odd"><td style="text-align: left;">0x8A5C0000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">6</td><td style="text-align: left;">193 MB?</td></tr><tr class="even"><td style="text-align: left;">0x8A5D0000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">6</td><td style="text-align: left;">193 MB?</td></tr><tr class="odd"><td style="text-align: left;">0x8A520000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">6</td><td style="text-align: left;">193 MB?</td></tr><tr class="even"><td style="text-align: left;">0x8A530000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">6</td><td style="text-align: left;">193 MB?</td></tr><tr class="odd"><td style="text-align: left;">0x8A5A0000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">6</td><td style="text-align: left;">193 MB?</td></tr><tr class="even"><td style="text-align: left;">0x8A5B0000</td><td style="text-align: left;">mobile</td><td style="text-align: left;">6</td><td style="text-align: left;">193 MB?</td></tr><tr class="odd"><td style="text-align: left;">0x8A710001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">5</td><td style="text-align: left;">193 MB?</td></tr><tr class="even"><td style="text-align: left;">0x8A700001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">5</td><td style="text-align: left;">193 MB?</td></tr><tr class="odd"><td style="text-align: left;">0x8A510001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">193 MB?</td></tr><tr class="even"><td style="text-align: left;">0x8A5C0001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">193 MB?</td></tr><tr class="odd"><td style="text-align: left;">0x8A5D0001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">193 MB?</td></tr><tr class="even"><td style="text-align: left;">0x8A520001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">5</td><td style="text-align: left;">193 MB?</td></tr><tr class="odd"><td style="text-align: left;">0x8A530001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">5</td><td style="text-align: left;">193 MB?</td></tr><tr class="even"><td style="text-align: left;">0x8A5A0001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">5</td><td style="text-align: left;">193 MB?</td></tr><tr class="odd"><td style="text-align: left;">0x8A5B0001</td><td style="text-align: left;">mobile</td><td style="text-align: left;">5</td><td style="text-align: left;">193 MB?</td></tr><tr class="even"><td style="text-align: left;">0x8A510002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">193 MB?</td></tr><tr class="odd"><td style="text-align: left;">0x8A5C0002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">3</td><td style="text-align: left;">193 MB?</td></tr><tr class="even"><td style="text-align: left;">0x8A520002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">5</td><td style="text-align: left;">193 MB?</td></tr><tr class="odd"><td style="text-align: left;">0x8A530002</td><td style="text-align: left;">mobile</td><td style="text-align: left;">5</td><td style="text-align: left;">193 MB?</td></tr></tbody></table><p>åŸç”Ÿæ”¯æŒçš„Dev ID: 0xff05 0x8A70 0x8A71 0x8A51 0x8A5C 0x8A5D 0x8A520x8A53 0x8A5A 0x8A5B</p><p><strong>æ¨èçš„ Framebuffers</strong>: - Laptop: - 0x8A520000(default)</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>å†œæ°‘çš„æ—¶é—´è§‚å¿µ</title>
    <link href="/2021/05/01/%E6%97%B6%E9%97%B4%E6%84%9F/"/>
    <url>/2021/05/01/%E6%97%B6%E9%97%B4%E6%84%9F/</url>
    
    <content type="html"><![CDATA[<p>å†œæ°‘çš„æ—¶é—´è§‚å¿µï¼Œåˆ™æ˜¯åœ¨ä¼ ç»Ÿå†œä¸šç”Ÿäº§æ–¹å¼å’Œä¼ ç»Ÿç¤¾ä¼šåˆ¶åº¦çš„åŒé‡ä½œç”¨ä¹‹ä¸‹å½¢æˆçš„ã€‚åœ¨è¿™ç§æ—¶é—´æ„Ÿä¹‹ä¸‹ï¼Œå†œæ°‘å¾€å¾€åˆ©ç”¨äº‹ä»¶æ¥è®°å¿†æ—¶é—´ï¼Œä»¥ä¼¸ç¼©çµæ´»çš„äº‹ä»¶è¡¨è¿°æ¥è¡¨è¾¾æ—¶é—´ã€‚è€Œäº‹ä»¶æœ¬èº«çš„æ„ä¹‰åˆ™åˆæ„æˆæ—¶é—´è®°å¿†çš„æ„ä¹‰ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚å†œæ°‘é€šè¿‡å¯¹äº‹ä»¶æ„ä¹‰çš„ä¸²è”ï¼Œå½¢æˆå®Œæ•´çš„è®°å¿†å’Œæ—¶é—´ä½“ç³»ã€‚ä»¥äº‹ä»¶ä¸ºåŸºç¡€æ„è±¡ï¼Œå°†è‡ªç„¶ä¸å¿ƒçµäº¤æµåå½¢æˆçš„çµæ´»ä¸”æœ‰æ€»ä½“è§„å¾‹çš„æ—¶é—´èåˆåˆ°ç‹¬æœ‰çš„è®°å¿†ä½“ç³»ä¸­ï¼Œæ„æˆäº†ä¸€ä¸ªæ•´ä½“çš„æ—¶é—´æ„Ÿã€‚</p><p>ç„¶è€Œï¼Œæˆ‘è¿˜åº”å½“çœ‹åˆ°ï¼Œåœ¨å‘ç”Ÿå·¨å˜çš„å½“ä¸‹å†œæ‘ï¼Œç°ä»£æ€§é•¿é©±ç›´å…¥ï¼Œå·²ç»åœ¨é€æ¸æ”¹å˜ç€å†œæ°‘çš„æ—¶é—´æ„Ÿã€‚æˆ–è®¸åœ¨ä¸ä¹…çš„æœªæ¥ï¼Œå†œæ°‘çš„æ—¶é—´è§‚å¿µä¹Ÿä¼šå‘ˆç°ç°ä»£æ€§çš„é¢è²Œã€‚æ¯‹åº¸ç½®ç–‘çš„æ˜¯ï¼Œç°ä»£æ€§æ·±åˆ»åœ°å†²å‡»ç€ä¼ ç»Ÿæ€§å¹¶å‰§çƒˆåœ°æ”¹å˜ç€å½“ä¸‹çš„ä¸­å›½å†œæ‘ã€‚</p><p>â€”â€”èŠ‚é€‰è‡ª é»„å¥ã€Šæ—¶é—´æ„Ÿã€‹</p><p>æˆ‘ä»¬æ·±å—ç€åŸå¸‚æ–‡æ˜å’Œç°ä»£ç”Ÿæ´»çš„ç†é™¶ï¼Œåœ¨é¢å¯¹å†œæ°‘è¿Ÿç¼“çš„è¡ŒåŠ¨èŠ‚å¥å’Œå‡ ä¹æ•£ä¹±çš„æ—¶é—´å®‰æ’æ—¶ï¼Œå¯èƒ½ä¼šè‡ªç„¶åœ°å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šå†œæ°‘æ²¡æœ‰æ—¶é—´è§‚å¿µã€‚æœ¬æ–‡æåˆ°äº†å†œæ°‘çš„æ—¶é—´æ„Ÿæœ‰å››ç‚¹ç‰¹æ€§ï¼šä»¥æ—¶é—´ä¸ºæ ‡åº¦çš„å¾ªç¯æ—¶é—´å°ºåº¦ï¼›ä¼¸ç¼©æ€§å¼ºçš„å¼¹æ€§æ—¶é—´ï¼›ä¸å†œä¸šç”Ÿäº§ç´§å¯†è”ç³»çš„ä¼ ç»Ÿæ—¶é—´ï¼›æ²‰æ·€åˆ°å…·ä½“äº‹é¡¹ä¸Šçš„çµæ„ŸçŸ¥æ—¶é—´ã€‚</p><p>æˆ‘å›½å¤ä»£ä½œä¸ºé•¿æœŸçš„å†œä¸šå¤§å›½ï¼Œä¸­å›½äººä¸€ç›´æœ‰ç€å®‰åœŸé‡è¿çš„ä¼ ç»Ÿã€‚ã€Šä¹¡åœŸä¸­å›½ã€‹ä¸­æåˆ°äº†å†œä¸šæ–‡æ˜æ˜¯å…·æœ‰ä¹¡åœŸæ€§çš„ï¼Œå†œæ°‘è¿‘ä¹ä¸€è¾ˆå­ä¾èµ–äºåœŸåœ°ã€‚åœ¨åœŸåœ°ä¸­å¯»æ±‚å‘å±•ï¼Œè¿™ç§æ–‡åŒ–å½¢æ€é•¿æœŸæµ¸æŸ“ç€æ°‘æ—æ–‡åŒ–å¿ƒç†ã€‚å†œæ°‘ä»¬çš„â€œä¸ç´§ä¸æ…¢â€çš„æ—¶é—´æ„Ÿä¹Ÿæ˜¯ä¸€ä¸ªå†å²å¿…ç„¶äº§ç‰©ï¼Œè‡³å°‘åœ¨åŸå¸‚æ–‡æ˜æ™®åŠå‰ï¼Œä¹¡ä¸‹çš„äººä»¬éƒ½ä¿æŒç€è¿™ç§æ—¶é—´è§‚å¿µã€‚</p><p>éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå†œæ°‘çš„æ—¶é—´è§‚å¿µä¹Ÿä¼šå‘ˆç°ç°ä»£æ€§çš„é¢è²Œï¼Œç”± flexibleå˜å¾—æ›´åŠ compactã€‚å¯æ˜¯ä»”ç»†æƒ³æƒ³ï¼ŒåŸé‡Œäººä¼¼ä¹æ—©å·²æ”€ä¸Šäº†åˆ¶é«˜ç‚¹ï¼Œä»¥è‡ªå·±çš„ä»·å€¼å–å‘ç”¨å˜²è®½çš„ç›®å…‰æ‰“é‡ç€å†œæ°‘éšå’Œæ•£æ¼«çš„æ—¶é—´è§‚å¿µã€‚ä½•æ–¹ä¸ç†æ€§å®¡è§†è‡ªèº«ï¼Œé¢å¯¹åŸå¸‚åŒ–çš„é’¢é“æ´ªæµï¼Œä¹Ÿå¯ä»¥æ”¾æ…¢ç”Ÿæ´»çš„è„šæ­¥ï¼Œå“æ¯é¦™èŒ—ï¼Œæ„Ÿå—ç”Ÿæ´»çš„è¯—å’Œè¿œæ–¹ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ç¡¬æ ¸Linuxå‘è¡Œç‰ˆï¼šè®°å½•ä¸€æ¬¡å®Œæ•´çš„Archlinuxå®‰è£…è¿‡ç¨‹</title>
    <link href="/2021/02/25/Archlinux/"/>
    <url>/2021/02/25/Archlinux/</url>
    
    <content type="html"><![CDATA[<h1id="ç¡¬æ ¸linuxå‘è¡Œç‰ˆè®°å½•ä¸€æ¬¡å®Œæ•´çš„archlinuxå®‰è£…è¿‡ç¨‹">ç¡¬æ ¸Linuxå‘è¡Œç‰ˆï¼šè®°å½•ä¸€æ¬¡å®Œæ•´çš„Archlinuxå®‰è£…è¿‡ç¨‹</h1><p>å‚è€ƒæ–‡æ¡£ï¼Œæ„Ÿè°¢åŸä½œè€…åŠArchlinuxç¤¾åŒºçš„è´¡çŒ®ï¼š - <ahref="https://wiki.archlinux.org/index.php/Arch_Linux">Arch Wiki-ArchLinux</a> - <ahref="https://wiki.archlinux.org/index.php/Installation_guide">ArchWiki-Installation Guide</a> - <ahref="https://wiki.archlinux.org/index.php/Arch_boot_process#Boot_loader">ArchWiki-Bootloader</a> - <ahref="https://blog.csdn.net/cristianojason/article/details/80033330">CSDN-Win10ä¸Šå®‰è£…Archlinux(BIOSå¼•å¯¼)</a></p><h2 id="intro">Intro</h2><p>å½“æˆ‘ç¬¬ä¸€æ¬¡äº†è§£åˆ° Archlinuxè¿™ç‹¬å…·ç‰¹è‰²çš„å‘è¡Œç‰ˆåï¼Œæˆ‘çš„å¤§è„‘æ˜¯è¿™æ ·æƒ³çš„``( ï¿£ãƒ¼ï¿£)</p><pre><code class="hljs">è¿™ä»€ä¹ˆç©æ„ï¼Œå…¨ç¨‹å®‰è£…æ— å›¾å½¢ç•Œé¢ï¼ŒNTç©å®¶æ‰ä¼šå»æŠ˜è…¾è¿™ç©æ„ã€‚ã€‚ã€‚æ»šåŠ¨æ›´æ–°æœ‰ä»€ä¹ˆå®é™…æ„ä¹‰ï¼Ÿåªä¼šå¯¼è‡´ç³»ç»Ÿç¨³å®šæ€§ä¸‹é™å§ã€‚......</code></pre><p>ä½†ä¼¼ä¹åœ¨å¾ˆå¤šç¤¾äº¤ç½‘ç«™æˆ–è€…æŠ€æœ¯è®ºå›ä¸Šï¼Œæ€»ä¼šå‡ºç°ä¸€ç¾¤ Archlinuxçš„é‚ªæ•™å¾’çš„èº«å½±ï¼Œä»–ä»¬é«˜å£°å¤§å–Šç€ï¼šArchlinux,yes!~~ã€‚è¡Œå§ï¼Œäºæ˜¯æˆ‘ä¹ŸæŠ±ç€è¯•è¯•çœ‹çš„å¿ƒç†å¼€å§‹æ¥è§¦Archã€‚<em><del>ä¸¤ä¸‰å¤©åï¼Œä¸å‡ºæ„å¤–çš„ çœŸé¦™.</del></em></p><p>ArchWiki æ˜¯è¿™æ ·æè¿°çš„ï¼š</p><pre><code class="hljs">Arch Linux is an independently developed, x86-64 general-purpose GNU/Linux distribution that strives to provide the latest stable versions of most software by following a rolling-release model. The default installation is a minimal base system, configured by the user to only add what is purposely required.</code></pre><p>Qï¼šArch å‡­ä»€ä¹ˆèƒ½åœ¨ä¼—å¤š Linux ä¸­å±•éœ²é”‹èŠ’ï¼Ÿ</p><p>Aï¼šArchlinuxç›¸è¾ƒäºå…¶ä»–å‘è¡Œç‰ˆæœ€å¤§çš„ç‰¹ç‚¹å…¶ä¸€æ˜¯é«˜åº¦çš„å¯å®šåˆ¶æ€§ï¼Œå…¶äºŒæ˜¯æ¿€è¿›çš„æ»šåŠ¨æ›´æ–°ï¼ˆarolling-release modelï¼‰ã€‚Btwï¼Œåƒ OpenSUSE å’Œ Arch çš„è¡ç”Ÿ Manjaroé€šæ ·è¿ç”¨äº†æ»šåŠ¨æ›´æ–°çš„åŒ…ç®¡ç†å™¨ã€‚æ­£æ˜¯ç”±äº Archè¿™ä¸¤å¤§ç‰¹ç‚¹ä½¿ä»–çš„å®‰è£…ä¸Šæ‰‹é—¨æ§›æ¯”è¾ƒé«˜ï¼Œæ’‡å¼€ Hackintosh é»‘è‹¹æœä¸ç®—<del>ï¼ˆèŒä¸šé€‰æ‰‹ç¦æ­¢å‚åŠ æ¯”èµ›ï¼ï¼‰</del>ï¼ŒArchå’Œ Fedoraå¯ä»¥ç®—å¾—ä¸Šæ˜¯æ“ä½œç³»ç»Ÿå®‰è£…éš¾åº¦ä¸¤å¤§å·¨å¤´äº†ã€‚</p><p><strong>Notice.</strong>æ­¤åšæ–‡å°†ä¼šè®°å½•ä¸€æ¬¡å®Œæ•´çš„Archlinuxå®‰è£…è¿‡ç¨‹ï¼Œç”±äºæ‰‹å¤´æ²¡æœ‰é—²ç½®çš„è®¾å¤‡ï¼Œå°†åœ¨ParallelsDesktopè™šæ‹Ÿæœºç¯å¢ƒä¸‹è¿›è¡Œã€‚ç”±äºPdä¸­è¿è¡ŒLinuxæ¨¡æ‹Ÿäº†BIOSä¼ ç»Ÿå¼•å¯¼çš„ä¸»æ¿ä¸”æ— æ³•ä¿®æ”¹ï¼Œä½†äº‹å®ä¸Šåªè¦ä¸æ˜¯å¤ªè€çš„æœºå‹ï¼Œå‡ ä¹æ‰€æœ‰x86å¹³å°éƒ½é‡‡ç”¨äº†UEFIå¼•å¯¼æ–¹å¼ï¼Œè¿™ä¼šå¯¼è‡´åœ¨å®‰è£…è¿‡ç¨‹ä¸­çš„éƒ¨åˆ†æ­¥éª¤ä¼šä¸å®é™…æƒ…å†µå¤§ç›¸å¾„åº­ï¼ˆå¦‚ä½¿ç”¨cfdiskåˆ†åŒºæ—¶çš„åˆ†åŒºç­–ç•¥ä¸åŒï¼Œåˆ†åŒºè¡¨æ ¼å¼ä¼šæœ‰mbr+bioså’Œguid+uefiçš„åŒºåˆ†ï¼Œä½¿ç”¨grubbootloaderå¼•å¯¼ç³»ç»Ÿæ—¶ä¹Ÿä¼šæœ‰è¾ƒå¤§å·®å¼‚ï¼‰ã€‚ç»¼ä¸Šï¼Œå¦‚æœä½ æƒ³é€šè¿‡è¿™ç¯‡æ–‡ç« æ¥å­¦ä¹ å¦‚ä½•å®‰è£…Archlinuxçš„è¯ï¼Œå»ºè®®è¿˜æ˜¯åœ¨ç½‘ç»œä¸Šå¯»æ‰¾æ›´å¤šçš„å‚è€ƒèµ„æ–™ã€‚æˆ‘ä»¬åº”è¯¥ä»å®‰è£…è¿‡ç¨‹ä¸­å­¦ä¹ åˆ°å¾ˆå¤šå†…å®¹ï¼Œè€Œä¸æ˜¯ä»…ä»…ä¸ºäº†å¾—åˆ°ä¸€ä¸ªLinuxç³»ç»Ÿè€Œå®‰è£…ï¼Œæ­¤æ–‡åªèµ·æŠ›ç –å¼•ç‰çš„ä½œç”¨ã€‚</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œå¼€å§‹å§ã€‚&lt;(ï¿£ï¸¶ï¿£)â†—[GO!]</p><h2 id="ä»å®˜ç½‘è·å–livecd">ä»å®˜ç½‘è·å–LiveCD</h2><p>è¿›å…¥ Archlinux çš„ä¸‹è½½é¡µé¢ï¼Œæ¨èä¸‹è½½ BitTorrent ç§å­æ–‡ä»¶è‡³æœ¬åœ°ï¼Œå†ä½¿ç”¨Thunder æˆ– Motrixç­‰ç¬¬ä¸‰æ–¹ç£åŠ›ä¸‹è½½å·¥å…·ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä¸‹æ–¹å›½å†…çš„é•œåƒæºï¼Œå¦‚æ¸…åå¤§å­¦çš„Tsinghua tunaï¼Œä¸€ç›´ä¸º Linux å¼€æºç¤¾åŒºæä¾›ç€ä¼˜è‰¯çš„é•œåƒæœåŠ¡ã€‚Archå›¢é˜Ÿè€ƒè™‘ä¹ŸæŒºå‘¨å…¨ï¼Œä¸ºç”¨æˆ·è¿˜æä¾›äº†Docker é•œåƒï¼ŒVMè™šæ‹Ÿæœºï¼ŒVagrantï¼ˆä¸€å®¶ä¸»è¦æä¾›åœ¨çº¿Virtualboxè™šæ‹ŸæŠ€æœ¯æœåŠ¡çš„å›½å¤–äº‘å¹³å°ï¼‰é•œåƒç­‰å¤šä¸ªç‰ˆæœ¬ï¼Œè¿™äº›å†…å®¹ä¼šåœ¨Downloads é¡µé¢å‘ˆç°ã€‚</p><p>ä¸‹è½½å¥½çš„isoæ–‡ä»¶å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥æ ¡éªŒç­¾åï¼Œå‰ææ˜¯å·²å®‰è£… <ahref="https://wiki.archlinux.org/index.php/GnuPG">GnuPG</a>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gpg --keyserver-options auto-key-retrieve --verify archlinux-version-x86_64.iso.sig`<br></code></pre></td></tr></table></figure><p>å¦‚æœå·²ç»æœ‰ä¸€å°é…ç½®å¥½çš„ Archï¼Œä¹Ÿå¯ä»¥ç”¨pacman-keyï¼ˆå…¶ä¸­versionå­—æ®µåè¯·è‡ªè¡Œæ›¿æ¢ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pacman-key -v archlinux-version-x86_64.iso.sig<br></code></pre></td></tr></table></figure><p>è‡³ç›®å‰ï¼Œæœ€æ–°ç‰ˆæœ¬æ˜¯archlinux-2021.02.01-x86_64.isoã€‚é•œåƒæ–‡ä»¶å·²ç»å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªUSBæ¥å£çš„Uç›˜ä½œä¸ºå®‰è£…ä»‹è´¨ï¼Œå¯ä»¥é‡‡ç”¨rufusï¼ŒbelenaEtcherç­‰å·¥å…·å°†isoé•œåƒæ–‡ä»¶çƒ§å½•è‡³Uç›˜ï¼Œå¼€æœºå¼•å¯¼Uç›˜å¯åŠ¨ã€‚å…·ä½“æ­¥éª¤ä¸åšèµ˜è¿°ã€‚</p><h2 id="å®‰è£…ç³»ç»Ÿ">å®‰è£…ç³»ç»Ÿ</h2><h3 id="è¿æ¥ç½‘ç»œå’Œæ—¶é—´åŒæ­¥">è¿æ¥ç½‘ç»œå’Œæ—¶é—´åŒæ­¥</h3><p>å¦‚æœæ˜¯BIOSå¼•å¯¼ï¼Œä¼šçœ‹åˆ°è¿™æ ·çš„ç•Œé¢ï¼Œ</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux01.png" /></p><p>é€‰ä¸­ç¬¬ä¸€é¡¹ Arch Linux install medium (x86_64, BIOS)ï¼Œå›è½¦è¿›å…¥ LiveCDç³»ç»Ÿï¼Œå®é™…ä¸Šå°±æ˜¯ä½ Uç›˜é‡Œé¢å°è£…å¥½çš„Archlinuxï¼Œç³»ç»Ÿå·²ç»åŒ…å«äº†å®‰è£…æ‰€éœ€è¦çš„ç¼–è¾‘å™¨ï¼Œç½‘ç»œç»„å»ºç­‰ã€‚ç»è¿‡çŸ­æš‚çš„è·‘ç ç³»ç»Ÿä¼šå°†ä½ è‡ªåŠ¨ç™»å…¥root æ ¹ç”¨æˆ·ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux02.png" /></p><p>æ³¨æ„ç¬¬å››æ®µçš„æ–‡å­—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">For Wi-Fi, authenticate to the wireless network using the iwctl utility.<br>Ethernet and Wi-Fi connections using DHCP should work automatically.<br></code></pre></td></tr></table></figure><p>è¿™æ®µæ–‡å­—çš„æ„æ€æ˜¯ï¼Œå¦‚æœä½¿ç”¨ Wi-Fi é“¾æ¥è‹±ç‰¹ç½‘è¯·ä½¿ç”¨ iwctlå‘½ä»¤ï¼›æœ‰çº¿è¿æ¥å³DHCPå®¢æˆ·ç«¯åŠ¨æ€åˆ†é…IPå¯ä»¥ä¸åšä»»ä½•é…ç½®ã€‚å¦‚æœæ˜¯ç‰¹æ®Šç½‘ç»œç¯å¢ƒï¼Œå¦‚PPPoeæ‹¨å·æˆ–æ˜¯æ ¡å›­ç½‘ï¼Œå»ºè®®ä½¿ç”¨æ‰‹æœºå…±äº«USBç½‘ç»œï¼Œç³»ç»Ÿä¼šä½œä¸ºDHCP ç½‘ç»œæ¥å¤„ç†ã€‚</p><p>æ£€æŸ¥ä¸€ä¸‹ç½‘ç»œè”é€šæ€§ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux03.png" /></p><p>å¯é€‰åŒæ­¥ç³»ç»Ÿæ—¶é—´ï¼Œé‡‡ç”¨å¸¸ç”¨çš„ NTP åè®®ï¼ˆåŒä¸åŒæ­¥æ— æ‰€è°“ï¼‰ï¼Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">timedatectl set-ntp <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ timedatectl status æ£€æŸ¥ã€‚</p><h3 id="ç£ç›˜åˆ†åŒº">ç£ç›˜åˆ†åŒº</h3><p>BIOS with MBR</p><table><thead><tr class="header"><th style="text-align: left;">Mount point</th><th style="text-align: left;">Partition</th><th style="text-align: left;">Partition type</th><th style="text-align: left;">Suggested size</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">[SWAP]</td><td style="text-align: left;">/dev/swap_partition</td><td style="text-align: left;">Linux swap</td><td style="text-align: left;">More than 512 MiB</td></tr><tr class="even"><td style="text-align: left;">/mnt</td><td style="text-align: left;">/dev/root_partition</td><td style="text-align: left;">Linux</td><td style="text-align: left;">Remainder of the device</td></tr></tbody></table><p>UEFI with GPT</p><table><thead><tr class="header"><th style="text-align: left;">Mount point</th><th style="text-align: left;">Partition</th><th style="text-align: left;">Partition type</th><th style="text-align: left;">Suggested size</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">/mnt/boot or /mnt/efi</td><td style="text-align: left;">/dev/efi_system_partition</td><td style="text-align: left;">EFI system partition</td><td style="text-align: left;">At least 260 MiB</td></tr><tr class="even"><td style="text-align: left;">[SWAP]</td><td style="text-align: left;">/dev/swap_partition</td><td style="text-align: left;">Linux swap</td><td style="text-align: left;">More than 512 MiB</td></tr><tr class="odd"><td style="text-align: left;">/mnt</td><td style="text-align: left;">/dev/root_partition</td><td style="text-align: left;">Linux x86-64 root (/)</td><td style="text-align: left;">Remainder of the device</td></tr></tbody></table><p>ä»¥ä¸Šä¸¤ä¸ªåˆ†åŒºå‚è€ƒè¡¨æ ¼æ‘˜è‡ªArchWikiï¼Œè¿™é‡Œä½¿ç”¨ç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼Œä½†æœ‰äº›æ³¨æ„äº‹é¡¹å€¼å¾—ä¸€æã€‚</p><ul><li>swap äº¤æ¢åˆ†åŒºçš„ä½œç”¨ï¼šå½“ç³»ç»Ÿç‰©ç† RAM å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œç³»ç»Ÿä¼šå°† RAMé‡Œçš„ä½è®¿é—®é¢‘ç‡çš„å†…å­˜å¯¹è±¡æ”¾ç½®åˆ° swap åˆ†åŒºä¸­ã€‚æ•… swapåˆ†åŒºè®¿é—®é€Ÿåº¦è¦è¿œæ…¢äºç‰©ç†å†…å­˜ã€‚</li><li>UEFI å¼•å¯¼çš„æœºå‹åœ¨ç£ç›˜ä¸­å·²ç»å­˜åœ¨äº† ESP åˆ†åŒºï¼ŒWindows boot managerå¼•å¯¼æ–‡ä»¶ä¼šå­˜æ”¾åœ¨è¯¥åˆ†åŒºçš„ EFI ç›®å½•ä¸‹ã€‚å¦‚æœè¿™æ ·ï¼Œå°±æ²¡å¿…è¦æ–°å»º EFIåˆ†åŒºï¼Œç›´æ¥å°†åŸæœ‰çš„ç›´æ¥æŒ‚è½½åˆ° /mnt/boot å³å¯ã€‚</li></ul><p>ä½¿ç”¨ lsblk å‘½ä»¤æŸ¥çœ‹ç£ç›˜æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ° loop0 å’Œ sr0 æ˜¯å½“å‰ LiveCDçš„è™šæ‹Ÿç£ç›˜ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯åœ¨ 12GB çš„ sda IDEç£ç›˜ä¸Šå®‰è£… Archï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux04.png" />ç£ç›˜å·¥å…·å¯ä»¥é€‰æ‹© fdisk æˆ– cfdiskï¼Œè¿™é‡Œä»¥ cfdisk ä½œä¸ºæ¼”ç¤ºã€‚è¾“å…¥ cfdisk/dev/sda ä»–ä¼šæç¤ºé€‰æ‹©åˆ†åŒºè¡¨æ ¼å¼ï¼Œmbr å³dosã€‚å›è½¦è¿›å…¥é…ç½®ç•Œé¢ï¼ŒæŒ‰ç…§è¡¨ä¸€åšå¥½ Linux åˆ†åŒºï¼ˆext4ï¼‰å’Œ swapã€‚å¦‚å›¾ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux05.png" />mke2fs å·¥å…·å¯ä»¥ç”¨äºæ ¼å¼åŒ– Linux ext æ ¼å¼åˆ†åŒºï¼ˆè¿™é‡Œæ˜¯/dev/sda2ï¼‰ï¼Œä½†Linux ä¸ä»…ä»…é™äº ext4 æ ¼å¼ï¼Œä¼ ç»Ÿçš„æœ‰ ext234 ç³»åˆ—ï¼Œæ¯”è¾ƒæ–°çš„æœ‰ zfsè¯¸ç±»ï¼Œzfs è®¡åˆ’åœ¨ä¹‹åå” ä¸€å” ï¼Œè¿™é‡Œé€‰æ‹© ext4ï¼Œæ¯•ç«Ÿå‡ ä¹æ‰€æœ‰å‘è¡Œç‰ˆéƒ½ä¼šé‡‡ç”¨ext4ï¼›åŒæ—¶ mkswap æ ¼å¼åŒ– swap åˆ†åŒºï¼Œå®Œæˆåå¯ä»¥çœ‹è§å¦‚ä¸‹ä¿¡æ¯:</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux06.png" />ä¸»ç£ç›˜åˆ†åŒºå·²å‡†å¤‡å°±ç»ªï¼Œå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount /dev/sdax /mnt<br>swapon /dev/sdax<br></code></pre></td></tr></table></figure><p>åˆ†åˆ«æŒ‚è½½ç£ç›˜å’Œåº”ç”¨äº¤æ¢åˆ†åŒºã€‚æ¥ä¸‹æ¥è¿›å…¥å®‰è£…é˜¶æ®µã€‚</p><h3 id="ç³»ç»Ÿå®‰è£…">ç³»ç»Ÿå®‰è£…</h3><p>Arch å®Œå…¨é€šè¿‡é“¾æ¥äº’è”ç½‘æ¥å®‰è£…åŸºæœ¬ç³»ç»Ÿç»„ä»¶ï¼Œè­¬å¦‚ linux linux-develbase base-devel dhcpcd ç­‰åŒ…ã€‚ç”±äºå¤§é™†ç½‘ç»œç¯å¢ƒçš„ç‰¹æ®Šæƒ…å†µï¼Œå¦‚æœä½¿ç”¨ archçš„å®˜æ–¹ä»“åº“å¯èƒ½ä¼šè€—è´¹å¤§æŠŠæ—¶é—´ï¼Œå› æ­¤åˆ‡æ¢å›½å†…é•œåƒæºæ˜¯å®Œå…¨æœ‰å¿…è¦çš„ã€‚</p><p>LiveCD æ—©å·²é›†æˆäº† vim ç¼–è¾‘å™¨ï¼Œä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim /etc/pacman.d/mirrorlist<br></code></pre></td></tr></table></figure><p>ç¼–è¾‘é•œåƒæºæ–‡ä»¶ï¼Œå¦‚å›¾ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux07.png" /></p><p>ç†Ÿæ‚‰ vim çš„åŒå­¦ä¸€å®šä¼šç”¨å¿«æ·é”® : + /targetï¼Œå¿«é€ŸæŒ‡å®šåˆ° targetå­—æ®µçš„ä½ç½®ã€‚Archlinux åœ¨ç”¨æˆ·ä½¿ç”¨ pacman å‘½ä»¤æ—¶ä¼šæŒ‰ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºç´¢å¼•è¯¥mirrorlist é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è¦å°† China çš„ Server åœ°å€ç§»è‡³æœ€é¡¶ç«¯ã€‚ä½¿ç”¨ n + d+ d å¯å‰ªåˆ‡ n è¡Œçš„å†…å®¹ï¼Œç”¨ p ç²˜è´´ã€‚è¿™é‡Œä½¿ç”¨ç½‘æ˜“çš„æºï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux08.png" /></p><p>å®Œæˆå wq! é€€å‡ºã€‚pacstrap å·¥å…·å¯ä¸ºæŒ‡å®šåˆ†åŒºå®‰è£…å¿…å¤‡çš„baseï¼Œlinuxï¼Œlinux-firmwareåŒ…ï¼Œå…¶ä»–æ ¹æ®éœ€æ±‚è‡ªé€‰ï¼Œå¦‚base-develï¼ˆåŒ…å«äº†åŸºæœ¬çš„ gcc ç¼–è¯‘å™¨ç­‰ï¼‰ï¼Œdhcpcdç½‘ç»œå·¥å…·ï¼Œå‘½ä»¤èœå•man texinfoï¼Œæ–‡æœ¬ç¼–è¾‘å™¨ vi vim nanoç­‰ã€‚ã€‚ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pacstrap /mnt base base-devel linux linux-firmware dhcpcd vim nano<br></code></pre></td></tr></table></figure><p>è‹±æ–‡å¥½çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹å®˜æ–¹çš„è¯´æ˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">The base package does not include all tools from the live installation, <br>so installing other packages may be necessary <span class="hljs-keyword">for</span> a fully functional base system. <br>In particular, consider installing:<br><br>Â·userspace utilities <span class="hljs-keyword">for</span> the management of file systems that will be used on the system,<br>Â·utilities <span class="hljs-keyword">for</span> accessing RAID or LVM partitions,<br>Â·specific firmware <span class="hljs-keyword">for</span> other devices not included <span class="hljs-keyword">in</span> linux-firmware,<br>Â·software necessary <span class="hljs-keyword">for</span> networking,<br>Â·a text editor,<br>Â·packages <span class="hljs-keyword">for</span> accessing documentation <span class="hljs-keyword">in</span> man and info pages: man-db, man-pages and texinfo.<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåçš„æç¤ºå¦‚å›¾</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux09.png" /></p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux10.png" /></p><p>ä¸ºç³»ç»Ÿç£ç›˜åˆ†åŒºç”Ÿæˆ UUID å·æ ‡ï¼ŒUUID å€¼å¯ä½¿ç”¨ lsblkid æŸ¥çœ‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab<br></code></pre></td></tr></table></figure><h3 id="è¿›å…¥ç³»ç»Ÿå¹¶é…ç½®åŸºæœ¬ä¿¡æ¯">è¿›å…¥ç³»ç»Ÿå¹¶é…ç½®åŸºæœ¬ä¿¡æ¯</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨çš„æ˜¯ U ç›˜ ä¸­çš„ LiveCD ç³»ç»Ÿï¼Œarch-chroot è¿›å…¥Archlinuxï¼ï¼ï¼</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux11.png" /></p><p>é¦–å…ˆè¦æ›´æ–°æ—¶åŒºï¼Œln -sf åˆ›å»ºåŠ¨æ€é“¾æ¥è‡³ /etc/localtimeï¼Œå¤§é™†ç”¨æˆ·è¯·ä½¿ç”¨Shanghai æ ‡å‡†æ—¶é—´ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux12.png" /></p><p>æ›´æ–°æ—¶é—´ï¼Œå‰ææ˜¯åœ¨å‰é¢å·²è®¾ç½® ntp åè®®ï¼š <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hwclock --systohc<br></code></pre></td></tr></table></figure> ç¼–è¾‘è¯­è¨€æ–‡ä»¶/etc/locale.gen å¹¶ä¸”è§£æ³¨é‡Š en_US å’Œzh_CNï¼Œå…·ä½“æ“ä½œä¸èµ˜è¿°ã€‚ä¿å­˜å®Œæˆåæ›´æ–°è¯­è¨€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">locale-gen<br></code></pre></td></tr></table></figure><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux13.png" /></p><p>æ–°å»ºæ–‡ä»¶/etc/locale.confï¼ŒåŒæ—¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆè¯·ä¸è¦ä½¿ç”¨ä¸­æ–‡ä½œä¸ºé»˜è®¤è¯­è¨€ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">LANG=en_US.UTF-8<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥é…ç½®æœ¬åœ°ç½‘ç»œï¼Œarch çš„ hosts æ–‡ä»¶å­˜åœ¨äº /etc/hostsï¼Œvimç¼–è¾‘ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1localhost<br>::1localhost<br>127.0.1.1myhostname.localdomainmyhostname<br></code></pre></td></tr></table></figure><p>myhostname ä¸ºç½‘ç»œä¸»æœºåï¼Œè¯·æ–°å»ºæ–‡ä»¶ /etc/hostname å¹¶æ·»åŠ  myhostnameå­—æ®µåï¼Œè¯·è‡ªè¡Œæ›¿æ¢ä¸»æœºåã€‚ å¦‚ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux14.png" /></p><p>âš ï¸å¦‚æœä½ æ‹¥æœ‰å›ºå®šçš„å…¬ç½‘ ipï¼Œç”¨å®ƒæ¥æ›¿æ¢127.0.0.1ï¼ˆæˆ‘ç›¸ä¿¡å¤§éƒ¨åˆ†ç§äººç”µè„‘éƒ½æä¸åˆ°å›ºå®šå…¬ç½‘ipâœ§(â‰– â—¡ â‰–âœ¿) ï¼‰</p><p>mkinitcpio -P ç”Ÿæˆ initramfs img é•œåƒï¼Œå…¶å®è¿™ä¸ªè¿‡ç¨‹åœ¨ pacstrapæ—¶å·²ç»è·‘äº†ä¸€éã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux15.png" /></p><h3 id="æ™®é€šç”¨æˆ·ç»„çš„æ·»åŠ ">æ™®é€šç”¨æˆ·ç»„çš„æ·»åŠ </h3><p>é¦–å…ˆ passwd è®¾ç½® root å¯†ç ï¼Œå¯†ç ä¸ä¼šæ˜¾ç¤ºæ˜æ–‡ï¼Œè¾“å…¥åå›è½¦å³å¯ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux16.png" /></p><p>wheel ç»„ä¸­æ·»åŠ æ–°ç”¨æˆ·ï¼Œç¼–è¾‘ /etc/sudoers æ–‡ä»¶è§£æ³¨é‡Š %wheelï¼Œè¿™æ ·username ç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨ sudo æ¥è·å¾— rootæƒé™äº†ã€‚åŒæ ·çš„ï¼Œpasswdè®¾ç½®å¯†ç ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">useradd -m -G wheel username<br>passwd username<br></code></pre></td></tr></table></figure><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux22.png" /></p><h3 id="grub-ç³»ç»Ÿå¼•å¯¼">grub ç³»ç»Ÿå¼•å¯¼</h3><p>Linux çš„ç³»ç»Ÿå¼•å¯¼ç¨‹åºæ•°ä¸èƒœæ•°ï¼Œeg. grub sysLinux rEFIndCloverã€‚ä¸€èˆ¬æƒ…å†µé¦–é€‰ grubï¼Œå¦‚æœæ˜¯ BIOS ä¼ ç»Ÿå¯åŠ¨éœ€è¦Grub-Legacyï¼ˆå®˜æ–¹å¼€æºä»“åº“å·²ç»ç§»é™¤ï¼Œéœ€é€šè¿‡ AUR å®‰è£…ï¼‰ æˆ– Grub å’Œos-proberï¼ŒUEFI è¯·ç”¨ grub å’Œ efibootmgrã€‚è¿™é‡Œä»¥ BIOS ä¸ºä¾‹ã€‚</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux17.png" /></p><p>grub-install è¿›è¡Œå®‰è£…ï¼Œä¸å‡ºæ„å¤–èƒ½çœ‹åˆ°æˆåŠŸä¿¡æ¯ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux18.png" />exit é€€å‡ºè¿”å› LiveCDï¼Œå¸è½½åˆ†åŒºï¼Œrebooté‡å¯ï¼Œç³»ç»ŸåŸºæœ¬ç»„ä»¶å°±å®‰è£…å®Œæˆäº†ï¼ï¼ï¼</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux19.png" /></p><h2 id="å›¾å½¢ç•Œé¢å®‰è£…">å›¾å½¢ç•Œé¢å®‰è£…</h2><p>kdeï¼Œgnomeï¼Œxfceï¼Œdde å±äº DEï¼ˆDesktop Environmentï¼‰ï¼›i3ï¼Œdwmå±äºçª—å£ç®¡ç†å™¨ã€‚Archlinuxçš„é«˜åº¦å¯è‡ªå®šä¹‰æ€§ä½¿æˆ‘ä»¬å¯ä»»æ„é€‰æ‹©è‡ªå·±å–œæ¬¢çš„å›¾å½¢ç•Œé¢ã€‚</p><p>æœ¬ç¯‡åšå®¢ä»¥åŸºäº qt5 ç²¾ç¾çš„ KDE ä½œä¸ºæ¡Œé¢ç¯å¢ƒ ~~ï¼ˆGnomeå…šä¸è¦æ‰“æˆ‘ãƒ½(ï¾Ÿâˆ€ï¾Ÿ*)ï¾‰â”â”â”ï½©â™ª ï¼‰~~</p><p>è¡¥å……ï¼šçŠ¹ä¸”è®°å¾—ç¬¬ä¸€æ¬¡å®ä½“æœºå®‰è£… Arch æ—¶ï¼Œç°å®å¹¶æ²¡æœ‰æƒ³è±¡ä¸­çš„ç¾å¥½ã€‚é¦–æ¬¡grubå¼•å¯¼è¿›å…¥ç³»ç»Ÿåç½‘ç»œé—®é¢˜å¯èƒ½æ˜¯æœ€å¤§çš„åˆ¤è„šçŸ³ï¼Œæ²¡æœ‰é€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œ<del>è¯·è‡ªè¡Œä¸Šç½‘æœç´¢å§è¡Œä¸è¡Œå°±çœ‹ä½ æ˜¯æ¬§çš‡è¿˜æ˜¯éé…‹äº†</del>ï¼Œè®¾æƒ³ä¼šå¦å†™ä¸€ç¯‡è¯´ä¸€ä¸‹ç½‘ç»œé—®é¢˜å’ŒåŒæ˜¾å¡é©±åŠ¨ã€‚</p><p>ç¡®ä¿ç½‘ç»œæ˜¯é€šç•…çš„ï¼Œæˆ‘æ¼”ç¤ºæ—¶åªéœ€ systemed å¼€æœºå¯åŠ¨ dhcpcdæœåŠ¡å³å¯ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux20.png" /></p><p>emm.ç°åœ¨å›åˆ°æ­£é¢˜ã€‚</p><p>å®‰è£… Xorg æœåŠ¡å’Œ KDE-plasma è¿˜æœ‰å¯åŠ¨ç®¡ç†å™¨ sddmï¼Œä¸å»ºè®®å®‰è£… kdeçš„å…¨å®¶æ¡¶ kde-applicationsï¼ˆéå¸¸è‡ƒè‚¿ï¼ï¼ï¼‰ï¼Œè¿™é‡Œåªè£…äº† dolphin å’Œ konsoleç»ˆç«¯ã€‚</p><p>å¦‚å›¾ï¼ˆæˆªå›¾æ—¶å·²æå‰å®‰è£…äº† Xorgï¼‰ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux24.png" /></p><p>systemctl è®© sddm å¼€æœºè‡ªå¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">enable</span> sddm<br></code></pre></td></tr></table></figure><p>æœ€åä¸€æ­¥äº†ï¼Œé…ç½®ç³»ç»Ÿå­—ä½“ï¼Œå®‰è£…ä¸­æ–‡æ–‡æ³‰é©¿ microhei å’Œè‹±æ–‡ dejavuï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux25.png" /></p><p>é‡å¯ï¼ä½ å°±èƒ½çœ‹åˆ°ä¹…è¿çš„å›¾å½¢åŒ–æ¡Œé¢äº†ã€‚çœŸå¯è°“â€œå±±é‡æ°´å¤ç–‘æ— è·¯ï¼ŒæŸ³æš—èŠ±æ˜åˆä¸€æ‘â€ï½</p><h2 id="åç»­ä¼˜åŒ–">åç»­ä¼˜åŒ–</h2><p>æœ‰ä¸¤ç‚¹å†…å®¹éœ€è¦çŸ¥é“ï¼š 1.yay 2.archlinuxcn æº</p><p>yay æ˜¯ç»§ç¥å™¨ yaourt ååˆä¸€ä¸ª AUR ä»“åº“åŒ…ç®¡ç†å™¨ï¼Œæ‹¥æœ‰ pacmançš„å‡ ä¹æ‰€æœ‰åŠŸèƒ½å¹¶ä¸”èƒ½å¤ŸæŠ“å– AUR ä»“åº“è½¯ä»¶ã€‚è¾“å…¥ pacman -S yayå³å¯å®‰è£…ã€‚</p><p>archlinuxcn é¡¾åæ€ä¹‰ï¼Œæ˜¯ä¸­å›½ Arch ç”¨æˆ·è‡ªè¡Œç»´æŠ¤çš„ä»“åº“ã€‚ç”±äºæ‰€æœ‰ Linuxå‘è¡Œç‰ˆä»“åº“ä¸­éƒ½åªæœ‰å¼€æºè½¯ä»¶ï¼Œåƒ Google Chromeå•†ä¸šè½¯ä»¶æ—¶ä¸å¯èƒ½åŒ…å«åœ¨å†…çš„ã€‚archlinuxcnæºæ—©å·²ç¼–è¯‘å¥½äº†å¾ˆå¤šå¸¸ç”¨çš„è½¯ä»¶ï¼šChromeï¼ŒWPSOfficeï¼ŒNeteasecloudmusicï¼Œæœç‹—è¾“å…¥æ³•ç­‰ç­‰ï¼Œç¡®å®èƒ½å¸¦æ¥ä¸å°‘ä¾¿åˆ©ã€‚è¯·å‚è€ƒæ¸…åå¤§å­¦çš„æ–‡æ¡£å®‰è£…ï¼šhttps://mirrors.tuna.tsinghua.edu.cn/help/archlinuxcn/</p><p>é«˜ä¸­ç”Ÿæ´»æ—¶é—´å¾ˆç´§ï¼Œä¸€ä¸ªæ˜ŸæœŸåªæœ‰ä¸€å¤©èƒ½èµ¶ä¸€ç‚¹æ–‡å­—ã€‚è¿™ç¯‡åšå®¢çœŸçš„å†™äº†å¾ˆé•¿æ—¶é—´ï¼Œæ»¡æ‰“æ»¡ç®—1ä¸ªåŠæœˆï¼Œè´´ç‚¹å›¾ç‰‡çºªå¿µä¸€ä¸‹å§ï¼š</p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux27.png" /></p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux28.png" /></p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux29.png" /></p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux30.png" /></p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux31.png" /></p><p><imgsrc="https://funciaty.oss-cn-qingdao.aliyuncs.com/pic/Archlinux32.png" />## Outro æŒ‰ç…§ Archlinuxå®˜æ–¹çš„ä»‹ç»ï¼Œä»–ä»¬å›¢é˜Ÿç»´æŠ¤ç€Archä¸€ç›´ç§‰æŒç€äº”ä¸ªç†å¿µï¼š</p><pre><code class="hljs">Simplicityï¼Œ Modernityï¼Œ Pragmatismï¼Œ User Centralityï¼Œ Versatility</code></pre><p>ç®€è€Œè¨€ä¹‹ï¼šKeep It Simple, Stupid.</p><p>ä¿æŒç®€çº¦ï¼Œä¸€ç›®äº†ç„¶å†å¥½ä¸è¿‡äº†ã€‚</p><p>æˆ–è®¸ä»ä¸­ä¹Ÿèƒ½å¾—åˆ°å¯å‘ï¼šç”Ÿæ´»å›ºç„¶ä¸ç®€å•ï¼Œå³ä½¿è¿™æ ·ä¹Ÿè¦ç®€å•çš„ç”Ÿæ´»ã€‚</p><p>Billy Shao,</p><p>2/24/2021è®°.</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ç®€è°ˆC++é«˜ç²¾åº¦ç®—æ³•</title>
    <link href="/2020/03/11/cppHighAlgorithm/"/>
    <url>/2020/03/11/cppHighAlgorithm/</url>
    
    <content type="html"><![CDATA[<p>ç¬¬ä¸€ç¯‡åšæ–‡ï¼Œ&lt;(ï¿£ï¸¶ï¿£)â†—[GO!]</p><p>é«˜ç²¾åº¦æ˜¯ä¸€ç±»é‡è¦ä¸”åŸºç¡€çš„ç®—æ³•ï¼Œä¸»è¦åº”ç”¨åœºæ™¯æ˜¯åœ¨è¿›è¡Œå¤§æ•°è¿ç®—æ—¶ï¼Œå¦‚æœä½¿ç”¨è¯­è¨€ç¼–è¯‘å™¨å†…ç½®çš„åŸºæœ¬æ•°æ®ç»“æ„çš„è¯è‚¯å®šä¼šæº¢å‡ºã€‚æ‹¿C++æ¥è¯´ï¼Œæœ€å¤§çš„æ•´å‹longlongå¤§å°ä¹Ÿåªæœ‰2çš„64æ¬¡æ–¹ã€‚ï¼ˆå½“ç„¶pythonç©å®¶ä¸ç”¨æ‹…å¿ƒè¿™ä¸ªé—®é¢˜ï¼‰ã€‚</p><p>è¿™æ—¶å€™é«˜ç²¾åº¦ç®—æ³•å°±ä½“ç°äº†å…¶ä»·å€¼ï¼šæˆ‘ä»¬å°†è¾“å…¥çš„æ•´å‹å˜é‡æ¯ä¸€ä½å­˜å‚¨åœ¨æ•°ç»„ä¸­ï¼Œè¿ç®—æ—¶ç›´æ¥é€šè¿‡æ•°ç»„æ¥è¿›è¡Œã€‚</p><p>æ–¹ä¾¿è¿ç®—æ—¶ä½ä½è¿ç®—è¿›ä½è‡³é«˜ä½ï¼Œå¯ä»¥å°†å¤§æ•°å€’åºå­˜å‚¨åœ¨æ•°ç»„ä¹‹ä¸­ï¼š<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> a[<span class="hljs-number">100</span>], len;<br>string num;<br>cin &gt;&gt; num;<br>len = num.<span class="hljs-built_in">length</span>();<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len; i++) &#123;<br>a[i] = num[len - i] - <span class="hljs-string">&#x27;0&#x27;</span>;  <br><span class="hljs-comment">// è¯»å…¥çš„æ•°å­—æ˜¯stringï¼Œè¿™é‡Œcharéšå¼è½¬æ¢ä¸ºint</span><br>&#125;<br></code></pre></td></tr></table></figure> è¿™æ ·å°±ç®€å•çš„å®Œæˆäº†è¯»å…¥éƒ¨åˆ†ã€‚ é«˜ç²¾åº¦æ•°è¾“å‡ºçš„å®ç°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = len; i &gt;= <span class="hljs-number">1</span>; i--) &#123;<br>cout &lt;&lt; a[i];<br>&#125;<br>cout &lt;&lt; endl;<br></code></pre></td></tr></table></figure><h1 id="é«˜ç²¾åº¦åŠ å•ç²¾åº¦">é«˜ç²¾åº¦åŠ å•ç²¾åº¦</h1><p>å›é¡¾å°å­¦äºŒå¹´çº§å­¦è¿‡çš„ç«–å¼åŠ æ³• ï¼ˆé€æ¸æ¯•å¯¼åŒ–ï¼‰ï¼Œä½ å°±ä¼šå‘ç°å®ç°çš„æ€è·¯ï¼š<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs tap"><br> <span class="hljs-number"> 2 </span>3<span class="hljs-number"> 1 </span>1  9<br>+).        1<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> <span class="hljs-number"> 2 </span>3<span class="hljs-number"> 1 </span>1 10<br>å³<br> <span class="hljs-number"> 2 </span>3<span class="hljs-number"> 1 </span>1 9<br>+).       1<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> <span class="hljs-number"> 2 </span>3<span class="hljs-number"> 1 </span>2 0<br></code></pre></td></tr></table></figure>åŒæ—¶è¦æ³¨æ„è¿›ä½æ—¶æ³¨æ„æœ€é«˜ä½çš„å¤„ç†ï¼Œå¹¶ä¸”åŒæ—¶æ›´æ–°lençš„å€¼ã€‚è¿™é‡Œwhileè¯­å¥ä¼šé‡å¤åˆ¤æ–­æœ€é«˜ä½+1æ˜¯å¦ä¸º0ï¼ˆæ³¨æ„ï¼šæˆ‘ä»¬å·²ç»å°†æ•°ç»„aç”¨memsetåˆå§‹åŒ–ä¸º0ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">int</span> a[<span class="hljs-number">100</span>], len;<br>    string num;<br>    <span class="hljs-built_in">memset</span>(a, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(a));<br>    cin &gt;&gt; num;<br>    len = num.<span class="hljs-built_in">length</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len; i++) &#123;<br>        a[i] = num[len - i] - <span class="hljs-string">&#x27;0&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-type">int</span> x;<br>    cin &gt;&gt; x;<br>    a[<span class="hljs-number">1</span>] += x;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len; i++) &#123;<br>        a[i + <span class="hljs-number">1</span>] += a[i] / <span class="hljs-number">10</span>;<br>        a[i] %= <span class="hljs-number">10</span>;<br>    &#125;<br>    <span class="hljs-keyword">while</span> (a[len + <span class="hljs-number">1</span>]) &#123;<br>        len++;<br>        a[len + <span class="hljs-number">1</span>] += a[len] / <span class="hljs-number">10</span>;<br>        a[len] %= <span class="hljs-number">10</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = len; i &gt;= <span class="hljs-number">1</span>; i--) &#123;<br>        cout &lt;&lt; a[i];<br>    &#125;<br>    cout &lt;&lt; endl;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="é«˜ç²¾åº¦åŠ é«˜ç²¾åº¦">é«˜ç²¾åº¦åŠ é«˜ç²¾åº¦</h1><p>å’Œä¸Šä¸€ä¸ªæ¡ˆä¾‹ç›¸æ¯”ï¼Œå”¯ä¸€çš„ä¸åŒå°±æ˜¯æ±‚å’Œçš„è¿‡ç¨‹ã€‚æˆ‘ä»¬è¿™é‡Œä¸å†æ˜¯åªè®©å­˜è´®é«˜ç²¾åº¦çš„æ•°ç»„çš„ç¬¬ä¸€ä½åŠ ä¸Šxï¼Œè€Œæ˜¯è®©æ¯ä¸€ä½éƒ½åŠ ä¸Šå¦å¤–ä¸€ä¸ªé«˜ç²¾åº¦å¯¹åº”ä½ç½®ä¸Šçš„å€¼ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> a1[<span class="hljs-number">100</span>], len1, a2[<span class="hljs-number">100</span>], len2;<br>len1 = <span class="hljs-built_in">max</span>(len1, len2); <span class="hljs-comment">// æ³¨æ„å¼•å…¥ cmathåº“</span><br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len1; i++) &#123;<br>a1[i] += a2[i];<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€é«˜ä½å¤„ç†æ–¹æ³•ç›¸åŒï¼Œè¿™é‡Œç›´æ¥æ”¾å‡ºä»£ç ã€‚ ï¼ˆæ•°ç»„å¤§å°æœ‰ç‚¹å¤¸å¼ å“ˆï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">int</span> a1[<span class="hljs-number">999999999</span>], len1, a2[<span class="hljs-number">999999999</span>], len2;<br>    string num1, num2;<br>    cin &gt;&gt; num1 &gt;&gt; num2;<br>    len1 = num1.<span class="hljs-built_in">length</span>();<br>    len2 = num2.<span class="hljs-built_in">length</span>();<br><br>    <span class="hljs-built_in">memset</span>(a1, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(a1));<br>    <span class="hljs-built_in">memset</span>(a2, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(a2));<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len1; i++) &#123;<br>        a1[i] = num1[len1 - i] - <span class="hljs-string">&#x27;0&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len2; i++) &#123;<br>        a2[i] = num2[len2 - i] - <span class="hljs-string">&#x27;0&#x27;</span>;<br>    &#125;<br>    len1 = <span class="hljs-built_in">max</span>(len1, len2);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len1; i++) &#123;<br>        a1[i] += a2[i];<br>        a1[i + <span class="hljs-number">1</span>] += a1[i] / <span class="hljs-number">10</span>;<br>        a1[i] %= <span class="hljs-number">10</span>;<br>    &#125;<br>    <span class="hljs-keyword">while</span> (a1[len1 + <span class="hljs-number">1</span>]) &#123;<br>        len1++;<br>        a1[len1 + <span class="hljs-number">1</span>] += a1[len1] / <span class="hljs-number">10</span>;<br>        a1[len1] %= <span class="hljs-number">10</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = len1; i &gt;= <span class="hljs-number">1</span>; i--) &#123;<br>        cout &lt;&lt; a1[i];<br>    &#125;<br>    cout &lt;&lt; endl;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="é«˜ç²¾åº¦å‡å•ç²¾åº¦">é«˜ç²¾åº¦å‡å•ç²¾åº¦</h1><p>emm..è¿™é‡Œæš‚æ—¶ä¸è€ƒè™‘ç»“æœå‡ºç°è´Ÿå€¼çš„æƒ…å†µã€‚ ç®€å•çš„æ€è·¯ï¼š</p><p>1.å°†é«˜ç²¾åº¦çš„æœ€åä¸€ä½å‡å»å•ç²¾åº¦æ•´æ•°ï¼Œå½“å‰æŒ‡å‘æœ€åä¸€ä½</p><p>2.å¦‚æœå½“å‰ä½ä¸Šçš„æ•°å°äº0ï¼Œå°±è®©å½“å‰æŒ‡å‘çš„å‰ä¸€ä½å‡å»1ï¼Œå¹¶è®©å½“å‰ä½åŠ ä¸Š10ï¼Œç›´åˆ°å½“å‰ä½ä¸Šçš„æ•°ä¸å°äº0</p><p>3.å‘å‰ç§»åŠ¨ä¸€ä½ï¼Œç»§ç»­æ‰§è¡Œç¬¬äºŒæ­¥æ“ä½œã€‚</p><p>é™¤äº†ä¸Šè¿°è¿‡ç¨‹å’ŒåŠ æ³•æœ‰æ‰€å·®å¼‚ä»¥å¤–ï¼Œæœ€åçš„é•¿åº¦å¤„ç†ä¹Ÿä¸åŠ æ³•æœ‰æ‰€ä¸åŒã€‚è¿›è¡Œç›¸å‡æ“ä½œä»¥åï¼Œé«˜ç²¾åº¦æ•´æ•°çš„æ€»é•¿åº¦æœ‰å¯èƒ½ä¼šå˜å°ï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­æ˜¯å¦å½“å‰é«˜ç²¾åº¦æ•´æ•°çš„æœ€é«˜ä½å·²ç»æ˜¯0ï¼Œå¦‚æœæ˜¯0åˆ™éœ€è¦è®©æ€»é•¿åº¦å‡å»1ã€‚</p><p>æ ¸å¿ƒä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp">a[<span class="hljs-number">1</span>] -= x;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i&lt;= len; i++) &#123;<br><span class="hljs-keyword">while</span> (a[i] &lt; <span class="hljs-number">0</span>) &#123;<br>a[i + <span class="hljs-number">1</span>]--;<br>a[i] += <span class="hljs-number">10</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">while</span> (len &gt; <span class="hljs-number">1</span> &amp;&amp; a[len] == <span class="hljs-number">0</span>) &#123;<br>len --;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="é«˜ç²¾åº¦å‡é«˜ç²¾åº¦">é«˜ç²¾åº¦å‡é«˜ç²¾åº¦</h1><p>ä¸åŒä¹‹å¤„åœ¨äºï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹ä¸¤ä¸ªæ•°çš„æ¯- -ä½è¿›è¡Œå‡æ³•æ“ä½œï¼Œå¹¶ä¸”åœ¨æœ€åç”±äºé•¿åº¦çš„å‡å°‘å€¼å¯èƒ½ä¸æ­¢1ï¼Œæ‰€ä»¥éœ€è¦ä¸æ–­åœ°åˆ¤æ–­æœ€é«˜ä½æ˜¯å¦å·²ç»è¢«å‡åˆ°0ã€‚å¹¶ä¸”ï¼Œå› ä¸ºæ¯ä¸€ä½ä¸Šçš„æ•°å‡åœ¨0â€¦9ä¹‹é—´ï¼Œæ‰€ä»¥ä¹‹å‰çš„while(a1[i] &lt; 0)å†™æˆif(a1[i] &lt; 0)å°±å¯ä»¥äº†ã€‚å½“ç„¶ï¼Œè¿™é‡Œç”¨whileä¹Ÿæ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ã€‚ å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">int</span> a1[<span class="hljs-number">100</span>], len1, a2[<span class="hljs-number">100</span>], len2;<br>    <span class="hljs-built_in">memset</span>(a1, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(a1));<br>    <span class="hljs-built_in">memset</span>(a2, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(a2));<br>    string num1, num2;<br>    cin &gt;&gt; num1 &gt;&gt; num2;<br>    <span class="hljs-keyword">if</span> (num1.<span class="hljs-built_in">length</span>() &lt; num2.<span class="hljs-built_in">length</span>() || num1.<span class="hljs-built_in">length</span>() == num2.<span class="hljs-built_in">length</span>() &amp;&amp; num1 &lt; num2) &#123;<br>        <span class="hljs-built_in">swap</span>(num1, num2);<br>        cout &lt;&lt; <span class="hljs-string">&quot;-&quot;</span>;<br>    &#125;<br>    <br>    len1 = num1.<span class="hljs-built_in">length</span>();<br>    len2 = num2.<span class="hljs-built_in">length</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len1; i++) &#123;<br>        a1[i] = num1[len1 - i] - <span class="hljs-string">&#x27;0&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len2; i++) &#123;<br>        a2[i] = num2[len2 - i] - <span class="hljs-string">&#x27;0&#x27;</span>;<br>    &#125;                                                                      <br>len1 = <span class="hljs-built_in">max</span>(len1, len2);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len1; i++) &#123;<br>        a1[i] -= a2[i];<br>        <span class="hljs-keyword">if</span> (a1[i] &lt; <span class="hljs-number">0</span>) &#123;<br>            a1[i + <span class="hljs-number">1</span>]--;<br>            a1[i] += <span class="hljs-number">10</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">while</span> (len1 &gt; <span class="hljs-number">1</span> &amp;&amp; a1[len1] == <span class="hljs-number">0</span>) &#123;<br>        len1--;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = len1; i &gt;= <span class="hljs-number">1</span>; i--) &#123;<br>        cout &lt;&lt; a1[i];<br>    &#125;<br>    cout &lt;&lt; endl;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>é«˜ç²¾åº¦ä¹˜å•ç²¾åº¦è·³è¿‡å§ï¼Œå’±ä»¬ç›´æ¥çœ‹ï½</p><h1 id="é«˜ç²¾åº¦ä¹˜é«˜ç²¾åº¦">é«˜ç²¾åº¦ä¹˜é«˜ç²¾åº¦</h1><p>é«˜ç²¾åº¦ä¹˜é«˜ç²¾åº¦æ˜¯æœ€å€¼å¾—æ¢è®¨çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ï¼Œå’Œä¹‹å‰ä¸åŒçš„å…³é”®ï¼Œåœ¨äºå¦‚ä½•æŠŠå¤„ç†è¿›ä½ä¹‹å‰æ¯ä¸€ä½ä¸Šçš„ä¹˜ç§¯æ€»å’Œæ±‚å‡ºæ¥ã€‚æˆ‘ä»¬å†ç”¨ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸€çœ‹:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">      3   2   1<br>x)        2   1<br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>     3<span class="hljs-number">*1</span> 2<span class="hljs-number">*1</span> 1<span class="hljs-number">*1</span><br> 3<span class="hljs-number">*2</span> 2<span class="hljs-number">*2</span> 1<span class="hljs-number">*2</span><br>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br> [4] [3] [2] [1]<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°ï¼Œå¯¹äºæœ€ç»ˆç»“æœä¸‹æ ‡ä¸ºiçš„ä½ç½®æ¥è¯´ï¼Œå®ƒåŒ…æ‹¬çš„ä¹˜ç§¯å¯¹åº”çš„ä¸¤ä¸ªä¸‹æ ‡ä¹‹å’Œå‡ä¸ºi+1ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¦å¤–å¼€è¾Ÿä¸€ä¸ªæ–°çš„æ•°ç»„æ¥ä¿å­˜é«˜ç²¾åº¦ä¹˜æ³•çš„ç»“æœï¼Œç„¶åé€šè¿‡å¦‚ä¸‹çš„æ–¹å¼æ¥è®¡ç®—é«˜ç²¾åº¦ä¹˜æ³•:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len1; i++) &#123;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= len2; j++) &#123;<br>a[i + j - <span class="hljs-number">1</span>] += a1[i] * a2[j];<br>&#125;<br>&#125;<br>len = len1 + len2 - <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">int</span> a1[<span class="hljs-number">100</span>], len1, a2[<span class="hljs-number">100</span>], len2;<br>    <span class="hljs-type">int</span> a[<span class="hljs-number">200</span>], len;<br>    <span class="hljs-built_in">memset</span>(a1, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(a1));<br>    <span class="hljs-built_in">memset</span>(a2, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(a2));<br>    <span class="hljs-built_in">memset</span>(a, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(a));<br>    string num1, num2;<br>    cin &gt;&gt; num1;<br>    len1 = num1.<span class="hljs-built_in">length</span>();<br>    cin &gt;&gt; num2;<br>    len2 = num2.<span class="hljs-built_in">length</span>();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len1; i++) &#123;<br>        a1[i] = num1[len1 - i] - <span class="hljs-string">&#x27;0&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len2; i++) &#123;<br>        a2[i] = num2[len2 - i] - <span class="hljs-string">&#x27;0&#x27;</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len1; i++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">1</span>; j &lt;= len2; j++) &#123;<br>        a[i + j - <span class="hljs-number">1</span>] += a1[i] * a2[j];<br>    &#125;<br>    &#125;<br>    len = len1 + len2 - <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= len; i++) &#123;<br>        a[i + <span class="hljs-number">1</span>] += a[i] / <span class="hljs-number">10</span>;<br>        a[i] %= <span class="hljs-number">10</span>;<br>    &#125;<br>    <span class="hljs-keyword">while</span> (a[len + <span class="hljs-number">1</span>]) &#123;<br>        len++;<br>        a[len + <span class="hljs-number">1</span>] += a[len] / <span class="hljs-number">10</span>;<br>        a[len] %= <span class="hljs-number">10</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = len; i &gt;= <span class="hljs-number">1</span>; i--) &#123;<br>        cout &lt;&lt; a[i];<br>    &#125;<br>    cout &lt;&lt; endl;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å°ç»“ä¸€ä¸‹æš‚æ—¶ä¸è®¨è®ºé™¤æ³•å’Œæ¨¡è¿ç®—ï¼Œæ€»çš„æ€è·¯å°±æ˜¯ç”¨intæ•°ç»„å€’åºè¯»å…¥æ¯ä¸€ä½ä¸Šçš„æ•°ï¼Œç±»æ¯”æ•°å­¦è¿ç®—å¯ä»¥å¾—åˆ°è¿ç®—è§„åˆ™ã€‚å¤„ç†ä¹˜æ³•æ—¶åŠ¡å¿…è¦é‡æ–°åšä¸€ä¸ªå˜é‡å­˜å‚¨resultã€‚</p><p>æºç å¯ä»¥å»å‚è€ƒæˆ‘çš„Githubä»“åº“ï¼šhttps://github.com/Billy233/cpp_HighAccuracy</p><p>Billy Shao,</p><p>3/11/2020è®°.</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
